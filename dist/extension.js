var Sn=Object.create;var Ht=Object.defineProperty;var xn=Object.getOwnPropertyDescriptor;var Tn=Object.getOwnPropertyNames;var Dn=Object.getPrototypeOf,$n=Object.prototype.hasOwnProperty;var Pn=(a,e)=>()=>(a&&(e=a(a=0)),e);var ci=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),li=(a,e)=>{for(var t in e)Ht(a,t,{get:e[t],enumerable:!0})},hi=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Tn(e))!$n.call(a,i)&&i!==t&&Ht(a,i,{get:()=>e[i],enumerable:!(s=xn(e,i))||s.enumerable});return a};var P=(a,e,t)=>(t=a!=null?Sn(Dn(a)):{},hi(e||!a||!a.__esModule?Ht(t,"default",{value:a,enumerable:!0}):t,a)),Fn=a=>hi(Ht({},"__esModule",{value:!0}),a);var ui={};li(ui,{clearExecutionHistory:()=>In,getExecutionHistory:()=>Ls,isTestRunning:()=>Ms,runBDDTests:()=>mt,terminateBDDTests:()=>As});async function Rn(a,e={},t="operation",s){let i={...En,...e},n=null;for(let r=1;r<=i.maxAttempts;r++)try{s?.appendLine(`\u{1F504} ${t} - Attempt ${r}/${i.maxAttempts}`);let o=await a();return r>1&&s?.appendLine(`\u2705 ${t} succeeded on attempt ${r}`),o}catch(o){n=o;let c=i.retryableErrors.some(u=>n.message.toLowerCase().includes(u.toLowerCase()));if(r===i.maxAttempts||!c)throw s?.appendLine(`\u274C ${t} failed permanently: ${n.message}`),n;let l=i.delayMs*Math.pow(i.backoffMultiplier,r-1);s?.appendLine(`\u26A0\uFE0F ${t} failed (attempt ${r}): ${n.message}. Retrying in ${l}ms...`),await new Promise(u=>setTimeout(u,l))}throw n||new Error(`${t} failed after ${i.maxAttempts} attempts`)}async function mt(a,e,t,s){let i=j.workspace.workspaceFolders;if(!i){let o="No workspace folder open. Cannot execute BDD tests.";j.window.showErrorMessage(o),s?.appendLine(`[ERROR] ${o}`),a?.end();return}if(ke){let o="Another BDD test is already running. Please wait or terminate it first.";j.window.showWarningMessage(o),s?.appendLine(`[WARNING] ${o}`);return}let n=i[0].uri.fsPath,r=j.workspace.getConfiguration("playwrightBdd");try{let o=r.get("enableFeatureGen",!0),c=r.get("configPath")||"./playwright.config.ts",l=r.get("tsconfigPath")||"",u=r.get("tags")||"",p=r.get("featureFolder","features"),f=gt.resolve(n,c);s?.appendLine(`Using config: ${f}`);let g=r.get("featureGenCommand")||"npx bddgen --config=${configPath}",b=r.get("testCommand")||"npx playwright test ${tsconfigArg} --config=${configPath} ${tagsArg}",v=c,C=l?`${l}`:"",k=u?`--grep "${u}"`:"";if(g=g.replace("${configPath}",v).replace("${tsconfigArg}",C).replace("${tagsArg}",k),b=b.replace("${configPath}",v).replace("${tsconfigArg}",C).replace("${tagsArg}",k),t?.uri?.fsPath){let $=gt.resolve(n,p),x=gt.relative($,t.uri.fsPath);if(b+=` "${x}"`,t.label&&t.parent){let E=t.label;b+=` --grep "${E}"`,s?.appendLine(`Targeting specific test: ${E}`)}}let F=async($,x,E)=>{let I=Date.now();s?.appendLine(`[${new Date().toISOString()}] Running ${x}: ${$}`);let L=j.window.createStatusBarItem(j.StatusBarAlignment.Left);L.text=`$(sync~spin) ${x}...`,L.show();let le=()=>new Promise((W,H)=>{ke=(0,di.exec)($,{cwd:n,timeout:3e5,maxBuffer:1024*1024*10},(X,$e,He)=>{ke=null,X?H(X):W({stdout:$e||"",stderr:He||""})}),ke.on("error",X=>{s?.appendLine(`[ERROR] Process error: ${X.message}`),H(X)})});try{let W=r.get("execution.retryCount",2),H=r.get("execution.retryDelay",2e3),X=await Rn(le,{maxAttempts:W,delayMs:H},x,s),$e=Date.now()-I;L.hide(),L.dispose(),be.push({timestamp:new Date,command:$,success:!0,duration:$e}),be.length>20&&(be=be.slice(-20));let He=`${x} completed successfully in ${$e}ms`;if(s?.appendLine(`[SUCCESS] ${He}`),X.stdout&&a?.appendOutput(X.stdout),t&&a?.passed(t),E){E();return}a?.end()}catch(W){let H=Date.now()-I;L.hide(),L.dispose(),be.push({timestamp:new Date,command:$,success:!1,duration:H}),be.length>20&&(be=be.slice(-20));let X=W.stderr||W.message,$e=`${x} failed after ${H}ms:
${X}`;if(s?.appendLine(`[ERROR] ${$e}`),a?.appendOutput(X),t){let He=new j.TestMessage(X);He.location=t.uri?new j.Location(t.uri,new j.Position(0,0)):void 0,a?.failed(t,He)}W.message.includes("ENOENT")||W.message.includes("command not found")?j.window.showErrorMessage(`${x} failed: Command not found. Make sure Playwright and playwright-bdd are installed.`):W.message.includes("timeout")?j.window.showErrorMessage(`${x} timed out after ${Math.round(H/1e3)}s. Consider increasing the timeout.`):j.window.showErrorMessage(`${x} failed. Check the output panel for details.`),a?.end()}};o?(await F(g,"Feature generation"),await F(b,"BDD test run")):await F(b,"BDD test run")}catch(o){let c=`Failed to setup BDD test execution: ${o}`;s?.appendLine(`[ERROR] ${c}`),j.window.showErrorMessage(c),a?.end()}}function As(){if(ke)try{ke.kill("SIGTERM"),setTimeout(()=>{ke&&(ke.kill("SIGKILL"),ke=null)},5e3),j.window.showInformationMessage("\u{1F6D1} BDD test execution terminated.")}catch(a){j.window.showErrorMessage(`Failed to terminate BDD test: ${a}`)}else j.window.showInformationMessage("No BDD test is currently running.")}function Ls(){return be.slice()}function In(){be=[]}function Ms(){return ke!==null}var j,gt,di,ke,be,En,zt=Pn(()=>{j=P(require("vscode")),gt=P(require("path")),di=require("child_process"),ke=null,be=[],En={maxAttempts:3,delayMs:1e3,backoffMultiplier:2,retryableErrors:["ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","socket hang up","network timeout","connection refused","EPIPE"]}});var xi=ci((xo,Si)=>{"use strict";Si.exports=ki;function ki(a,e,t){a instanceof RegExp&&(a=bi(a,t)),e instanceof RegExp&&(e=bi(e,t));var s=Ci(a,e,t);return s&&{start:s[0],end:s[1],pre:t.slice(0,s[0]),body:t.slice(s[0]+a.length,s[1]),post:t.slice(s[1]+e.length)}}function bi(a,e){var t=e.match(a);return t?t[0]:null}ki.range=Ci;function Ci(a,e,t){var s,i,n,r,o,c=t.indexOf(a),l=t.indexOf(e,c+1),u=c;if(c>=0&&l>0){if(a===e)return[c,l];for(s=[],n=t.length;u>=0&&!o;)u==c?(s.push(u),c=t.indexOf(a,u+1)):s.length==1?o=[s.pop(),l]:(i=s.pop(),i<n&&(n=i,r=l),l=t.indexOf(e,u+1)),u=c<l&&c>=0?c:l;s.length&&(o=[n,r])}return o}});var Ii=ci((To,Ri)=>{var Ti=xi();Ri.exports=Mn;var Di="\0SLASH"+Math.random()+"\0",$i="\0OPEN"+Math.random()+"\0",Ns="\0CLOSE"+Math.random()+"\0",Pi="\0COMMA"+Math.random()+"\0",Fi="\0PERIOD"+Math.random()+"\0";function js(a){return parseInt(a,10)==a?parseInt(a,10):a.charCodeAt(0)}function An(a){return a.split("\\\\").join(Di).split("\\{").join($i).split("\\}").join(Ns).split("\\,").join(Pi).split("\\.").join(Fi)}function Ln(a){return a.split(Di).join("\\").split($i).join("{").split(Ns).join("}").split(Pi).join(",").split(Fi).join(".")}function Ei(a){if(!a)return[""];var e=[],t=Ti("{","}",a);if(!t)return a.split(",");var s=t.pre,i=t.body,n=t.post,r=s.split(",");r[r.length-1]+="{"+i+"}";var o=Ei(n);return n.length&&(r[r.length-1]+=o.shift(),r.push.apply(r,o)),e.push.apply(e,r),e}function Mn(a){return a?(a.substr(0,2)==="{}"&&(a="\\{\\}"+a.substr(2)),Ct(An(a),!0).map(Ln)):[]}function Wn(a){return"{"+a+"}"}function Bn(a){return/^-?0\d/.test(a)}function On(a,e){return a<=e}function jn(a,e){return a>=e}function Ct(a,e){var t=[],s=Ti("{","}",a);if(!s)return[a];var i=s.pre,n=s.post.length?Ct(s.post,!1):[""];if(/\$$/.test(s.pre))for(var r=0;r<n.length;r++){var o=i+"{"+s.body+"}"+n[r];t.push(o)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),u=c||l,p=s.body.indexOf(",")>=0;if(!u&&!p)return s.post.match(/,(?!,).*\}/)?(a=s.pre+"{"+s.body+Ns+s.post,Ct(a)):[a];var f;if(u)f=s.body.split(/\.\./);else if(f=Ei(s.body),f.length===1&&(f=Ct(f[0],!1).map(Wn),f.length===1))return n.map(function(H){return s.pre+f[0]+H});var g;if(u){var b=js(f[0]),v=js(f[1]),C=Math.max(f[0].length,f[1].length),k=f.length==3?Math.abs(js(f[2])):1,F=On,$=v<b;$&&(k*=-1,F=jn);var x=f.some(Bn);g=[];for(var E=b;F(E,v);E+=k){var I;if(l)I=String.fromCharCode(E),I==="\\"&&(I="");else if(I=String(E),x){var L=C-I.length;if(L>0){var le=new Array(L+1).join("0");E<0?I="-"+le+I.slice(1):I=le+I}}g.push(I)}}else{g=[];for(var W=0;W<f.length;W++)g.push.apply(g,Ct(f[W],!1))}for(var W=0;W<g.length;W++)for(var r=0;r<n.length;r++){var o=i+g[W]+n[r];(!e||u||o)&&t.push(o)}}return t}});var Qr={};li(Qr,{activate:()=>qr});module.exports=Fn(Qr);var h=P(require("vscode")),Me=P(require("path"));zt();var ge=P(require("vscode"));zt();var _t=class{constructor(e){this.enableFeatureGen=e;this._onDidChangeCodeLenses=new ge.EventEmitter;this.onDidChangeCodeLenses=this._onDidChangeCodeLenses.event}refresh(){this._onDidChangeCodeLenses.fire()}provideCodeLenses(e){try{let t=[],s=e.getText();if(!s.trim())return t;let i=s.split(`
`),n=Ms(),r=Ls(),o=s.match(/^\s*Feature:\s*(.+)/m);if(o){let c=o[1].trim(),l=0;for(let g=0;g<i.length;g++)if(i[g].match(/^\s*Feature:/)){l=g;break}let u=new ge.Range(l,0,l,i[l].length),p=r.filter(g=>g.command.includes(c)).sort((g,b)=>b.timestamp.getTime()-g.timestamp.getTime())[0],f=n?"\u23F3 Running...":p?.success===!1?"\u274C Run Feature (Failed)":p?.success===!0?"\u2705 Run Feature":"\u25B6 Run Feature";if(t.push(new ge.CodeLens(u,{title:f,command:n?void 0:"playwright-bdd.runScenarioDynamic",arguments:n?void 0:[c,this.enableFeatureGen]})),t.push(new ge.CodeLens(u,{title:n?"\u23F3 Debug...":"\u{1F41E} Debug Feature",command:n?void 0:"playwright-bdd.debugScenario",arguments:n?void 0:[c]})),p&&p.duration>0){let g=p.duration>1e3?`${Math.round(p.duration/1e3)}s`:`${p.duration}ms`;t.push(new ge.CodeLens(u,{title:`\u23F1 Last run: ${g}`,command:void 0}))}}for(let c=0;c<i.length;c++){let l=i[c].match(/^\s*Scenario(?: Outline)?:\s*(.+)/);if(l){let u=l[1].trim(),p;for(let C=c-1;C>=0;C--){let k=i[C].match(/^\s*@(\w+)/);if(k){p=`@${k[1]}`;break}else{if(i[C].trim()==="")continue;break}}let f=new ge.Range(c,0,c,i[c].length),g=p??u,b=r.filter(C=>C.command.includes(u)||p&&C.command.includes(p)).sort((C,k)=>k.timestamp.getTime()-C.timestamp.getTime())[0],v=n?"\u23F3 Running...":b?.success===!1?"\u274C Run Scenario (Failed)":b?.success===!0?"\u2705 Run Scenario":"\u25B6 Run Scenario";t.push(new ge.CodeLens(f,{title:v,command:n?void 0:"playwright-bdd.runScenarioDynamic",arguments:n?void 0:[g,this.enableFeatureGen]})),t.push(new ge.CodeLens(f,{title:n?"\u23F3 Debug...":"\u{1F41E} Debug Scenario",command:n?void 0:"playwright-bdd.debugScenario",arguments:n?void 0:[g]}))}}return t}catch(t){return console.error("[FeatureCodeLensProvider] Error providing code lenses:",t),[]}}};var ne=P(require("vscode")),Je=P(require("path")),Fe=P(require("fs")),Ut=class{constructor(e){this.stepDefinitions=[];this.outputChannel=e,this.diagnosticCollection=ne.languages.createDiagnosticCollection("playwright-bdd")}async discoverStepDefinitions(e,t="src/steps"){try{this.outputChannel.appendLine("\u{1F50D} Starting step definition discovery...");let s=Date.now();this.stepDefinitions=[];let i=Je.resolve(e,t);if(!Fe.existsSync(i)){this.outputChannel.appendLine(`\u26A0\uFE0F Steps folder not found: ${i}`);return}let n=await this.findStepFiles(i);this.outputChannel.appendLine(`\u{1F4C1} Found ${n.length} step definition files`);for(let o of n)try{await this.parseStepFile(o)}catch(c){this.outputChannel.appendLine(`\u274C Error parsing step file ${o}: ${c}`)}let r=Date.now()-s;this.outputChannel.appendLine(`\u2705 Step discovery completed in ${r}ms. Found ${this.stepDefinitions.length} step definitions.`)}catch(s){this.outputChannel.appendLine(`\u274C Step definition discovery failed: ${s}`)}}async findStepFiles(e){let t=[],s=i=>{try{let n=Fe.readdirSync(i);for(let r of n){let o=Je.join(i,r);try{Fe.statSync(o).isDirectory()?s(o):(r.endsWith(".ts")||r.endsWith(".js"))&&t.push(o)}catch{continue}}}catch(n){this.outputChannel.appendLine(`\u26A0\uFE0F Error scanning directory ${i}: ${n}`)}};return s(e),t}async parseStepFile(e){try{let s=Fe.readFileSync(e,"utf8").split(`
`);for(let i=0;i<s.length;i++){let n=s[i].trim(),r=[/^(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*,\s*(.+)\)/,/^(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*,\s*async\s*\(\s*\)\s*=>\s*\{/,/^(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*,\s*async\s+function\s*\(/,/^(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*,\s*async\s*\([^)]*\)\s*:\s*[^=]*=>\s*\{/,/^@(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*\)/,/^(Given|When|Then)\s*\(\s*['"`]([^'"`]+)['"`]\s*,?\s*$/];for(let o of r){let c=n.match(o);if(c){let[l,u,p]=c,f="";if(l.includes(",")){let b=l.indexOf(",");f=l.substring(b+1).trim()}else{let b=i+1;for(;b<s.length&&b<i+5;){let v=s[b].trim();if(v.includes("async")||v.includes("function")||v.includes("=>")){f=v;break}b++}}this.stepDefinitions.some(b=>b.pattern===p&&b.type===u&&b.file===e)||(this.stepDefinitions.push({pattern:p,type:u,file:e,line:i+1,function:f||"function definition"}),this.outputChannel.appendLine(`  \u{1F4DD} Found ${u}: "${p}" in ${Je.basename(e)}:${i+1}`));break}}}}catch(t){this.outputChannel.appendLine(`\u274C Error reading step file ${e}: ${t}`)}}async provideDefinition(e,t,s){let n=e.lineAt(t).text.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)/);if(n){let r=n[2].trim();return await this.findStepDefinition(r)}}async findStepDefinition(e){let t=this.findMatchingStep(e);if(t){let s=ne.Uri.file(t.file),i=new ne.Position(t.line-1,0);return new ne.Location(s,i)}}findMatchingStep(e){return this.stepDefinitions.find(t=>{try{if(e.toLowerCase()===t.pattern.toLowerCase())return!0;let s=t.pattern;s=s.replace(/\{string\}/g,`(?:'[^']*'|"[^"]*")`).replace(/\{int\}/g,"(?:\\d+|<[^>]+>)").replace(/\{float\}/g,"(?:\\d+\\.?\\d*|<[^>]+>)").replace(/\{word\}/g,"(?:[a-zA-Z0-9_]+|<[^>]+>)").replace(/\{[^}]+\}/g,"(?:[^\\s]+|<[^>]+>)"),s=s.replace(/\s+/g,"\\s+");try{if(new RegExp(`^${s}$`,"i").test(e))return!0}catch{}return!!(this.performApiAwareFuzzyMatch(e,t.pattern)||this.performStructuralMatch(e,t.pattern))}catch{return!1}})}performApiAwareFuzzyMatch(e,t){try{let s=l=>l.toLowerCase().replace(/'<[^>]+>'/g,"SCENARIO_PARAM").replace(/"<[^>]+>"/g,"SCENARIO_PARAM").replace(/<[^>]+>/g,"SCENARIO_PARAM").replace(/\{[^}]+\}/g,"CUCUMBER_PARAM").replace(/'[^']*'/g,"QUOTED_STRING").replace(/"[^"]*"/g,"QUOTED_STRING").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim(),i=s(e),n=s(t);if(i===n)return!0;let r=["api","call","request","response","get","post","put","delete","patch","through","aggregator","endpoint"],o=r.filter(l=>i.includes(l)),c=r.filter(l=>n.includes(l));return o.length>0&&c.length>0?o.filter(u=>c.includes(u)).length>0:!1}catch{return!1}}performStructuralMatch(e,t){try{let s=c=>c.toLowerCase().replace(/'<[^>]+>'/g,"").replace(/"<[^>]+>"/g,"").replace(/<[^>]+>/g,"").replace(/\{[^}]+\}/g,"").replace(/'[^']*'/g,"").replace(/"[^"]*"/g,"").split(/\s+/).filter(l=>l.length>2).filter(l=>!["and","the","for","with","from","that"].includes(l)),i=s(e),n=s(t);return i.length===0||n.length===0?!1:i.filter(c=>n.some(l=>c.includes(l)||l.includes(c))).length/Math.max(i.length,n.length)>=.6}catch{return!1}}getAllStepDefinitions(){return[...this.stepDefinitions]}getStepCoverageForFeature(e){try{let s=Fe.readFileSync(e,"utf8").split(`
`),i=[],n=[];for(let r of s){let o=r.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)/);if(o){let c=o[2].trim();i.push(c),this.findMatchingStep(c)||n.push(c)}}return{covered:i.length-n.length,total:i.length,missing:n}}catch(t){return this.outputChannel.appendLine(`\u274C Error analyzing step coverage for ${e}: ${t}`),{covered:0,total:0,missing:[]}}}async validateFeatureFile(e){if(!e.fileName.endsWith(".feature"))return;let t=[],s=e.getText().split(`
`);for(let i=0;i<s.length;i++){let n=s[i],r=n.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)/);if(r){let o=r[2].trim();if(!this.findMatchingStep(o)){let l=new ne.Range(i,0,i,n.length),u=new ne.Diagnostic(l,`No step definition found for: "${o}"`,ne.DiagnosticSeverity.Warning);u.source="playwright-bdd",t.push(u)}}}this.diagnosticCollection.set(e.uri,t)}clearDiagnostics(){this.diagnosticCollection.clear()}dispose(){this.diagnosticCollection.dispose()}};var pi=P(require("vscode")),Vt=P(require("fs")),qt=P(require("path")),Qt=class{constructor(e){this.cacheVersion="1.0.0";this.outputChannel=e,this.cache={version:this.cacheVersion,features:new Map,lastScan:0}}async needsUpdate(e){try{let t=e.fsPath,i=(await Vt.promises.stat(t)).mtime.getTime(),n=this.cache.features.get(t);return n?n.lastModified<i?(this.outputChannel.appendLine(`\u{1F504} File modified: ${qt.basename(t)}`),!0):!1:!0}catch(t){return this.outputChannel.appendLine(`\u26A0\uFE0F Error checking file modification: ${t}`),!0}}getCachedFeature(e){return this.cache.features.get(e.fsPath)}async updateCache(e,t){try{let s=await Vt.promises.stat(e.fsPath);t.lastModified=s.mtime.getTime(),this.cache.features.set(e.fsPath,t),this.outputChannel.appendLine(`\u{1F4BE} Cached feature: ${qt.basename(e.fsPath)}`)}catch(s){this.outputChannel.appendLine(`\u26A0\uFE0F Error updating cache: ${s}`)}}removeFromCache(e){this.cache.features.delete(e.fsPath)&&this.outputChannel.appendLine(`\u{1F5D1}\uFE0F Removed from cache: ${qt.basename(e.fsPath)}`)}async incrementalDiscovery(e,t){let s=Date.now(),i=0,n=0;this.outputChannel.appendLine("\u{1F680} Starting incremental test discovery...");for(let o of e)try{await this.needsUpdate(o)?(await t(o,!1),i++):(await t(o,!0),n++)}catch(c){this.outputChannel.appendLine(`\u274C Error processing ${o.fsPath}: ${c}`)}let r=Date.now()-s;return this.cache.lastScan=Date.now(),this.outputChannel.appendLine(`\u2705 Incremental discovery completed: ${i} processed, ${n} from cache, ${r}ms`),{processed:i,fromCache:n,duration:r}}clearCache(){this.cache.features.clear(),this.cache.lastScan=0,this.outputChannel.appendLine("\u{1F9F9} Test discovery cache cleared")}getCacheStats(){let e=Date.now(),t=Array.from(this.cache.features.values()).filter(s=>e-s.lastModified<3e5);return{totalFeatures:this.cache.features.size,lastScan:this.cache.lastScan>0?new Date(this.cache.lastScan):null,cacheHitRate:this.cache.features.size>0?t.length/this.cache.features.size:0}}async validateAndCleanCache(){let e=Date.now(),t=0;this.outputChannel.appendLine("\u{1F9F9} Validating cache integrity...");for(let[i,n]of this.cache.features.entries())try{await Vt.promises.access(i)}catch{this.cache.features.delete(i),t++}let s=Date.now()-e;this.outputChannel.appendLine(`\u2705 Cache validation completed: ${t} stale entries removed in ${s}ms`)}createCachedItem(e){let t=[];return e.children.forEach(s=>{let i=[];s.children.forEach(n=>{i.push({id:n.id,label:n.label})}),t.push({id:s.id,label:s.label,examples:i.length>0?i:void 0})}),{id:e.id,label:e.label,uri:e.uri?.toString()||"",lastModified:0,scenarios:t}}recreateTestItem(e,t){let s=pi.Uri.parse(e.uri),i=t.createTestItem(e.id,e.label,s);for(let n of e.scenarios){let r=t.createTestItem(n.id,n.label,s);if(i.children.add(r),n.examples)for(let o of n.examples){let c=t.createTestItem(o.id,o.label,s);r.children.add(c)}}return i}};var fi=P(require("path")),Jt=class{constructor(e){this.searchHistory=[];this.outputChannel=e}async searchTests(e,t,s={}){let i=Date.now(),n=[];this.outputChannel.appendLine(`\u{1F50D} Starting advanced search: "${t}"`),this.addToSearchHistory(t);let r=t.toLowerCase().trim();if(!r&&Object.keys(s).length===0)return n;e.items.forEach(c=>{this.searchInTestItem(c,r,s,n)}),n.sort((c,l)=>this.calculateRelevance(l,r)-this.calculateRelevance(c,r));let o=Date.now()-i;return this.outputChannel.appendLine(`\u2705 Search completed in ${o}ms. Found ${n.length} matches.`),n}searchInTestItem(e,t,s,i){let n=this.checkItemMatch(e,t,s);n.length>0&&i.push(...n),e.children.forEach(r=>{this.searchInTestItem(r,t,s,i)})}checkItemMatch(e,t,s){let i=[],n=e.label.toLowerCase(),r=e.uri?.fsPath||"",o=fi.basename(r).toLowerCase();if(s.filePattern&&!o.includes(s.filePattern.toLowerCase())||s.featureName&&!n.includes(s.featureName.toLowerCase())||s.scenarioName&&e.parent&&!n.includes(s.scenarioName.toLowerCase()))return i;if(t&&n.includes(t)){let c=this.determineMatchType(e);i.push({testItem:e,matchType:c,matchText:e.label,filePath:r})}if(s.tags&&s.tags.length>0){let c=this.searchForTags(e,s.tags);i.push(...c)}if(s.stepText){let c=this.searchForSteps(e,s.stepText);i.push(...c)}return i}searchForTags(e,t){let s=[];if(!e.uri)return s;try{let n=require("fs").readFileSync(e.uri.fsPath,"utf8").split(`
`);for(let r=0;r<n.length;r++){let o=n[r].trim();if(o.startsWith("@")){let c=o.split(/\s+/).filter(l=>l.startsWith("@"));for(let l of t){let u=l.startsWith("@")?l:`@${l}`;c.some(p=>p.toLowerCase().includes(u.toLowerCase()))&&s.push({testItem:e,matchType:"tag",matchText:o,filePath:e.uri.fsPath,line:r+1})}}}}catch{}return s}searchForSteps(e,t){let s=[];if(!e.uri)return s;try{let n=require("fs").readFileSync(e.uri.fsPath,"utf8").split(`
`),r=t.toLowerCase();for(let o=0;o<n.length;o++){let c=n[o].trim().toLowerCase();/^\s*(given|when|then|and|but)\s+/i.test(c)&&c.includes(r)&&s.push({testItem:e,matchType:"step",matchText:n[o].trim(),filePath:e.uri.fsPath,line:o+1})}}catch{}return s}determineMatchType(e){return e.parent?(e.children.size>0,"scenario"):"feature"}calculateRelevance(e,t){let s=0,i=e.matchText.toLowerCase();switch(i===t&&(s+=100),i.startsWith(t)&&(s+=50),e.matchType){case"feature":s+=20;break;case"scenario":s+=15;break;case"tag":s+=10;break;case"step":s+=5;break}return s+=Math.max(0,20-i.length),s}async getSearchSuggestions(e,t){let s=new Set,i=t.toLowerCase();return this.searchHistory.filter(n=>n.toLowerCase().includes(i)).forEach(n=>s.add(n)),e.items.forEach(n=>{n.label.toLowerCase().includes(i)&&s.add(n.label),n.children.forEach(r=>{r.label.toLowerCase().includes(i)&&s.add(r.label)})}),Array.from(s).slice(0,10)}buildAdvancedFilter(e){let t={},s=/(\w+):([^\s]+)/g,i;for(;(i=s.exec(e))!==null;){let[,n,r]=i;switch(n.toLowerCase()){case"tag":t.tags||(t.tags=[]),t.tags.push(r);break;case"feature":t.featureName=r;break;case"scenario":t.scenarioName=r;break;case"step":t.stepText=r;break;case"file":t.filePattern=r;break;case"status":t.status=r;break}}return t}exportSearchResults(e){let t=[`# Search Results - ${new Date().toISOString()}`,`Total matches: ${e.length}`,"","## Results",""];return e.forEach((s,i)=>{t.push(`${i+1}. **${s.matchType.toUpperCase()}**: ${s.matchText}`),t.push(`   File: ${s.filePath}`),s.line&&t.push(`   Line: ${s.line}`),t.push("")}),t.join(`
`)}getSearchStats(){return{historySize:this.searchHistory.length,lastSearch:this.searchHistory.length>0?new Date:null}}clearSearchHistory(){this.searchHistory=[],this.outputChannel.appendLine("\u{1F9F9} Search history cleared")}addToSearchHistory(e){e.trim()&&!this.searchHistory.includes(e)&&(this.searchHistory.unshift(e),this.searchHistory.length>50&&(this.searchHistory=this.searchHistory.slice(0,50)))}};var re=P(require("vscode")),gi=P(require("path")),Kt=class{constructor(e,t,s){this.stepDefinitionProvider=e,this.outputChannel=t,this.historyTracker=s}async provideHover(e,t,s){try{let i=e.lineAt(t),n=this.analyzeHoverContext(i,t.line,e);if(!n)return;let r=this.buildHoverContent(n);if(r.length===0)return;let o=new re.Range(new re.Position(t.line,0),new re.Position(t.line,i.text.length));return new re.Hover(r,o)}catch(i){this.outputChannel.appendLine(`[ERROR] Hover provider failed: ${i}`);return}}analyzeHoverContext(e,t,s){let n=e.text.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)$/i);if(!n)return;let[,r,o]=n,c=o.trim(),l=this.stepDefinitionProvider.findMatchingStep(c),u={stepText:c,stepType:r,lineNumber:t+1,hasDefinition:!!l};if(l)u.definitionFile=l.file,u.definitionLine=l.line,u.stepFunction=l.function,u.parameters=this.extractParameters(c,l.pattern);else{let p=this.stepDefinitionProvider.getAllStepDefinitions();u.suggestions=this.findSimilarSteps(c,p).slice(0,3)}return u.scenarioContext=this.extractScenarioContext(s,t),u.tags=this.extractTags(s,t),u.executionHistory=this.getExecutionHistory(c),u}buildHoverContent(e){let t=[];if(e.hasDefinition&&e.definitionFile&&e.definitionLine){let s=new re.MarkdownString;if(s.isTrusted=!0,s.supportHtml=!0,s.appendMarkdown(`### \u2705 Step Definition Found

`),s.appendMarkdown(`**Step:** \`${e.stepText}\`

`),s.appendMarkdown(`**Type:** ${e.stepType}

`),s.appendMarkdown(`**Location:** ${gi.basename(e.definitionFile)}:${e.definitionLine}

`),e.stepFunction&&s.appendMarkdown(`**Function:** \`${e.stepFunction}\`

`),e.parameters&&e.parameters.length>0&&(s.appendMarkdown(`**Parameters:**
`),e.parameters.forEach(i=>{let n=i.type?` (${i.type})`:"";s.appendMarkdown(`- \`${i.name}\`: "${i.value}"${n}
`)}),s.appendMarkdown(`
`)),e.scenarioContext&&(s.appendMarkdown(`**Context:**
`),e.scenarioContext.featureName&&s.appendMarkdown(`- Feature: ${e.scenarioContext.featureName}
`),e.scenarioContext.scenarioName&&s.appendMarkdown(`- Scenario: ${e.scenarioContext.scenarioName}
`),e.scenarioContext.isOutline&&s.appendMarkdown(`- Type: Scenario Outline
`),s.appendMarkdown(`
`)),e.executionHistory?.lastRun&&this.historyTracker){let i=this.historyTracker.getStepHistory(e.stepText);if(i){let n=i.totalRuns>0?i.successCount/i.totalRuns*100:0,r=n>=90?"\u2705":n>=70?"\u26A0\uFE0F":"\u274C",o=e.executionHistory.success?"Passed":"Failed";s.appendMarkdown(`**Execution Stats:** ${r} ${Math.round(n)}% success rate
`),s.appendMarkdown(`- Last Run: ${o} (${e.executionHistory.duration}ms)
`),s.appendMarkdown(`- Total Runs: ${i.totalRuns} (\u2705 ${i.successCount} | \u274C ${i.failureCount})
`),s.appendMarkdown(`- Avg Duration: ${i.avgDuration}ms

`)}}e.tags&&e.tags.length>0&&s.appendMarkdown(`**Tags:** ${e.tags.map(i=>`\`${i}\``).join(", ")}

`),s.appendMarkdown(`[Go to Definition](command:vscode.open?${encodeURIComponent(JSON.stringify([re.Uri.file(e.definitionFile),{selection:new re.Range(e.definitionLine-1,0,e.definitionLine-1,0)}]))})`),t.push(s)}else{let s=new re.MarkdownString;s.isTrusted=!0,s.appendMarkdown(`### \u274C Step Definition Missing

`),s.appendMarkdown(`**Step:** \`${e.stepText}\`

`),s.appendMarkdown(`**Type:** ${e.stepType}

`),s.appendMarkdown(`\u26A0\uFE0F No matching step definition found.

`),e.suggestions&&e.suggestions.length>0&&(s.appendMarkdown(`**Similar steps found:**

`),e.suggestions.forEach((i,n)=>{s.appendMarkdown(`${n+1}. \`${i}\`
`)}),s.appendMarkdown(`
`)),s.appendMarkdown(`**Suggested step definition:**

`),s.appendMarkdown(`\`\`\`typescript
${e.stepType.toLowerCase()}('${e.stepText}', async () => {
  // TODO: Implement step
});
\`\`\`

`),s.appendMarkdown("\u{1F4A1} Create a step definition in your steps folder to resolve this."),t.push(s)}return t}extractParameters(e,t){let s=[];try{let i=[{regex:/\{([^}]+)\}/g,type:"variable"},{regex:/\<([^>]+)\>/g,type:"placeholder"},{regex:/"([^"]+)"/g,type:"string"},{regex:/'([^']+)'/g,type:"string"},{regex:/\b(\d+(?:\.\d+)?)\b/g,type:"number"}],n=0;for(let r of i){let o,c=new RegExp(r.regex.source,"g");for(;(o=c.exec(e))!==null;)s.push({name:r.type==="variable"||r.type==="placeholder"?o[1]:`param${n++}`,value:o[1]||o[0],type:r.type})}}catch{}return s}extractScenarioContext(e,t){let s=e.getText().split(`
`),i,n,r=!1;for(let o=t;o>=0;o--){let c=s[o].trim();if(!n){let l=c.match(/^\s*Scenario(?: Outline)?:\s*(.+)/);l&&(n=l[1].trim(),r=c.includes("Outline"))}if(!i){let l=c.match(/^\s*Feature:\s*(.+)/);if(l){i=l[1].trim();break}}}return i||n?{featureName:i,scenarioName:n,isOutline:r}:void 0}extractTags(e,t){let s=e.getText().split(`
`),i=[];for(let n=t-1;n>=0;n--){let r=s[n].trim();if(r.startsWith("@")){let o=r.split(/\s+/).filter(c=>c.startsWith("@"));i.unshift(...o)}else if(r!==""&&!r.startsWith("#"))break}return i}getExecutionHistory(e){if(!this.historyTracker)return;let t=this.historyTracker.getStepHistory(e);if(t)return{lastRun:new Date(t.lastRun),success:t.lastResult==="success",duration:t.lastDuration}}findSimilarSteps(e,t){let s=e.toLowerCase(),i=[];for(let n of t){let r=n.pattern.toLowerCase(),o=this.calculateWordSimilarity(s,r),c=this.calculateEditDistance(s,r),l=this.calculateStructureSimilarity(s,r),u=o*.4+c*.3+l*.3,p=this.historyTracker?.getStepHistory(n.pattern),f=p?p.totalRuns:0;u>.3&&i.push({pattern:n.pattern,score:u,popularity:f})}return i.sort((n,r)=>Math.abs(r.score-n.score)>.1?r.score-n.score:r.popularity-n.popularity).map(n=>n.pattern)}calculateWordSimilarity(e,t){let s=e.split(/\s+/).filter(o=>o.length>2),i=t.split(/\s+/).filter(o=>o.length>2),n=0;for(let o of s)i.some(c=>c.includes(o)||o.includes(c))&&n++;let r=Math.max(s.length,i.length);return r>0?n/r:0}calculateEditDistance(e,t){let s=e.length,i=t.length;if(s===0)return i===0?1:0;if(i===0)return 0;let n=Math.max(s,i),r=0;for(let o=0;o<Math.min(s,i);o++)e[o]!==t[o]&&r++;return r+=Math.abs(s-i),1-r/n}calculateStructureSimilarity(e,t){let s=r=>r.replace(/\{[^}]+\}/g,"PARAM").replace(/<[^>]+>/g,"PARAM").replace(/["'][^"']*["']/g,"STRING").replace(/\d+/g,"NUM"),i=s(e),n=s(t);return i===n?1:this.calculateWordSimilarity(i,n)}};var wt=P(require("vscode")),he=P(require("fs")),_e=P(require("path")),Yt=class{constructor(e,t){this.isDirty=!1;this.enabled=!0;this.context=e,this.outputChannel=t,this.history={version:"1.0",steps:{}};let s=wt.workspace.workspaceFolders?.[0];if(s){let i=_e.join(s.uri.fsPath,".vscode");this.historyFile=_e.join(i,"bdd-execution-history.json")}else this.historyFile=_e.join(e.globalStorageUri.fsPath,"execution-history.json")}async initialize(){let e=wt.workspace.getConfiguration("playwrightBdd.executionHistory");if(this.enabled=e.get("enabled",!0),!this.enabled){this.outputChannel.appendLine("[History] Execution history tracking is disabled");return}try{await this.load(),this.outputChannel.appendLine(`[History] Initialized with ${Object.keys(this.history.steps).length} tracked steps`),await this.cleanOldEntries(),this.setupAutoSave()}catch(t){this.outputChannel.appendLine(`[History] Failed to initialize: ${t}`)}}async load(){try{if(he.existsSync(this.historyFile)){let e=he.readFileSync(this.historyFile,"utf8");this.history=JSON.parse(e),this.outputChannel.appendLine(`[History] Loaded from ${this.historyFile}`)}else this.outputChannel.appendLine("[History] No existing history file, starting fresh")}catch(e){this.outputChannel.appendLine(`[History] Failed to load: ${e}`),this.history={version:"1.0",steps:{}}}}async save(){if(!(!this.enabled||!this.isDirty))try{let e=_e.dirname(this.historyFile);he.existsSync(e)||he.mkdirSync(e,{recursive:!0}),he.writeFileSync(this.historyFile,JSON.stringify(this.history,null,2),"utf8"),this.isDirty=!1,this.outputChannel.appendLine("[History] Saved to disk")}catch(e){this.outputChannel.appendLine(`[History] Failed to save: ${e}`)}}setupAutoSave(){this.context.subscriptions.push({dispose:()=>{if(this.saveTimeout&&clearTimeout(this.saveTimeout),this.isDirty)try{let e=_e.dirname(this.historyFile);he.existsSync(e)||he.mkdirSync(e,{recursive:!0}),he.writeFileSync(this.historyFile,JSON.stringify(this.history,null,2),"utf8")}catch{}}})}recordStepExecution(e,t,s,i){if(!this.enabled)return;let r=wt.workspace.getConfiguration("playwrightBdd.executionHistory").get("maxEntriesPerStep",10),o=this.history.steps[e];o||(o={stepText:e,totalRuns:0,successCount:0,failureCount:0,skippedCount:0,lastRun:new Date().toISOString(),lastResult:t,lastDuration:s,avgDuration:s,recentRuns:[]},this.history.steps[e]=o),o.totalRuns++,t==="success"?o.successCount++:t==="failure"?o.failureCount++:o.skippedCount++,o.lastRun=new Date().toISOString(),o.lastResult=t,o.lastDuration=s;let c=o.recentRuns.reduce((p,f)=>p+f.duration,0)+s,l=o.recentRuns.length+1;o.avgDuration=Math.round(c/l);let u={timestamp:new Date().toISOString(),result:t,duration:s,feature:i?.feature,scenario:i?.scenario,error:i?.error};o.recentRuns.unshift(u),o.recentRuns.length>r&&(o.recentRuns=o.recentRuns.slice(0,r)),this.isDirty=!0,this.scheduleSave()}scheduleSave(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{this.save()},2e3)}getStepHistory(e){return this.history.steps[e]}getAllHistory(){return Object.values(this.history.steps)}getTopSteps(e=10){return Object.values(this.history.steps).sort((t,s)=>s.totalRuns-t.totalRuns).slice(0,e)}getRecentlyFailedSteps(e=10){return Object.values(this.history.steps).filter(t=>t.lastResult==="failure").sort((t,s)=>new Date(s.lastRun).getTime()-new Date(t.lastRun).getTime()).slice(0,e)}async cleanOldEntries(){let t=wt.workspace.getConfiguration("playwrightBdd.executionHistory").get("retentionDays",30),s=new Date;s.setDate(s.getDate()-t);let i=0;for(let n in this.history.steps){let r=this.history.steps[n];new Date(r.lastRun)<s&&(delete this.history.steps[n],i++)}i>0&&(this.outputChannel.appendLine(`[History] Cleaned ${i} old entries`),this.isDirty=!0,await this.save())}async clearHistory(){this.history.steps={},this.isDirty=!0,await this.save(),this.outputChannel.appendLine("[History] Cleared all history")}exportHistory(){return JSON.stringify(this.history,null,2)}getStatistics(){let e=Object.values(this.history.steps),t=e.length,s=e.reduce((o,c)=>o+c.totalRuns,0),i=e.reduce((o,c)=>o+c.successCount,0),n=e.reduce((o,c)=>o+c.failureCount,0),r=s>0?i/s:0;return{totalSteps:t,totalRuns:s,totalSuccesses:i,totalFailures:n,avgSuccessRate:r}}};var V=P(require("vscode")),oe=P(require("path")),We=P(require("fs")),Ue=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async discoverProjectConfiguration(){let e={};this.outputChannel.appendLine("\u{1F50D} Starting auto-discovery of project configuration...");try{let t=await this.discoverPlaywrightConfig();return e.playwrightConfig=t.length>0?t[0]:void 0,e.featureFolder=await this.discoverFeatureFolder(),e.stepsFolder=await this.discoverStepsFolder(),e.tsconfigPath=await this.discoverTsconfig(),e.hasPlaywrightBdd=await this.checkPlaywrightBddDependency(),e.packageJsonExists=await this.checkPackageJson(),this.logDiscoveryResults(e),e}catch(t){return this.outputChannel.appendLine(`\u274C Auto-discovery failed: ${t}`),e}}async discoverPlaywrightConfig(){let e=["playwright.config.js","playwright.config.ts","playwright.config.mjs","playwright.config.mts","playwright.config.cjs","playwright.config.cts"],t=[];this.outputChannel.appendLine("\u{1F50D} Searching for Playwright configs in all workspace folders...");try{for(let i of e){let n=await V.workspace.findFiles(`**/${i}`,"**/node_modules/**");for(let r of n){let o=V.workspace.asRelativePath(r);t.push(o),this.outputChannel.appendLine(`\u{1F4CB} Found Playwright config: ${o}`)}}let s=await this.findConfigsByContent();t.push(...s),t.sort((i,n)=>{let r=i.split("/").length,o=n.split("/").length;return r-o}),this.outputChannel.appendLine(`\u2705 Total Playwright configs found: ${t.length}`)}catch(s){this.outputChannel.appendLine(`\u274C Error during config discovery: ${s}`)}return t}async findConfigsByContent(){let e=[];try{let t=await V.workspace.findFiles("**/*.{js,ts,mjs,mts,cjs,cts}","**/node_modules/**"),s=["defineConfig","@playwright/test","PlaywrightTestConfig","devices:","projects:","testDir:","use:.*baseURL"];for(let i of t)try{let r=(await V.workspace.fs.readFile(i)).toString();if(s.some(c=>new RegExp(c,"i").test(r))){let c=V.workspace.asRelativePath(i);!c.includes("test")&&!c.includes("spec")&&!c.includes("example")&&!e.includes(c)&&(e.push(c),this.outputChannel.appendLine(`\u{1F527} Detected Playwright config by content: ${c}`))}}catch{continue}}catch(t){this.outputChannel.appendLine(`Warning: Content-based config discovery failed: ${t}`)}return e}async discoverFeatureFolder(){this.outputChannel.appendLine("\u{1F50D} Searching for feature folders in all workspace directories...");try{let e=await V.workspace.findFiles("**/*.feature","**/node_modules/**");if(e.length===0){this.outputChannel.appendLine("\u26A0\uFE0F No .feature files found in workspace");return}let t=new Map;for(let o of e){let c=V.workspace.asRelativePath(o),l=oe.dirname(c);t.set(l,(t.get(l)||0)+1),this.outputChannel.appendLine(`\u{1F4CB} Found feature file: ${c}`)}let s="",i=0;for(let[o,c]of t.entries())c>i&&(i=c,s=o);let r=Array.from(t.keys()).sort((o,c)=>{let l=o.split("/").length,u=c.split("/").length,p=t.get(o)||0,f=t.get(c)||0;return p!==f?f-p:l-u})[0]||s;this.outputChannel.appendLine(`\u2705 Selected feature folder: ${r} (${t.get(r)} features)`),this.outputChannel.appendLine("\u{1F4CA} Feature distribution:");for(let[o,c]of t.entries())this.outputChannel.appendLine(`   ${o}: ${c} feature(s)`);return r}catch(e){this.outputChannel.appendLine(`\u274C Error during feature folder discovery: ${e}`);return}}async discoverStepsFolder(){this.outputChannel.appendLine("\u{1F50D} Searching for step definition folders in all workspace directories...");try{let e=await V.workspace.findFiles("**/*.{js,ts,mjs,mts,cjs,cts}","**/node_modules/**");if(e.length===0){this.outputChannel.appendLine("\u26A0\uFE0F No JavaScript/TypeScript files found in workspace");return}let t=[/\b(Given|When|Then|And|But)\s*\(/,/\b(given|when|then|and|but)\s*\(/,/@(Given|When|Then|And|But)/,/(Given|When|Then)\s*\(\s*['"`]/,/axios\.|fetch\(|request\(|http\./,/\.get\(|\.post\(|\.put\(|\.delete\(|\.patch\(/,/api\.|API\.|endpoint|baseURL/,/query\(|execute\(|connection\.|database\./,/\.findOne\(|\.find\(|\.create\(|\.update\(|\.delete\(/,/expect\(|assert\(|should\.|chai\./,/\.toBe\(|\.toEqual\(|\.toMatch\(/,/before\(|after\(|beforeEach\(|afterEach\(/,/describe\(|it\(|test\(/,/playwright-bdd|@cucumber|cucumber/,/defineParameterType|setDefaultTimeout/,/from\s+['"]@cucumber|require\s*\(\s*['"]@cucumber/,/export.*step|module\.exports.*step/i,/export.*Given|export.*When|export.*Then/i,/step.*def|.*steps\.|.*step\./i,/config\.|setup\.|teardown\./,/environment\.|env\.|process\.env/,/utils\.|helpers\.|common\./,/shared\.|base\.|abstract\./,/JSON\.|parse\(|stringify\(/,/\.map\(|\.filter\(|\.reduce\(/,/fs\.|path\.|os\.|crypto\./,/readFile|writeFile|exists|mkdir/,/Date\.|moment\(|dayjs\(/,/setTimeout|setInterval/,/Math\.random|uuid|generate/,/faker\.|chance\./],s=new Map;for(let r of e)try{let c=(await V.workspace.fs.readFile(r)).toString(),l=V.workspace.asRelativePath(r);if(t.some(p=>p.test(c))){let p=oe.dirname(l);s.has(p)||s.set(p,{count:0,files:[]});let f=s.get(p);f.count++,f.files.push(oe.basename(l)),this.outputChannel.appendLine(`\u{1F527} Found step definitions in: ${l}`)}}catch{continue}if(s.size===0){this.outputChannel.appendLine("\u26A0\uFE0F No step definition files found");return}let i="",n=0;for(let[r,o]of s.entries()){let c=r.split("/").length*.1,l=o.count-c;l>n&&(n=l,i=r)}this.outputChannel.appendLine(`\u2705 Selected steps folder: ${i} (${s.get(i)?.count} step files)`),this.outputChannel.appendLine("\u{1F4CA} Step definition distribution:");for(let[r,o]of s.entries())this.outputChannel.appendLine(`   ${r}: ${o.count} file(s) [${o.files.join(", ")}]`);return i}catch(e){this.outputChannel.appendLine(`\u274C Error during step folder discovery: ${e}`);return}}async discoverTsconfig(){let e=["tsconfig.json","tests/tsconfig.json","e2e/tsconfig.json","test/tsconfig.json","tsconfig.test.json"];for(let t of e){let s=oe.join(this.workspaceRoot,t);if(await this.fileExists(s)&&t!=="tsconfig.json")return this.outputChannel.appendLine(`\u2705 Found tsconfig: ${t}`),`./${t}`}}async checkPlaywrightBddDependency(){let e=oe.join(this.workspaceRoot,"package.json");if(await this.fileExists(e))try{let t=await this.readFileContent(e),s=JSON.parse(t);if(s.dependencies&&s.dependencies["playwright-bdd"]||s.devDependencies&&s.devDependencies["playwright-bdd"])return this.outputChannel.appendLine("\u2705 Found playwright-bdd dependency"),!0}catch(t){this.outputChannel.appendLine(`\u26A0\uFE0F Error reading package.json: ${t}`)}return this.outputChannel.appendLine("\u26A0\uFE0F playwright-bdd dependency not found"),!1}async checkPackageJson(){let e=oe.join(this.workspaceRoot,"package.json");return await this.fileExists(e)}async applyDiscoveredConfiguration(e){let t=V.workspace.getConfiguration("playwrightBdd"),s=[];if(e.playwrightConfig&&t.get("configPath")==="./playwright.config.ts"&&s.push({key:"configPath",value:e.playwrightConfig,discovered:e.playwrightConfig}),e.featureFolder&&t.get("featureFolder")==="features"&&s.push({key:"featureFolder",value:e.featureFolder,discovered:e.featureFolder}),e.stepsFolder&&t.get("stepsFolder")==="steps"&&s.push({key:"stepsFolder",value:e.stepsFolder,discovered:e.stepsFolder}),e.tsconfigPath&&!t.get("tsconfigPath")&&s.push({key:"tsconfigPath",value:e.tsconfigPath,discovered:e.tsconfigPath}),s.length>0){this.outputChannel.appendLine(`
\u{1F527} Applying discovered configuration...`);for(let i of s)await t.update(i.key,i.value,V.ConfigurationTarget.Workspace),this.outputChannel.appendLine(`   ${i.key}: ${i.discovered}`);V.window.showInformationMessage(`Auto-discovered and applied ${s.length} configuration settings. Check Playwright BDD settings for details.`)}else this.outputChannel.appendLine("\u2139\uFE0F No configuration updates needed")}async validateConfiguration(){let e=[],t=V.workspace.getConfiguration("playwrightBdd"),s=t.get("configPath");if(s){let r=oe.join(this.workspaceRoot,s);await this.fileExists(r)||e.push(`Playwright config not found: ${s}`)}let i=t.get("featureFolder");if(i){let r=oe.join(this.workspaceRoot,i);await this.directoryExists(r)||e.push(`Feature folder not found: ${i}`)}let n=t.get("stepsFolder");if(n){let r=oe.join(this.workspaceRoot,n);await this.directoryExists(r)||e.push(`Steps folder not found: ${n}`)}return{valid:e.length===0,issues:e}}async fileExists(e){try{return await We.promises.access(e,We.constants.F_OK),!0}catch{return!1}}async directoryExists(e){try{return(await We.promises.stat(e)).isDirectory()}catch{return!1}}async hasFeatureFiles(e){try{return(await We.promises.readdir(e,{withFileTypes:!0})).some(s=>s.isFile()&&s.name.endsWith(".feature")||s.isDirectory()&&s.name!=="node_modules")}catch{return!1}}async hasStepDefinitionFiles(e){try{let t=await We.promises.readdir(e,{withFileTypes:!0});for(let s of t)if(s.isFile()&&/\.(js|ts|mjs|mts)$/.test(s.name)){let i=await this.readFileContent(oe.join(e,s.name));if(this.looksLikeStepDefinition(i))return!0}return!1}catch{return!1}}async readFileContent(e){try{return await We.promises.readFile(e,"utf8")}catch{return""}}looksLikeStepDefinition(e){return[/\b(Given|When|Then|And|But)\s*\(/,/\b(given|when|then|and|but)\s*\(/,/@(Given|When|Then|And|But)/,/cucumber\.|@cucumber/,/playwright-bdd/].some(s=>s.test(e))}logDiscoveryResults(e){this.outputChannel.appendLine(`
\u{1F4CB} Auto-discovery results:`),this.outputChannel.appendLine(`   Playwright Config: ${e.playwrightConfig||"Not found"}`),this.outputChannel.appendLine(`   Feature Folder: ${e.featureFolder||"Not found"}`),this.outputChannel.appendLine(`   Steps Folder: ${e.stepsFolder||"Not found"}`),this.outputChannel.appendLine(`   TSConfig: ${e.tsconfigPath||"Not found"}`),this.outputChannel.appendLine(`   Playwright-BDD: ${e.hasPlaywrightBdd?"Installed":"Not found"}`),this.outputChannel.appendLine(`   Package.json: ${e.packageJsonExists?"Found":"Not found"}`)}};var mi=require("events"),Zt=class extends mi.EventEmitter{constructor(t,s=1){super();this.queue=[];this.running=new Map;this.maxConcurrent=1;this.completedItems=[];this.outputChannel=t,this.maxConcurrent=s}addToQueue(t){let s=t.map(i=>({...i,id:this.generateId(),addedAt:new Date,status:"pending"}));s.sort((i,n)=>n.priority-i.priority),this.queue.push(...s),this.outputChannel.appendLine(`\u{1F4CB} Added ${s.length} items to execution queue`),this.emit("queueUpdated",this.getProgress()),this.processQueue()}async startWithProgress(t,s){return this.progressReporter=t,this.currentToken=s,s.onCancellationRequested(()=>{this.cancelAll()}),this.outputChannel.appendLine("\u{1F680} Starting queue execution with progress tracking..."),this.emit("queueStarted"),this.processQueue()}async processQueue(){for(;this.queue.length>0&&this.running.size<this.maxConcurrent&&!this.currentToken?.isCancellationRequested;){let t=this.queue.shift();t&&await this.executeItem(t)}this.queue.length===0&&this.running.size===0&&this.onQueueComplete()}async executeItem(t){t.status="running",t.startedAt=new Date,this.running.set(t.id,t),this.outputChannel.appendLine(`\u25B6\uFE0F Executing: ${t.name}`),this.updateProgress(`Running: ${t.name}`),this.emit("itemStarted",t);try{let s=await this.runCommand(t.command);t.status="completed",t.completedAt=new Date,t.result={success:s.success,duration:Date.now()-(t.startedAt?.getTime()||0),output:s.output,error:s.error},this.outputChannel.appendLine(`\u2705 Completed: ${t.name} (${t.result.duration}ms)`)}catch(s){t.status="failed",t.completedAt=new Date,t.result={success:!1,duration:Date.now()-(t.startedAt?.getTime()||0),output:"",error:s instanceof Error?s.message:String(s)},this.outputChannel.appendLine(`\u274C Failed: ${t.name} - ${t.result.error}`)}this.running.delete(t.id),this.emit("itemCompleted",t),this.emit("queueUpdated",this.getProgress()),this.processQueue()}async runCommand(t){return new Promise(s=>{setTimeout(()=>{let i=Math.random()>.1;s({success:i,output:i?"Test passed":"Test failed",error:i?void 0:"Simulated test failure"})},Math.random()*2e3+500)})}updateProgress(t){if(this.progressReporter){let s=this.getProgress();this.progressReporter.report({message:`${t} (${s.completed}/${s.total})`,increment:s.percentage})}}getProgress(){let t=this.getCompletedItems().length,s=this.running.size,i=this.queue.length,n=this.getFailedItems().length,r=t+s+i,o={total:r,completed:t,running:s,pending:i,failed:n,percentage:r>0?t/r*100:0};if(s>0||i>0){let c=this.getCompletedItems();if(c.length>0){let l=c.reduce((u,p)=>u+(p.result?.duration||0),0)/c.length;o.estimatedTimeRemaining=Math.round((i+s)*l/Math.max(1,this.maxConcurrent))}}return o}getAllItems(){return[...Array.from(this.running.values()),...this.getCompletedItems(),...this.queue]}getCompletedItems(){return this.completedItems||[]}getFailedItems(){return this.getCompletedItems().filter(t=>!t.result?.success)}cancelAll(){this.outputChannel.appendLine("\u{1F6D1} Cancelling all queue items..."),this.queue.forEach(t=>{t.status="cancelled",t.completedAt=new Date}),this.queue=[],this.running.forEach(t=>{t.status="cancelled",t.completedAt=new Date,this.completedItems.push(t)}),this.running.clear(),this.emit("queueCancelled"),this.emit("queueUpdated",this.getProgress())}pause(){this.outputChannel.appendLine("\u23F8\uFE0F Queue execution paused"),this.emit("queuePaused")}resume(){this.outputChannel.appendLine("\u25B6\uFE0F Queue execution resumed"),this.emit("queueResumed"),this.processQueue()}clearCompleted(){this.completedItems=[],this.outputChannel.appendLine("\u{1F9F9} Cleared completed items"),this.emit("queueUpdated",this.getProgress())}retryFailed(){let t=this.getFailedItems();if(t.length===0){this.outputChannel.appendLine("\u2139\uFE0F No failed items to retry");return}let s=t.map(i=>({type:i.type,name:`${i.name} (retry)`,command:i.command,testItem:i.testItem,priority:i.priority+1}));this.addToQueue(s),this.outputChannel.appendLine(`\u{1F504} Added ${s.length} failed items for retry`)}setMaxConcurrent(t){this.maxConcurrent=Math.max(1,t),this.outputChannel.appendLine(`\u2699\uFE0F Max concurrent executions set to ${this.maxConcurrent}`),this.queue.length>0&&this.processQueue()}getStatistics(){let t=this.getCompletedItems(),s=t.filter(n=>n.result?.success),i=t.map(n=>n.result?.duration||0).filter(n=>n>0);return{totalExecuted:t.length,successRate:t.length>0?s.length/t.length*100:0,averageDuration:i.length>0?i.reduce((n,r)=>n+r,0)/i.length:0,fastestExecution:i.length>0?Math.min(...i):0,slowestExecution:i.length>0?Math.max(...i):0}}exportResults(){let t=this.getAllItems(),s=this.getStatistics(),i=[`# Test Execution Queue Report - ${new Date().toISOString()}`,"","## Summary",`- Total Items: ${t.length}`,`- Success Rate: ${s.successRate.toFixed(2)}%`,`- Average Duration: ${s.averageDuration.toFixed(0)}ms`,`- Fastest: ${s.fastestExecution}ms`,`- Slowest: ${s.slowestExecution}ms`,"","## Items",""];return t.forEach((n,r)=>{let o=n.result?.duration?`${n.result.duration}ms`:"N/A",c=n.status.toUpperCase();i.push(`${r+1}. **${c}**: ${n.name} (${o})`),n.result?.error&&i.push(`   Error: ${n.result.error}`),i.push("")}),i.join(`
`)}onQueueComplete(){let t=this.getStatistics();this.outputChannel.appendLine(`
\u{1F389} Queue execution completed!`),this.outputChannel.appendLine(`   Total: ${t.totalExecuted}`),this.outputChannel.appendLine(`   Success Rate: ${t.successRate.toFixed(2)}%`),this.outputChannel.appendLine(`   Average Duration: ${t.averageDuration.toFixed(0)}ms`),this.emit("queueCompleted",t),this.progressReporter&&this.progressReporter.report({message:`Completed ${t.totalExecuted} tests (${t.successRate.toFixed(1)}% success)`,increment:100})}generateId(){return`queue_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}};var B=P(require("vscode")),Ce=P(require("path")),Be=P(require("fs")),Xt=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async launchWizard(e){try{this.outputChannel.appendLine("\u{1F9D9}\u200D\u2642\uFE0F Launching Step Creation Wizard...");let t=e||await this.getStepText();if(!t)return;let s=this.analyzeStepText(t),i=await this.getCreationOptions();if(!i)return;let n=await this.createStepTemplate(s,i);if(!await this.showPreviewAndConfirm(n,i))return;await this.generateStepDefinition(n,i),B.window.showInformationMessage("\u2705 Step definition created successfully!")}catch(t){this.outputChannel.appendLine(`\u274C Step creation failed: ${t}`),B.window.showErrorMessage(`Failed to create step definition: ${t}`)}}async createFromMissingStep(e,t){this.outputChannel.appendLine(`\u{1F527} Creating step definition for missing step: ${e}`);let s={stepType:t,originalText:e,cleanText:e,parameters:this.extractParametersFromText(e),suggestedFunctionName:this.generateFunctionName(e)},i=await this.getQuickCreationOptions();if(!i)return;let n=await this.createStepTemplate(s,i);await this.generateStepDefinition(n,i),B.window.showInformationMessage("\u2705 Step definition created from missing step!")}async getStepText(){return await B.window.showInputBox({prompt:'Enter the step text (e.g., "I click on the login button")',placeHolder:"Step text...",validateInput:e=>{if(!e.trim())return"Step text cannot be empty"}})}analyzeStepText(e){let t=this.determineStepType(e),s=e.replace(/^(Given|When|Then|And|But)\s+/i,"").trim(),i=this.extractParametersFromText(s),n=this.generateFunctionName(s);return{stepType:t,originalText:e,cleanText:s,parameters:i,suggestedFunctionName:n}}determineStepType(e){let t=e.toLowerCase();return t.includes("given")||t.includes("assume")||t.includes("setup")?"Given":t.includes("when")||t.includes("click")||t.includes("enter")||t.includes("select")?"When":"Then"}extractParametersFromText(e){let t=[];return(e.match(/"([^"]+)"/g)||[]).forEach((n,r)=>{let o=n.slice(1,-1);t.push({name:`text${r+1}`,type:"string",value:o})}),(e.match(/\b\d+(\.\d+)?\b/g)||[]).forEach((n,r)=>{t.push({name:`number${r+1}`,type:"number",value:n})}),t}generateFunctionName(e){return e.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").split(/\s+/).filter(t=>t.length>0).map((t,s)=>s===0?t:t.charAt(0).toUpperCase()+t.slice(1)).join("").replace(/^\d/,"step$&")}async getCreationOptions(){let e=await B.window.showQuickPick(["typescript","javascript"],{placeHolder:"Select language for step definition"});if(!e)return;let t=await B.window.showQuickPick(["playwright-bdd","cucumber","generic"],{placeHolder:"Select testing framework"});if(!t)return;let s=await this.selectTargetFile(e);if(s)return{targetFile:s,language:e,framework:t,addImports:!0,addComments:!0}}async getQuickCreationOptions(){let t=B.workspace.getConfiguration("playwrightBdd").get("stepsFolder","steps"),s=await this.findStepFiles(),i;if(s.length>0){let n=[...s.map(o=>({label:Ce.basename(o),detail:o})),{label:"$(plus) Create new file",detail:"new"}],r=await B.window.showQuickPick(n,{placeHolder:"Select target file for step definition"});if(!r)return;r.detail==="new"?i=await this.createNewStepFile(t):i=r.detail}else i=await this.createNewStepFile(t);return{targetFile:i,language:"typescript",framework:"playwright-bdd",addImports:!0,addComments:!1}}async selectTargetFile(e){let s=[...(await this.findStepFiles()).map(n=>({label:Ce.basename(n),detail:n,description:"Existing file"})),{label:"$(plus) Create new file",detail:"new",description:"Create a new step definition file"}],i=await B.window.showQuickPick(s,{placeHolder:"Select target file for step definition"});if(i){if(i.detail==="new"){let r=B.workspace.getConfiguration("playwrightBdd").get("stepsFolder","steps");return await this.createNewStepFile(r)}return i.detail}}async findStepFiles(){let e=B.workspace.getConfiguration("playwrightBdd"),t=e.get("stepsFolder","steps"),s=e.get("stepsFilePattern","**/*.{js,ts,mjs,mts}");try{return(await B.workspace.findFiles(`${t}/${s}`,"**/node_modules/**",50)).map(n=>n.fsPath)}catch{return[]}}async createNewStepFile(e){let t=await B.window.showInputBox({prompt:"Enter name for new step definition file",placeHolder:"e.g., loginSteps.ts",value:"newSteps.ts",validateInput:i=>{if(!i.trim())return"File name cannot be empty";if(!/\.(ts|js|mjs|mts)$/.test(i))return"File must have .ts, .js, .mjs, or .mts extension"}});if(!t)throw new Error("File name is required");let s=Ce.join(this.workspaceRoot,e,t);return await Be.promises.mkdir(Ce.dirname(s),{recursive:!0}),s}async createStepTemplate(e,t){return{stepType:e.stepType,stepText:e.cleanText,functionName:e.suggestedFunctionName,parameters:e.parameters.map(i=>({name:i.name,type:i.type,defaultValue:i.value})),hasDataTable:!1,hasDocString:!1,implementation:this.generateImplementation(e,t)}}generateImplementation(e,t){let{language:s,framework:i}=t,n=s==="typescript",r="";return i==="playwright-bdd"?(r=`// TODO: Implement step logic
`,r+="await page.pause(); // Remove this line and add your implementation"):i==="cucumber"?(r=`// TODO: Implement step logic
`,r+='throw new Error("Step not implemented");'):r="// TODO: Implement step logic",r}async showPreviewAndConfirm(e,t){let s=this.generateStepCode(e,t),i=await B.workspace.openTextDocument({content:s,language:t.language});return await B.window.showTextDocument(i,{preview:!0}),await B.window.showInformationMessage("Preview the step definition. Do you want to create it?","Create Step","Cancel")==="Create Step"}generateStepCode(e,t){let{language:s,framework:i,addImports:n,addComments:r}=t,o=s==="typescript",c="";n&&(i==="playwright-bdd"||i==="cucumber"&&(c+=`import { ${e.stepType} } from '@cucumber/cucumber';
`),c+=`
`),r&&(c+=`/**
 * ${e.stepType}: ${e.stepText}
`,e.parameters.length>0&&e.parameters.forEach(p=>{c+=` * @param {${p.type}} ${p.name}
`}),c+=` */
`);let l=e.parameters.map(p=>o?`${p.name}: ${p.type}`:p.name).join(", "),u=this.createStepPattern(e.stepText,e.parameters);return i==="playwright-bdd"?c+=`${e.stepType}('${u}', async ({ page }${l?`, ${l}`:""}) => {
`:c+=`${e.stepType}('${u}', async (${l}) => {
`,c+="  "+e.implementation.replace(/\n/g,`
  `)+`
`,c+=`});
`,c}createStepPattern(e,t){let s=e;return s=s.replace(/'[^']+'/g,"{string}"),s=s.replace(/"[^"]+"/g,"{string}"),s=s.replace(/\b\d+\.\d+\b/g,"{float}"),s=s.replace(/\b\d+\b/g,"{int}"),s}async generateStepDefinition(e,t){let s=this.generateStepCode(e,t),i=Ce.normalize(t.targetFile);this.outputChannel.appendLine(`Checking if file exists: ${i}`);let n=!1;try{n=Be.existsSync(i)}catch(o){this.outputChannel.appendLine(`Error checking file existence: ${o}`),n=!1}if(this.outputChannel.appendLine(`File exists: ${n}`),n){let c=await Be.promises.readFile(i,"utf8")+`
`+s;await Be.promises.writeFile(i,c)}else{let o="";t.addImports&&t.framework==="playwright-bdd"&&(o+=`import { createBdd } from 'playwright-bdd';
`,o+=`const { Given, When, Then } = createBdd();
`,o+=`
`),o+=s,await Be.promises.writeFile(i,o)}let r=await B.workspace.openTextDocument(i);await B.window.showTextDocument(r),this.outputChannel.appendLine(`\u2705 Step definition created in: ${i}`)}async createStepsFromFeature(e){try{this.outputChannel.appendLine(`\u{1F50D} Analyzing feature file: ${Ce.basename(e.fsPath)}`);let t=await Be.promises.readFile(e.fsPath,"utf8"),s=this.findMissingSteps(t);if(s.length===0){B.window.showInformationMessage("No missing steps found in this feature file.");return}if(await B.window.showInformationMessage(`Found ${s.length} missing steps. Create all step definitions?`,"Create All","Cancel")==="Create All"){let n=await this.getQuickCreationOptions();if(!n)return;for(let r of s){let o=this.analyzeStepText(r),c=await this.createStepTemplate(o,n);await this.generateStepDefinition(c,n)}B.window.showInformationMessage(`\u2705 Created ${s.length} step definitions!`)}}catch(t){this.outputChannel.appendLine(`\u274C Failed to create steps from feature: ${t}`),B.window.showErrorMessage(`Failed to create steps: ${t}`)}}findMissingSteps(e){let t=e.split(`
`),s=[];for(let i of t){let n=i.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)$/);if(n){let r=`${n[1]} ${n[2]}`;s.includes(r)||s.push(r)}}return s}};var q=P(require("vscode")),es=P(require("path")),wi=require("events"),ts=class extends wi.EventEmitter{constructor(t,s){super();this.breakpoints=new Map;this.activeSessions=new Map;this.outputChannel=t,this.workspaceRoot=s,this.debugConfigProvider=new Ws}register(t){t.subscriptions.push(q.debug.registerDebugConfigurationProvider("bdd-playwright",this.debugConfigProvider)),t.subscriptions.push(q.debug.onDidChangeBreakpoints(this.onBreakpointsChanged.bind(this))),t.subscriptions.push(q.debug.onDidStartDebugSession(this.onDebugSessionStarted.bind(this)),q.debug.onDidTerminateDebugSession(this.onDebugSessionTerminated.bind(this))),this.outputChannel.appendLine("\u{1F41B} BDD Debugging Tools registered")}async startStepByStepDebugging(t,s){try{this.outputChannel.appendLine(`\u{1F50D} Starting step-by-step debugging: ${s}`);let i=this.generateSessionId(),n={sessionId:i,featureFile:t,scenario:s,status:"stopped",variables:new Map,callStack:[],breakpoints:Array.from(this.breakpoints.values())};this.activeSessions.set(i,n);let r={type:"bdd-playwright",request:"launch",name:`Debug BDD Scenario: ${s}`,program:"${workspaceFolder}/node_modules/.bin/playwright",args:["test","--config=playwright.config.ts","--debug",`--grep="${s}"`],cwd:"${workspaceFolder}",env:{PWDEBUG:"1",BDD_DEBUG_MODE:"step-by-step",BDD_SESSION_ID:i},console:"integratedTerminal",internalConsoleOptions:"openOnSessionStart"};if(await q.debug.startDebugging(void 0,r))this.emit("debugSessionStarted",n),this.showDebugPanel(n);else throw this.activeSessions.delete(i),new Error("Failed to start debug session")}catch(i){this.outputChannel.appendLine(`\u274C Debug start failed: ${i}`),q.window.showErrorMessage(`Failed to start debugging: ${i}`)}}async toggleBreakpoint(t,s,i){let n=`${t}:${s}`;if(this.breakpoints.has(n))this.breakpoints.delete(n),this.outputChannel.appendLine(`\u{1F534} Removed breakpoint: ${i} (${es.basename(t)}:${s})`);else{let r={id:n,file:t,line:s,stepText:i,enabled:!0,hitCount:0};this.breakpoints.set(n,r),this.outputChannel.appendLine(`\u{1F7E2} Added breakpoint: ${i} (${es.basename(t)}:${s})`)}this.emit("breakpointsChanged",Array.from(this.breakpoints.values())),this.updateBreakpointsInEditor()}async setConditionalBreakpoint(t,s,i,n){let r=`${t}:${s}`,o={id:r,file:t,line:s,stepText:i,condition:n,enabled:!0,hitCount:0};this.breakpoints.set(r,o),this.outputChannel.appendLine(`\u{1F535} Added conditional breakpoint: ${i} (${n})`),this.emit("breakpointsChanged",Array.from(this.breakpoints.values())),this.updateBreakpointsInEditor()}async setLogPoint(t,s,i,n){let r=`${t}:${s}`,o={id:r,file:t,line:s,stepText:i,logMessage:n,enabled:!0,hitCount:0};this.breakpoints.set(r,o),this.outputChannel.appendLine(`\u{1F4DD} Added log point: ${i} -> "${n}"`),this.emit("breakpointsChanged",Array.from(this.breakpoints.values())),this.updateBreakpointsInEditor()}async showDebugPanel(t){let s=q.window.createWebviewPanel("bddDebugPanel",`BDD Debug: ${t.scenario}`,q.ViewColumn.Two,{enableScripts:!0,retainContextWhenHidden:!0});s.webview.html=this.getDebugPanelHtml(t),s.webview.onDidReceiveMessage(async i=>{switch(i.command){case"stepOver":await this.stepOver(t.sessionId);break;case"stepInto":await this.stepInto(t.sessionId);break;case"continue":await this.continue(t.sessionId);break;case"pause":await this.pause(t.sessionId);break;case"stop":await this.stop(t.sessionId);break;case"evaluate":await this.evaluateExpression(t.sessionId,i.expression);break}}),this.on("sessionUpdated",i=>{i.sessionId===t.sessionId&&(s.webview.html=this.getDebugPanelHtml(i))})}getDebugPanelHtml(t){let s=t.currentStep,i=Array.from(t.variables.entries());return`
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BDD Debug Panel</title>
        <style>
            body { 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                padding: 20px;
                background: var(--vscode-editor-background);
                color: var(--vscode-editor-foreground);
            }
            .debug-controls {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
                padding: 10px;
                background: var(--vscode-panel-background);
                border-radius: 4px;
            }
            .debug-button {
                padding: 8px 16px;
                background: var(--vscode-button-background);
                color: var(--vscode-button-foreground);
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .debug-button:hover {
                background: var(--vscode-button-hoverBackground);
            }
            .current-step {
                padding: 15px;
                background: var(--vscode-textBlockQuote-background);
                border-left: 4px solid var(--vscode-textLink-foreground);
                margin-bottom: 20px;
                border-radius: 4px;
            }
            .variables {
                background: var(--vscode-panel-background);
                padding: 15px;
                border-radius: 4px;
                margin-bottom: 20px;
            }
            .variable-item {
                display: flex;
                justify-content: space-between;
                padding: 5px 0;
                border-bottom: 1px solid var(--vscode-panel-border);
            }
            .expression-input {
                width: 100%;
                padding: 8px;
                background: var(--vscode-input-background);
                color: var(--vscode-input-foreground);
                border: 1px solid var(--vscode-input-border);
                border-radius: 4px;
                margin-top: 10px;
            }
            .status {
                padding: 10px;
                border-radius: 4px;
                margin-bottom: 20px;
                font-weight: bold;
            }
            .status.running { background: var(--vscode-testing-iconPassed); }
            .status.paused { background: var(--vscode-testing-iconQueued); }
            .status.stopped { background: var(--vscode-testing-iconFailed); }
        </style>
    </head>
    <body>
        <div class="status ${t.status}">
            Status: ${t.status.toUpperCase()}
        </div>

        <div class="debug-controls">
            <button class="debug-button" onclick="sendCommand('continue')">\u25B6\uFE0F Continue</button>
            <button class="debug-button" onclick="sendCommand('stepOver')">\u23ED\uFE0F Step Over</button>
            <button class="debug-button" onclick="sendCommand('stepInto')">\u23EC Step Into</button>
            <button class="debug-button" onclick="sendCommand('pause')">\u23F8\uFE0F Pause</button>
            <button class="debug-button" onclick="sendCommand('stop')">\u23F9\uFE0F Stop</button>
        </div>

        ${s?`
        <div class="current-step">
            <h3>Current Step</h3>
            <p><strong>Step:</strong> ${s.stepText}</p>
            <p><strong>File:</strong> ${es.basename(s.file)}:${s.line}</p>
            <p><strong>Step Index:</strong> ${s.stepIndex}</p>
        </div>
        `:""}

        <div class="variables">
            <h3>Variables</h3>
            ${i.length>0?i.map(([n,r])=>`
                <div class="variable-item">
                    <span>${n}</span>
                    <span>${JSON.stringify(r)}</span>
                </div>
            `).join(""):"<p>No variables available</p>"}
            
            <input type="text" class="expression-input" placeholder="Evaluate expression..." 
                   onkeypress="if(event.key==='Enter') evaluateExpression(this.value)">
        </div>

        <script>
            const vscode = acquireVsCodeApi();
            
            function sendCommand(command) {
                vscode.postMessage({ command });
            }
            
            function evaluateExpression(expression) {
                if (expression.trim()) {
                    vscode.postMessage({ command: 'evaluate', expression });
                }
            }
        </script>
    </body>
    </html>`}async stepOver(t){let s=this.activeSessions.get(t);s&&(this.outputChannel.appendLine("\u23ED\uFE0F Step Over"),this.emit("stepOver",s))}async stepInto(t){let s=this.activeSessions.get(t);s&&(this.outputChannel.appendLine("\u23EC Step Into"),this.emit("stepInto",s))}async continue(t){let s=this.activeSessions.get(t);s&&(s.status="running",this.outputChannel.appendLine("\u25B6\uFE0F Continue"),this.emit("continue",s),this.emit("sessionUpdated",s))}async pause(t){let s=this.activeSessions.get(t);s&&(s.status="paused",this.outputChannel.appendLine("\u23F8\uFE0F Pause"),this.emit("pause",s),this.emit("sessionUpdated",s))}async stop(t){let s=this.activeSessions.get(t);s&&(s.status="stopped",this.outputChannel.appendLine("\u23F9\uFE0F Stop"),this.activeSessions.delete(t),this.emit("stop",s))}async evaluateExpression(t,s){let i=this.activeSessions.get(t);i&&(this.outputChannel.appendLine(`\u{1F50D} Evaluating: ${s}`),this.emit("expressionEvaluated",{session:i,expression:s,result:"TODO: Implement"}))}onBreakpointsChanged(t){t.added.forEach(s=>{s instanceof q.SourceBreakpoint}),t.removed.forEach(s=>{s instanceof q.SourceBreakpoint})}onDebugSessionStarted(t){t.type==="bdd-playwright"&&this.outputChannel.appendLine(`\u{1F680} Debug session started: ${t.name}`)}onDebugSessionTerminated(t){t.type==="bdd-playwright"&&this.outputChannel.appendLine(`\u{1F6D1} Debug session terminated: ${t.name}`)}updateBreakpointsInEditor(){}getBreakpoints(){return Array.from(this.breakpoints.values())}clearAllBreakpoints(){this.breakpoints.clear(),this.outputChannel.appendLine("\u{1F9F9} Cleared all breakpoints"),this.emit("breakpointsChanged",[]),this.updateBreakpointsInEditor()}exportBreakpoints(){let t=Array.from(this.breakpoints.values());return JSON.stringify(t,null,2)}importBreakpoints(t){try{let s=JSON.parse(t);this.breakpoints.clear(),s.forEach(i=>{this.breakpoints.set(i.id,i)}),this.outputChannel.appendLine(`\u{1F4E5} Imported ${s.length} breakpoints`),this.emit("breakpointsChanged",s),this.updateBreakpointsInEditor()}catch(s){this.outputChannel.appendLine(`\u274C Failed to import breakpoints: ${s}`),q.window.showErrorMessage("Failed to import breakpoints")}}generateSessionId(){return`debug_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},Ws=class{resolveDebugConfiguration(e,t,s){if(!t.type&&!t.request&&!t.name){let i=q.window.activeTextEditor;i&&i.document.languageId==="feature"&&(t.type="bdd-playwright",t.name="Debug Current Feature",t.request="launch",t.program="${workspaceFolder}/node_modules/.bin/playwright",t.args=["test","--debug"],t.cwd="${workspaceFolder}",t.env={PWDEBUG:"1"})}if(!t.program){q.window.showErrorMessage("Debug configuration missing program path");return}return t}};var de=P(require("vscode")),ss=P(require("path")),vi=require("events");var is=class extends vi.EventEmitter{constructor(t){super();this.workspaces=new Map;this.workspaceGroups=new Map;this.autoDiscoveryServices=new Map;this.outputChannel=t,this.initialize()}async initialize(){this.outputChannel.appendLine("\u{1F3E2} Initializing Multi-Workspace Manager..."),await this.loadWorkspaceConfigurations(),await this.discoverWorkspaces(),this.setupWorkspaceListeners(),this.outputChannel.appendLine(`\u2705 Multi-Workspace Manager initialized with ${this.workspaces.size} workspaces`)}async discoverWorkspaces(){let t=de.workspace.workspaceFolders;if(!t){this.outputChannel.appendLine("\u2139\uFE0F No workspace folders detected");return}for(let s of t)await this.addWorkspace(s.uri.fsPath,s.name);if(!this.activeWorkspace&&this.workspaces.size>0){let s=Array.from(this.workspaces.keys())[0];await this.setActiveWorkspace(s)}}async addWorkspace(t,s){let i=this.generateWorkspaceId(t);if(this.workspaces.has(i))return this.outputChannel.appendLine(`\u26A0\uFE0F Workspace already exists: ${s||ss.basename(t)}`),i;try{this.outputChannel.appendLine(`\u{1F4C1} Adding workspace: ${s||ss.basename(t)}`);let n=new Ue(this.outputChannel,t);this.autoDiscoveryServices.set(i,n);let r=await n.discoverProjectConfiguration(),o=await this.analyzeWorkspace(t,r),c={id:i,name:s||ss.basename(t),rootPath:t,isActive:!1,configuration:r,lastAccessed:new Date,featureCount:o.featureCount,stepCount:o.stepCount};return this.workspaces.set(i,c),this.emit("workspaceAdded",c),this.outputChannel.appendLine(`\u2705 Added workspace: ${c.name} (${o.featureCount} features, ${o.stepCount} steps)`),i}catch(n){throw this.outputChannel.appendLine(`\u274C Failed to add workspace: ${n}`),n}}async removeWorkspace(t){let s=this.workspaces.get(t);if(!s)throw new Error(`Workspace not found: ${t}`);if(this.workspaces.delete(t),this.autoDiscoveryServices.delete(t),this.activeWorkspace===t){let i=Array.from(this.workspaces.keys());i.length>0?await this.setActiveWorkspace(i[0]):this.activeWorkspace=void 0}this.emit("workspaceRemoved",s),this.outputChannel.appendLine(`\u{1F5D1}\uFE0F Removed workspace: ${s.name}`)}async setActiveWorkspace(t){let s=this.workspaces.get(t);if(!s)throw new Error(`Workspace not found: ${t}`);if(this.activeWorkspace){let i=this.workspaces.get(this.activeWorkspace);i&&(i.isActive=!1)}s.isActive=!0,s.lastAccessed=new Date,this.activeWorkspace=t,this.emit("activeWorkspaceChanged",s),this.outputChannel.appendLine(`\u{1F3AF} Active workspace: ${s.name}`)}getActiveWorkspace(){return this.activeWorkspace?this.workspaces.get(this.activeWorkspace):void 0}getAllWorkspaces(){return Array.from(this.workspaces.values())}async searchAcrossWorkspaces(t,s){let i=[],n=s?.workspaceIds||Array.from(this.workspaces.keys());this.outputChannel.appendLine(`\u{1F50D} Cross-workspace search: "${t}" across ${n.length} workspaces`);for(let r of n){let o=this.workspaces.get(r);if(o)try{let c=await this.searchInWorkspace(o,t,s);i.push(...c)}catch(c){this.outputChannel.appendLine(`\u26A0\uFE0F Search failed in workspace ${o.name}: ${c}`)}}return this.outputChannel.appendLine(`\u{1F4CA} Cross-workspace search completed: ${i.length} results found`),i}async searchInWorkspace(t,s,i){let n=[],r=s.toLowerCase(),c=`${t.configuration.featureFolder||"features"}/**/*.feature`;try{let l=await de.workspace.findFiles(new de.RelativePattern(t.rootPath,c),"**/node_modules/**");for(let u of l)(await de.workspace.fs.readFile(u)).toString().split(`
`).forEach((b,v)=>{if(b.toLowerCase().includes(r)){let k="step";if(b.trim().match(/^\s*Feature:/i)?k="feature":b.trim().match(/^\s*Scenario/i)&&(k="scenario"),i?.includeFeatures===!1&&k==="feature"||i?.includeScenarios===!1&&k==="scenario"||i?.includeSteps===!1&&k==="step")return;n.push({workspaceId:t.id,workspaceName:t.name,filePath:u.fsPath,matchText:b.trim(),matchType:k,line:v+1})}})}catch{}return n}createWorkspaceGroup(t,s,i){let n=this.generateGroupId(),r={id:n,name:t,description:i?.description,workspaces:s,color:i?.color,tags:i?.tags||[]};return this.workspaceGroups.set(n,r),this.emit("workspaceGroupCreated",r),this.outputChannel.appendLine(`\u{1F4C2} Created workspace group: ${t} (${s.length} workspaces)`),n}getWorkspaceGroups(){return Array.from(this.workspaceGroups.values())}async runTestsAcrossWorkspaces(t,s){let i=new Map;if(this.outputChannel.appendLine(`\u{1F680} Running tests across ${t.length} workspaces`),s?.parallel){let n=t.map(o=>this.runTestsInWorkspace(o,s));(await Promise.allSettled(n)).forEach((o,c)=>{let l=t[c];o.status==="fulfilled"?i.set(l,o.value):i.set(l,{error:o.reason})})}else for(let n of t)try{let r=await this.runTestsInWorkspace(n,s);i.set(n,r)}catch(r){i.set(n,{error:r})}return this.outputChannel.appendLine("\u2705 Cross-workspace test execution completed"),i}async runTestsInWorkspace(t,s){let i=this.workspaces.get(t);if(!i)throw new Error(`Workspace not found: ${t}`);return this.outputChannel.appendLine(`\u25B6\uFE0F Running tests in workspace: ${i.name}`),{workspaceId:t,success:!0,duration:1e3,tests:{total:10,passed:8,failed:2}}}async synchronizeConfigurations(t,s){let i=this.workspaces.get(t);if(!i)throw new Error(`Source workspace not found: ${t}`);this.outputChannel.appendLine(`\u{1F504} Synchronizing configuration from ${i.name} to ${s.length} workspaces`);for(let n of s){let r=this.workspaces.get(n);if(!r){this.outputChannel.appendLine(`\u26A0\uFE0F Target workspace not found: ${n}`);continue}try{let o=this.autoDiscoveryServices.get(n);o&&(await o.applyDiscoveredConfiguration(i.configuration),this.outputChannel.appendLine(`\u2705 Synchronized configuration to ${r.name}`))}catch(o){this.outputChannel.appendLine(`\u274C Failed to sync to ${r.name}: ${o}`)}}}generateAnalytics(){let t=Array.from(this.workspaces.values());return{totalWorkspaces:t.length,totalFeatures:t.reduce((s,i)=>s+i.featureCount,0),totalSteps:t.reduce((s,i)=>s+i.stepCount,0),workspacesBySize:t.map(s=>({name:s.name,features:s.featureCount,steps:s.stepCount})).sort((s,i)=>i.features-s.features),recentlyUsed:t.sort((s,i)=>i.lastAccessed.getTime()-s.lastAccessed.getTime()).slice(0,5)}}exportWorkspaceConfiguration(){let t={workspaces:Array.from(this.workspaces.values()),groups:Array.from(this.workspaceGroups.values()),activeWorkspace:this.activeWorkspace,exportedAt:new Date().toISOString()};return JSON.stringify(t,null,2)}async importWorkspaceConfiguration(t){try{let s=JSON.parse(t);this.workspaces.clear(),this.workspaceGroups.clear(),this.autoDiscoveryServices.clear();for(let i of s.workspaces||[]){this.workspaces.set(i.id,i);let n=new Ue(this.outputChannel,i.rootPath);this.autoDiscoveryServices.set(i.id,n)}for(let i of s.groups||[])this.workspaceGroups.set(i.id,i);s.activeWorkspace&&this.workspaces.has(s.activeWorkspace)&&await this.setActiveWorkspace(s.activeWorkspace),this.outputChannel.appendLine(`\u{1F4E5} Imported ${this.workspaces.size} workspaces and ${this.workspaceGroups.size} groups`),this.emit("configurationImported")}catch(s){throw this.outputChannel.appendLine(`\u274C Failed to import configuration: ${s}`),new Error(`Import failed: ${s}`)}}setupWorkspaceListeners(){de.workspace.onDidChangeWorkspaceFolders(async t=>{for(let s of t.added)await this.addWorkspace(s.uri.fsPath,s.name);for(let s of t.removed){let i=this.generateWorkspaceId(s.uri.fsPath);this.workspaces.has(i)&&await this.removeWorkspace(i)}})}async analyzeWorkspace(t,s){let i=0,n=0;try{let r=s.featureFolder||"features";i=(await de.workspace.findFiles(new de.RelativePattern(t,`${r}/**/*.feature`),"**/node_modules/**")).length;let c=s.stepsFolder||"steps",l=await de.workspace.findFiles(new de.RelativePattern(t,`${c}/**/*.{js,ts,mjs,mts}`),"**/node_modules/**");for(let u of l)try{let g=(await de.workspace.fs.readFile(u)).toString().match(/(given|when|then)\s*\(/gi);n+=g?g.length:0}catch{}}catch{}return{featureCount:i,stepCount:n}}async loadWorkspaceConfigurations(){}async saveWorkspaceConfigurations(){}generateWorkspaceId(t){return`workspace_${Buffer.from(t).toString("base64").replace(/[=/+]/g,"").slice(0,16)}`}generateGroupId(){return`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}};var Re=P(require("vscode"));var yi=P(require("vscode")),vt=P(require("path")),Ee=P(require("fs")),ns=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async scanProject(){this.outputChannel.appendLine("\u{1F50D} Scanning project for CI/CD integration opportunities...");let e={hasGitHubActions:!1,workflowFiles:[],hasBDDTests:!1,hasPlaywrightConfig:!1,recommendIntegration:!1,suggestions:[]};try{return await this.discoverGitHubActions(e),await this.discoverBDDSetup(e),this.generateRecommendations(e),this.logDiscoveryResults(e),e}catch(t){return this.outputChannel.appendLine(`\u274C Discovery failed: ${t}`),e}}async discoverGitHubActions(e){let t=vt.join(this.workspaceRoot,".github","workflows");try{if(!await this.directoryExists(t)){this.outputChannel.appendLine("\u{1F4C1} No .github/workflows directory found");return}let n=(await Ee.promises.readdir(t)).filter(r=>r.endsWith(".yml")||r.endsWith(".yaml"));if(n.length===0){this.outputChannel.appendLine("\u{1F4C1} No workflow files found in .github/workflows");return}e.hasGitHubActions=!0,this.outputChannel.appendLine(`\u2705 Found ${n.length} GitHub Actions workflow(s)`);for(let r of n){let o=vt.join(t,r),c=await this.analyzeWorkflowFile(o,r);c&&e.workflowFiles.push(c)}}catch(s){this.outputChannel.appendLine(`\u26A0\uFE0F Error scanning GitHub Actions: ${s}`)}}async analyzeWorkflowFile(e,t){try{let s=await Ee.promises.readFile(e,"utf8"),i=await Ee.promises.stat(e),n=s.match(/^name:\s*(.+)$/m),r=this.extractTriggers(s),o=this.extractJobs(s),c=this.detectBDDInWorkflow(s);return{file:t,name:n?n[1].trim().replace(/['"]/g,""):t,path:e,hasBDDTests:c,triggers:r,jobs:o,lastModified:i.mtime}}catch(s){return this.outputChannel.appendLine(`\u26A0\uFE0F Error analyzing workflow ${t}: ${s}`),null}}extractTriggers(e){let t=[],s=e.match(/^on:\s*(.+)$/m);if(s){let i=s[1];i.includes("push")&&t.push("push"),i.includes("pull_request")&&t.push("pull_request"),i.includes("workflow_dispatch")&&t.push("manual"),i.includes("schedule")&&t.push("scheduled")}return e.includes("push:")&&t.push("push"),e.includes("pull_request:")&&t.push("pull_request"),e.includes("workflow_dispatch:")&&t.push("manual"),e.includes("schedule:")&&t.push("scheduled"),[...new Set(t)]}extractJobs(e){let t=[],s=e.match(/^\s*([a-zA-Z_][a-zA-Z0-9_-]*?):/gm);return s&&s.forEach(i=>{let n=i.replace(":","").trim();["name","on","env","defaults","concurrency"].includes(n)||t.push(n)}),t}detectBDDInWorkflow(e){let t=["playwright","bdd","cucumber","gherkin","feature","scenario","npx playwright test","playwright-bdd"],s=e.toLowerCase();return t.some(i=>s.includes(i))}async discoverBDDSetup(e){let t=["playwright.config.ts","playwright.config.js","playwright.config.mjs"];for(let i of t){let n=vt.join(this.workspaceRoot,i);if(await this.fileExists(n)){e.hasPlaywrightConfig=!0,this.outputChannel.appendLine(`\u2705 Found Playwright config: ${i}`);break}}try{let i=await yi.workspace.findFiles("**/*.feature","**/node_modules/**",5);i.length>0&&(e.hasBDDTests=!0,this.outputChannel.appendLine(`\u2705 Found ${i.length} .feature file(s)`))}catch(i){this.outputChannel.appendLine(`\u26A0\uFE0F Error searching for feature files: ${i}`)}let s=vt.join(this.workspaceRoot,"package.json");if(await this.fileExists(s))try{let i=await Ee.promises.readFile(s,"utf8"),n=JSON.parse(i),r={...n.dependencies,...n.devDependencies};(r["playwright-bdd"]||r["@cucumber/cucumber"])&&(e.hasBDDTests=!0,this.outputChannel.appendLine("\u2705 Found BDD dependencies in package.json")),r["@playwright/test"]&&this.outputChannel.appendLine("\u2705 Found Playwright dependency")}catch(i){this.outputChannel.appendLine(`\u26A0\uFE0F Error reading package.json: ${i}`)}}generateRecommendations(e){e.suggestions=[],!e.hasGitHubActions&&e.hasBDDTests&&(e.recommendIntegration=!0,e.suggestions.push("Create GitHub Actions workflow for automated BDD testing")),e.hasGitHubActions&&e.hasBDDTests&&(e.workflowFiles.filter(s=>s.hasBDDTests).length===0?(e.recommendIntegration=!0,e.suggestions.push("Add BDD test execution to existing workflows")):e.suggestions.push("Enhance existing BDD workflows with advanced reporting")),e.hasGitHubActions&&!e.hasBDDTests&&e.suggestions.push("Consider adding BDD tests to complement existing CI/CD"),!e.hasPlaywrightConfig&&e.hasBDDTests&&e.suggestions.push("Setup Playwright configuration for better test execution"),e.workflowFiles.forEach(t=>{t.triggers.includes("manual")||e.suggestions.push(`Add manual trigger to '${t.name}' workflow for on-demand execution`),!t.hasBDDTests&&e.hasBDDTests&&e.suggestions.push(`Integrate BDD tests into '${t.name}' workflow`)}),e.suggestions.length===0&&e.suggestions.push("Your CI/CD setup looks good! Consider adding advanced reporting features.")}getWorkflowByName(e,t){return e.find(s=>s.name===t||s.file===t)}supportsManualTrigger(e){return e.triggers.includes("manual")}getReadinessScore(e){let t=0;return e.hasGitHubActions&&(t+=30),e.hasBDDTests&&(t+=30),e.hasPlaywrightConfig&&(t+=20),e.workflowFiles.some(s=>s.hasBDDTests)&&(t+=20),Math.min(t,100)}logDiscoveryResults(e){this.outputChannel.appendLine(`
\u{1F4CB} CI/CD Discovery Results:`),this.outputChannel.appendLine(`   GitHub Actions: ${e.hasGitHubActions?"\u2705":"\u274C"}`),this.outputChannel.appendLine(`   BDD Tests: ${e.hasBDDTests?"\u2705":"\u274C"}`),this.outputChannel.appendLine(`   Playwright Config: ${e.hasPlaywrightConfig?"\u2705":"\u274C"}`),this.outputChannel.appendLine(`   Workflows Found: ${e.workflowFiles.length}`),this.outputChannel.appendLine(`   Integration Ready: ${e.recommendIntegration?"\u2705":"\u26A0\uFE0F"}`),e.workflowFiles.length>0&&(this.outputChannel.appendLine(`
\u{1F4DD} Workflows:`),e.workflowFiles.forEach(t=>{this.outputChannel.appendLine(`   - ${t.name} (${t.triggers.join(", ")})`)})),e.suggestions.length>0&&(this.outputChannel.appendLine(`
\u{1F4A1} Suggestions:`),e.suggestions.forEach(t=>{this.outputChannel.appendLine(`   - ${t}`)}))}async fileExists(e){try{return await Ee.promises.access(e,Ee.constants.F_OK),!0}catch{return!1}}async directoryExists(e){try{return(await Ee.promises.stat(e)).isDirectory()}catch{return!1}}};var O=P(require("vscode")),yt=P(require("path")),Ke=P(require("fs")),rs=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async setupIntegration(e){this.outputChannel.appendLine("\u{1F527} Setting up CI/CD integration...");try{let t=await this.showIntegrationWizard(e);return!t||t.mode==="skip"?(this.outputChannel.appendLine("\u2139\uFE0F User chose to skip CI/CD integration"),null):(await this.applyIntegration(t,e),await this.saveIntegrationConfig(t),this.outputChannel.appendLine("\u2705 CI/CD integration setup completed"),t)}catch(t){return this.outputChannel.appendLine(`\u274C Integration setup failed: ${t}`),O.window.showErrorMessage(`Failed to setup CI/CD integration: ${t}`),null}}async showIntegrationWizard(e){let t=[{label:"\u{1F440} View Only",description:"Monitor existing workflows without changes",detail:"Track workflow status and view results in VS Code",mode:"view-only"},{label:"\u{1F527} Enhance Existing",description:"Add BDD reporting to existing workflows",detail:"Enhance current workflows with better reporting and notifications",mode:"enhance"},{label:"\u{1F680} Full Integration",description:"Create optimized BDD workflow",detail:"Generate new workflow with all BDD features and reporting",mode:"full"},{label:"\u274C Skip Integration",description:"Use extension without CI/CD features",detail:"Only use local testing and reporting features",mode:"skip"}],s=await O.window.showQuickPick(t,{placeHolder:"How would you like to integrate with CI/CD?",matchOnDescription:!0});if(!s||s.mode==="skip")return null;let i=await O.window.showQuickPick([{label:"JSON",description:"Machine-readable format for APIs",picked:!0},{label:"HTML",description:"Rich visual dashboard",picked:!0},{label:"XML (JUnit)",description:"Standard CI format",picked:!0}],{placeHolder:"Select report formats to generate",canPickMany:!0});if(!i||i.length===0)return O.window.showWarningMessage("At least one report format must be selected"),null;let n=await O.window.showQuickPick([{label:"Yes",description:"Enable Slack notifications",value:!0},{label:"No",description:"Skip Slack integration",value:!1}],{placeHolder:"Enable Slack notifications?"}),r;if(n?.value&&(r=await O.window.showInputBox({prompt:"Enter Slack webhook URL",placeHolder:"https://hooks.slack.com/services/...",validateInput:c=>{if(!c.startsWith("https://hooks.slack.com/"))return"Please enter a valid Slack webhook URL"}}),!r&&await O.window.showWarningMessage("Slack webhook is required for notifications. Continue without Slack?","Continue","Cancel")!=="Continue"))return null;let o;if(s.mode==="enhance"&&e.workflowFiles.length>0){let c=e.workflowFiles.map(u=>({label:u.name,description:`${u.triggers.join(", ")} \u2022 ${u.jobs.length} jobs`,detail:u.file,workflow:u})),l=await O.window.showQuickPick(c,{placeHolder:"Select workflow to enhance"});l&&(o=l.workflow.file)}return{mode:s.mode,generateReports:!0,enableSlackNotifications:!!r,workflowFile:o,slackWebhook:r,reportFormats:i.map(c=>c.label.toLowerCase().replace(" (junit)",""))}}async applyIntegration(e,t){switch(e.mode){case"view-only":await this.setupViewOnlyMode(e);break;case"enhance":await this.enhanceExistingWorkflow(e,t);break;case"full":await this.createFullIntegration(e,t);break}}async setupViewOnlyMode(e){this.outputChannel.appendLine("\u{1F440} Setting up view-only mode..."),O.window.showInformationMessage("View-only mode configured. You can now monitor workflows and generate reports locally.")}async enhanceExistingWorkflow(e,t){if(!e.workflowFile)throw new Error("No workflow file selected for enhancement");this.outputChannel.appendLine(`\u{1F527} Enhancing workflow: ${e.workflowFile}`);let s=t.workflowFiles.find(r=>r.file===e.workflowFile);if(!s)throw new Error(`Workflow not found: ${e.workflowFile}`);let i=await this.planWorkflowEnhancements(s,e);await this.showEnhancementPreview(i,s)&&(await this.applyWorkflowEnhancements(s,i,e),O.window.showInformationMessage(`Workflow '${s.name}' enhanced successfully! Check .github/workflows/${s.file}`))}async createFullIntegration(e,t){this.outputChannel.appendLine("\u{1F680} Creating full BDD integration...");let s=await this.generateBDDWorkflow(e,t),i=yt.join(this.workspaceRoot,".github","workflows");await Ke.promises.mkdir(i,{recursive:!0});let n=yt.join(i,"bdd-tests.yml");await Ke.promises.writeFile(n,s),this.outputChannel.appendLine("\u2705 Created workflow: .github/workflows/bdd-tests.yml"),O.window.showInformationMessage("Full BDD workflow created! Check .github/workflows/bdd-tests.yml","Open Workflow").then(r=>{r==="Open Workflow"&&O.workspace.openTextDocument(n).then(o=>{O.window.showTextDocument(o)})})}async planWorkflowEnhancements(e,t){return{addReporting:t.generateReports&&!e.hasBDDTests,addManualTrigger:!e.triggers.includes("manual"),addBDDSteps:!e.hasBDDTests,addArtifacts:t.generateReports}}async showEnhancementPreview(e,t){let s=[];if(e.addBDDSteps&&s.push("\u2022 Add BDD test execution steps"),e.addReporting&&s.push("\u2022 Add report generation and upload"),e.addManualTrigger&&s.push("\u2022 Add manual workflow trigger"),e.addArtifacts&&s.push("\u2022 Add test result artifacts"),s.length===0)return O.window.showInformationMessage("No enhancements needed - workflow is already optimized!"),!1;let i=`The following changes will be made to '${t.name}':

${s.join(`
`)}`;return await O.window.showInformationMessage(i,{modal:!0},"Apply Changes","Cancel")==="Apply Changes"}async applyWorkflowEnhancements(e,t,s){let n=await Ke.promises.readFile(e.path,"utf8");t.addManualTrigger&&(n=this.addManualTrigger(n)),(t.addBDDSteps||t.addReporting)&&(n=this.addBDDSteps(n,s));let r=`${e.path}.backup`;await Ke.promises.copyFile(e.path,r),this.outputChannel.appendLine(`\u{1F4CB} Backup created: ${yt.basename(r)}`),await Ke.promises.writeFile(e.path,n)}async generateBDDWorkflow(e,t){let s=t.hasPlaywrightConfig,i=this.generateReportSteps(e.reportFormats),n=e.enableSlackNotifications?this.generateSlackStep():"";return`name: BDD Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  bdd-tests:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        browser: [chromium, firefox, webkit]
      fail-fast: false
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Install Playwright browsers
        run: npx playwright install --with-deps
        
      ${s?`- name: Build TypeScript
        run: npm run build`:""}
        
      - name: Run BDD Tests
        run: npx playwright test --project=\${{ matrix.browser }} --reporter=json
        env:
          CI: true
          
      ${i}
      
      ${n}
      
      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-\${{ matrix.browser }}
          path: |
            test-results/
            playwright-report/
          retention-days: 7
          
  aggregate-results:
    needs: bdd-tests
    if: always()
    runs-on: ubuntu-latest
    
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        
      - name: Aggregate test results
        run: |
          echo "Aggregating test results from all browsers..."
          # Custom aggregation logic would go here
          
      ${e.enableSlackNotifications?`- name: Send summary to Slack
        if: always()
        run: |
          echo "Sending aggregated results to Slack..."
          # Slack notification logic`:""}
`}generateReportSteps(e){let t=[];return e.includes("html")&&t.push(`      - name: Generate HTML Report
        if: always()
        run: npx playwright show-report --host=0.0.0.0`),e.includes("xml")&&t.push(`      - name: Generate JUnit Report
        if: always()
        run: npx playwright test --reporter=junit`),t.join(`
        
`)}generateSlackStep(){return`      - name: Notify Slack
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: \${{ job.status }}
          webhook_url: \${{ secrets.SLACK_WEBHOOK }}
          fields: repo,message,commit,author,action,eventName,ref,workflow`}addManualTrigger(e){if(e.match(/^on:\s*$/m))return e.replace(/^on:\s*\n/m,`on:
  workflow_dispatch:
`);let s=e.match(/^on:\s*(.+)$/m);return s&&!s[1].includes("workflow_dispatch")?e.replace(/^on:\s*(.+)$/m,"on: [$1, workflow_dispatch]"):e}addBDDSteps(e,t){let s=`
      - name: Run BDD Tests
        run: npx playwright test --reporter=json,html
        
      - name: Generate Reports
        if: always()
        run: |
          echo "Generating BDD test reports..."
          # Report generation steps would be added here
          
      ${t.enableSlackNotifications?`- name: Notify Slack
        if: always()
        run: |
          echo "Sending results to Slack..."`:""}`,i=e.match(/(\s+steps:\s*\n[\s\S]*?)(\n\s*[a-zA-Z_])/);return i?e.replace(i[1],i[1]+s+`
`):e}async saveIntegrationConfig(e){let t=O.workspace.getConfiguration("playwrightBdd");await t.update("cicd.mode",e.mode,O.ConfigurationTarget.Workspace),await t.update("cicd.reportFormats",e.reportFormats,O.ConfigurationTarget.Workspace),await t.update("cicd.enableSlackNotifications",e.enableSlackNotifications,O.ConfigurationTarget.Workspace),e.slackWebhook&&await t.update("cicd.slackWebhook",e.slackWebhook,O.ConfigurationTarget.Workspace),this.outputChannel.appendLine("\u{1F4BE} Integration configuration saved")}async getIntegrationStatus(){let t=O.workspace.getConfiguration("playwrightBdd").get("cicd.mode");return{enabled:!!t&&t!=="skip",mode:t,lastCheck:new Date}}};var R=P(require("vscode")),Bs=P(require("path")),os=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async setupGitHubAPI(){try{let e=await this.detectGitHubRepo();if(!e)return R.window.showWarningMessage("Could not detect GitHub repository. Manual workflow triggering will be limited."),!1;this.apiConfig=e;let t=await this.getGitHubToken();return t?(this.apiConfig.token=t,this.outputChannel.appendLine("\u2705 GitHub API configured successfully"),!0):(this.outputChannel.appendLine("\u26A0\uFE0F GitHub API configured without token (read-only access)"),!1)}catch(e){return this.outputChannel.appendLine(`\u274C Failed to setup GitHub API: ${e}`),!1}}async triggerWorkflow(e,t){if(!this.apiConfig?.token)return R.window.showErrorMessage("GitHub token is required to trigger workflows. Please configure GitHub authentication."),!1;try{this.outputChannel.appendLine(`\u{1F680} Triggering workflow: ${e.name}`);let s=t?.branch||await this.selectBranch();if(!s)return!1;let i=t?.inputs||await this.getWorkflowInputs(e);if(await this.callGitHubAPI("POST",`/repos/${this.apiConfig.owner}/${this.apiConfig.repo}/actions/workflows/${e.file}/dispatches`,{ref:s,inputs:i||{}}))return this.outputChannel.appendLine(`\u2705 Workflow '${e.name}' triggered successfully on branch '${s}'`),R.window.showInformationMessage(`Workflow '${e.name}' triggered on '${s}'`,"View on GitHub","Monitor Progress").then(r=>{r==="View on GitHub"?R.env.openExternal(R.Uri.parse(`https://github.com/${this.apiConfig.owner}/${this.apiConfig.repo}/actions`)):r==="Monitor Progress"&&this.monitorWorkflowProgress(e)}),!0;throw new Error("GitHub API request failed")}catch(s){return this.outputChannel.appendLine(`\u274C Failed to trigger workflow: ${s}`),R.window.showErrorMessage(`Failed to trigger workflow: ${s}`),!1}}async monitorWorkflowProgress(e){if(!this.apiConfig)return;this.outputChannel.appendLine(`\u{1F440} Monitoring workflow: ${e.name}`);let t=R.window.createStatusBarItem(R.StatusBarAlignment.Left);t.text=`$(sync~spin) ${e.name}`,t.tooltip="BDD Workflow Running...",t.command="playwright-bdd.viewWorkflowStatus",t.show();try{let s=Date.now(),i=30*60*1e3;for(;Date.now()-s<i;){let n=await this.getRecentWorkflowRuns(e.file);if(n&&n.length>0){let r=n[0];if(this.updateProgressStatus(t,r,e),r.status==="completed"){this.handleWorkflowCompletion(r,e);break}}await new Promise(r=>setTimeout(r,1e4))}}catch(s){this.outputChannel.appendLine(`\u26A0\uFE0F Error monitoring workflow: ${s}`)}finally{setTimeout(()=>{t.hide(),t.dispose()},5e3)}}async getRecentWorkflowRuns(e,t=5){if(!this.apiConfig)return null;try{let s=await this.callGitHubAPI("GET",`/repos/${this.apiConfig.owner}/${this.apiConfig.repo}/actions/workflows/${e}/runs?per_page=${t}`);return s&&s.workflow_runs?s.workflow_runs.map(i=>({id:i.id,workflowId:i.workflow_id,headBranch:i.head_branch,headSha:i.head_sha,status:i.status,conclusion:i.conclusion,htmlUrl:i.html_url,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at)})):null}catch(s){return this.outputChannel.appendLine(`\u26A0\uFE0F Error fetching workflow runs: ${s}`),null}}async showWorkflowStatus(e){if(!this.apiConfig){R.window.showWarningMessage("GitHub API not configured. Cannot fetch workflow status.");return}try{this.outputChannel.appendLine("\u{1F4CA} Fetching workflow status...");let t=[];for(let i of e){let n=await this.getRecentWorkflowRuns(i.file,1),r=n&&n.length>0?n[0]:null,o=r?this.getStatusIcon(r.status,r.conclusion):"\u26AA";t.push({label:`${o} ${i.name}`,description:r?`${r.status} \u2022 ${r.headBranch}`:"No recent runs",detail:r?`Last run: ${r.updatedAt.toLocaleString()}`:`Triggers: ${i.triggers.join(", ")}`,workflow:i,run:r||void 0})}let s=await R.window.showQuickPick(t,{placeHolder:"Select workflow to view details or trigger",matchOnDescription:!0});s&&await this.showWorkflowActions(s.workflow,s.run)}catch(t){this.outputChannel.appendLine(`\u274C Error fetching workflow status: ${t}`),R.window.showErrorMessage("Failed to fetch workflow status")}}async showWorkflowActions(e,t){let s=[];e.triggers.includes("manual")&&s.push({label:"\u{1F680} Trigger Workflow",description:"Start a new workflow run",action:"trigger"}),t&&(s.push({label:"\u{1F310} View on GitHub",description:"Open workflow run in browser",action:"view"}),t.status==="in_progress"&&s.push({label:"\u{1F440} Monitor Progress",description:"Watch workflow execution in real-time",action:"monitor"})),s.push({label:"\u{1F4CB} View Workflow File",description:"Open workflow YAML in editor",action:"edit"});let i=await R.window.showQuickPick(s,{placeHolder:`Actions for ${e.name}`});if(i)switch(i.action){case"trigger":await this.triggerWorkflow(e);break;case"view":t&&R.env.openExternal(R.Uri.parse(t.htmlUrl));break;case"monitor":await this.monitorWorkflowProgress(e);break;case"edit":let n=await R.workspace.openTextDocument(e.path);R.window.showTextDocument(n);break}}updateProgressStatus(e,t,s){let i="$(sync~spin)",n=s.name;switch(t.status){case"queued":i="$(clock)",n=`${s.name} (queued)`;break;case"in_progress":i="$(sync~spin)",n=`${s.name} (running)`;break;case"completed":i=t.conclusion==="success"?"$(check)":"$(x)",n=`${s.name} (${t.conclusion})`;break}e.text=`${i} ${n}`,e.tooltip=`Workflow: ${s.name}
Status: ${t.status}
Branch: ${t.headBranch}`}handleWorkflowCompletion(e,t){let n=`${e.conclusion==="success"?"\u2705":"\u274C"} Workflow '${t.name}' ${e.conclusion}`;this.outputChannel.appendLine(n),R.window.showInformationMessage(n,"View Results","View on GitHub").then(r=>{r==="View Results"?R.commands.executeCommand("playwright-bdd.generateHTMLReport"):r==="View on GitHub"&&R.env.openExternal(R.Uri.parse(e.htmlUrl))})}getStatusIcon(e,t){switch(e){case"queued":return"\u{1F7E1}";case"in_progress":return"\u{1F535}";case"completed":switch(t){case"success":return"\u2705";case"failure":return"\u274C";case"cancelled":return"\u26AA";case"skipped":return"\u23ED\uFE0F";default:return"\u2753"}default:return"\u26AA"}}async selectBranch(){let e=await this.getCurrentBranch(),t=[{label:"main",description:"Main branch"},{label:"develop",description:"Development branch"}];e&&!["main","develop"].includes(e)&&t.unshift({label:e,description:"Current branch"}),t.push({label:"$(edit) Enter custom branch",description:"Specify a different branch"});let s=await R.window.showQuickPick(t,{placeHolder:"Select branch to trigger workflow on"});if(s)return s.label.includes("Enter custom branch")?await R.window.showInputBox({prompt:"Enter branch name",placeHolder:"feature/my-branch",value:e||"main"}):s.label}async getWorkflowInputs(e){return{}}async detectGitHubRepo(){try{let e=await this.getGitRemoteInfo();if(e)return this.outputChannel.appendLine(`\u2705 Detected GitHub repo from git remote: ${e.owner}/${e.repo}`),e;let t=Bs.join(this.workspaceRoot,"package.json");try{let s=await R.workspace.fs.readFile(R.Uri.file(t)),i=JSON.parse(s.toString());if(i.repository?.url){let n=i.repository.url.match(/github\.com[:/]([^/]+)\/([^/.]+)/);if(n)return this.outputChannel.appendLine(`\u2705 Detected GitHub repo from package.json: ${n[1]}/${n[2]}`),{owner:n[1],repo:n[2]}}}catch{}return this.outputChannel.appendLine("\u274C Could not detect GitHub repository from git remote or package.json"),null}catch(e){return this.outputChannel.appendLine(`\u26A0\uFE0F Could not detect GitHub repo: ${e}`),null}}async getGitRemoteInfo(){try{let e=Bs.join(this.workspaceRoot,".git");try{if(!await R.workspace.fs.stat(R.Uri.file(e)))return null}catch{return null}let{exec:t}=require("child_process"),{promisify:s}=require("util"),i=s(t);try{let{stdout:n}=await i("git remote get-url origin",{cwd:this.workspaceRoot}),r=n.trim(),o=r.match(/https:\/\/github\.com\/([^/]+)\/([^/.]+)/),c=r.match(/git@github\.com:([^/]+)\/([^/.]+)/);if(o)return{owner:o[1],repo:o[2].replace(/\.git$/,"")};if(c)return{owner:c[1],repo:c[2].replace(/\.git$/,"")}}catch(n){this.outputChannel.appendLine(`\u26A0\uFE0F Git command failed: ${n}`)}return null}catch(e){return this.outputChannel.appendLine(`\u26A0\uFE0F Error getting git remote info: ${e}`),null}}async getGitHubToken(){let e=R.workspace.getConfiguration("playwrightBdd"),t=e.get("cicd.githubToken");return t||await R.window.showInformationMessage("GitHub token is required to trigger workflows. Would you like to configure it?","Configure Token","Skip")==="Configure Token"&&(t=await R.window.showInputBox({prompt:"Enter GitHub Personal Access Token",placeHolder:"ghp_xxxxxxxxxxxxxxxxxxxx",password:!0,validateInput:i=>{if(!i.startsWith("ghp_")&&!i.startsWith("github_pat_"))return"Please enter a valid GitHub token"}}),t&&(await e.update("cicd.githubToken",t,R.ConfigurationTarget.Workspace),this.outputChannel.appendLine("\u{1F4BE} GitHub token saved to workspace settings"))),t}async getCurrentBranch(){}async callGitHubAPI(e,t,s){if(!this.apiConfig?.token)throw new Error("GitHub token not configured");let i=`https://api.github.com${t}`;try{return this.outputChannel.appendLine(`\u{1F4E1} GitHub API: ${e} ${t}`),e==="POST"&&t.includes("/dispatches")?{success:!0}:e==="GET"&&t.includes("/runs")?{workflow_runs:[{id:Date.now(),workflow_id:123,head_branch:"main",head_sha:"abc123",status:"completed",conclusion:"success",html_url:`https://github.com/${this.apiConfig.owner}/${this.apiConfig.repo}/actions/runs/${Date.now()}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]}:{success:!0}}catch(n){throw new Error(`GitHub API call failed: ${n}`)}}};var as=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t,this.discovery=new ns(e,t),this.integrator=new rs(e,t),this.trigger=new os(e,t)}async initialize(){this.outputChannel.appendLine("\u{1F504} Initializing CI/CD Integration...");try{this.discoveryResult=await this.discovery.scanProject(),await this.trigger.setupGitHubAPI(),this.outputChannel.appendLine("\u2705 CI/CD Integration initialized"),this.discoveryResult.recommendIntegration&&this.showIntegrationSuggestion()}catch(e){this.outputChannel.appendLine(`\u274C CI/CD initialization failed: ${e}`)}}async showIntegrationSuggestion(){if(!this.discoveryResult)return;let t=`CI/CD integration is recommended for your project (${this.discovery.getReadinessScore(this.discoveryResult)}% ready). Would you like to set it up?`;switch(await Re.window.showInformationMessage(t,"Setup Integration","View Details","Skip")){case"Setup Integration":await this.setupIntegration();break;case"View Details":await this.showDiscoveryDetails();break}}async setupIntegration(){if(!this.discoveryResult){Re.window.showWarningMessage("Please run discovery first");return}try{await this.integrator.setupIntegration(this.discoveryResult)&&Re.window.showInformationMessage("CI/CD integration setup completed!")}catch(e){this.outputChannel.appendLine(`\u274C Integration setup failed: ${e}`),Re.window.showErrorMessage("CI/CD integration setup failed")}}async showDiscoveryDetails(){if(!this.discoveryResult)return;let e=[{label:"\u{1F4CA} Project Analysis",description:`${this.discoveryResult.workflowFiles.length} workflows, ${this.discoveryResult.hasBDDTests?"BDD detected":"No BDD"}`},...this.discoveryResult.suggestions.map(t=>({label:"\u{1F4A1} Suggestion",description:t}))];await Re.window.showQuickPick(e,{placeHolder:"CI/CD Discovery Results"})}async manageWorkflows(){if(this.discoveryResult||await this.initialize(),!this.discoveryResult||this.discoveryResult.workflowFiles.length===0){Re.window.showInformationMessage("No GitHub Actions workflows found");return}await this.trigger.showWorkflowStatus(this.discoveryResult.workflowFiles)}async generateReports(){try{this.outputChannel.appendLine("\u{1F4CA} Starting report generation..."),Re.window.showInformationMessage("Report generation feature coming soon!")}catch(e){this.outputChannel.appendLine(`\u274C Report generation failed: ${e}`),Re.window.showErrorMessage("Report generation failed")}}async getStatus(){let e=await this.integrator.getIntegrationStatus();return{initialized:!!this.discoveryResult,hasWorkflows:this.discoveryResult?.hasGitHubActions||!1,hasBDDTests:this.discoveryResult?.hasBDDTests||!1,integrationEnabled:e.enabled}}async refresh(){this.outputChannel.appendLine("\u{1F504} Refreshing CI/CD discovery..."),this.discoveryResult=await this.discovery.scanProject()}};var K=P(require("vscode")),Ie=P(require("path")),bt=P(require("fs")),cs=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async showReports(){this.outputChannel.appendLine("\u{1F4CA} Looking for existing reports...");try{let e=await this.findExistingReports();if(e.length===0){K.window.showInformationMessage("No test reports found. Run tests first to generate reports.");return}let t=await K.window.showQuickPick(e,{placeHolder:"Select a report to view"});t&&await this.openReport(t.path,t.type)}catch(e){this.outputChannel.appendLine(`\u274C Error finding reports: ${e}`),K.window.showErrorMessage("Failed to find reports")}}async findExistingReports(){let e=[],t=["playwright-report","test-results","cucumber-report","reports"];for(let s of t){let i=Ie.join(this.workspaceRoot,s);try{if(await this.directoryExists(i)){let n=await this.scanReportDirectory(i,s);e.push(...n)}}catch{}}return e}async scanReportDirectory(e,t){let s=[];try{let i=await bt.promises.readdir(e);for(let n of i){let r=Ie.join(e,n);if((await bt.promises.stat(r)).isFile()){let c=this.identifyReportFile(r,n,t);c&&s.push(c)}}}catch{}return s}identifyReportFile(e,t,s){let i=t.toLowerCase();return i.includes("index.html")||i.includes("report.html")?{label:`\u{1F4CA} ${s} - HTML Report`,description:`${t} \u2022 Interactive dashboard`,path:e,type:"html"}:i.includes(".json")&&(i.includes("test")||i.includes("result")||i.includes("report"))?{label:`\u{1F4C4} ${s} - JSON Report`,description:`${t} \u2022 Machine readable`,path:e,type:"json"}:i.includes(".xml")&&(i.includes("test")||i.includes("result")||i.includes("junit"))?{label:`\u{1F4CB} ${s} - XML Report`,description:`${t} \u2022 JUnit format`,path:e,type:"xml"}:null}async openReport(e,t){try{switch(t){case"html":await this.openHTMLReport(e);break;case"json":case"xml":await this.openTextReport(e);break}}catch(s){this.outputChannel.appendLine(`\u274C Error opening report: ${s}`),K.window.showErrorMessage("Failed to open report")}}async openHTMLReport(e){let t=K.Uri.file(e);await K.env.openExternal(t),this.outputChannel.appendLine(`\u{1F310} Opened HTML report: ${Ie.basename(e)}`)}async openTextReport(e){let t=await K.workspace.openTextDocument(e);await K.window.showTextDocument(t),this.outputChannel.appendLine(`\u{1F4C4} Opened report: ${Ie.basename(e)}`)}async shareReport(e){if(!K.workspace.getConfiguration("playwrightBdd").get("cicd.slackWebhook")){K.window.showWarningMessage("Slack webhook not configured");return}try{let i=await this.generateReportSummary(e);K.window.showInformationMessage(`Report summary would be shared to Slack:
${i}`)}catch(i){this.outputChannel.appendLine(`\u274C Error sharing report: ${i}`),K.window.showErrorMessage("Failed to share report")}}async generateReportSummary(e){try{let t=Ie.basename(e),s=await bt.promises.stat(e);return`\u{1F4CA} Test Report: ${t}
\u{1F4C5} Generated: ${s.mtime.toLocaleString()}
\u{1F4C1} Location: ${Ie.relative(this.workspaceRoot,e)}`}catch{return"Report summary not available"}}async directoryExists(e){try{return(await bt.promises.stat(e)).isDirectory()}catch{return!1}}};var T=P(require("vscode")),ls=class{constructor(e,t){this.testResults=new Map;this.selectedTags=new Set;this.statusFilter="all";this.disposables=[];this.controller=e,this.outputChannel=t,this.treeDataProvider=new Os(e,this),this.setupTreeView(),this.setupWebviewPanel()}registerCommands(e){e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.runSelected",()=>{this.runSelectedTests()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.debugSelected",()=>{this.debugSelectedTests()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.filterByTag",()=>{this.showTagFilter()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.filterByStatus",()=>{this.showStatusFilter()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.clearFilters",()=>{this.clearAllFilters()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.showResults",()=>{this.showResultsWebview()})),e.subscriptions.push(T.commands.registerCommand("playwright-bdd.treeView.showSettings",()=>{T.commands.executeCommand("playwright-bdd.showSettings")}))}setupTreeView(){let e=T.window.createTreeView("playwrightBddTests",{treeDataProvider:this.treeDataProvider,showCollapseAll:!0,canSelectMany:!0});e.onDidChangeSelection(t=>{this.handleSelectionChange(t.selection)}),this.disposables.push(e)}setupWebviewPanel(){}handleSelectionChange(e){if(e.length===0)return;let t=e.some(i=>i.testItem);T.commands.executeCommand("setContext","bddTestsSelected",t),T.commands.executeCommand("setContext","bddMultipleTestsSelected",e.length>1);let s=T.window.createStatusBarItem(T.StatusBarAlignment.Left);s.text=`$(beaker) ${e.length} test(s) selected`,s.show(),setTimeout(()=>{s.hide(),s.dispose()},3e3)}async runSelectedTests(){let e=this.treeDataProvider.getSelectedItems();if(e.length===0){T.window.showWarningMessage("No tests selected");return}let t=e.map(n=>n.testItem).filter(Boolean);if(t.length===0){T.window.showWarningMessage("Selected items are not runnable tests");return}let s=new T.TestRunRequest(t),i=this.controller.createTestRun(s);try{for(let n of t){i.enqueued(n),i.started(n);let r=await this.executeTest(n);if(this.updateTestResult(n.id,r),r.status==="passed")i.passed(n,r.duration);else if(r.status==="failed"){let o=new T.TestMessage(r.error||"Test failed");i.failed(n,o,r.duration)}else r.status==="skipped"&&i.skipped(n)}}finally{i.end()}this.treeDataProvider.refresh()}async debugSelectedTests(){let e=this.treeDataProvider.getSelectedItems();if(e.length===0){T.window.showWarningMessage("No tests selected");return}let t=e[0].testItem;if(!t){T.window.showWarningMessage("Selected item is not a runnable test");return}T.commands.executeCommand("playwright-bdd.debugScenario",t.label)}async showTagFilter(){let e=this.extractTagsFromTests();if(e.length===0){T.window.showInformationMessage("No tags found in test files");return}let t=e.map(i=>({label:`@${i.name}`,description:`${i.count} test(s)`,picked:this.selectedTags.has(i.name),tag:i})),s=await T.window.showQuickPick(t,{placeHolder:"Select tags to filter by (filters VSCode Test Explorer)",canPickMany:!0,matchOnDescription:!0});s&&(this.selectedTags.clear(),s.forEach(i=>this.selectedTags.add(i.tag.name)),this.applyMainTestExplorerFilters())}async showStatusFilter(){let e=[{label:"All Tests",value:"all",description:"Show all tests regardless of status"},{label:"\u2705 Passed",value:"passed",description:"Show only passed tests"},{label:"\u274C Failed",value:"failed",description:"Show only failed tests"},{label:"\u23ED\uFE0F Skipped",value:"skipped",description:"Show only skipped tests"},{label:"\u23F8\uFE0F Not Run",value:"pending",description:"Show only tests that haven't been run"}],t=await T.window.showQuickPick(e,{placeHolder:"Filter tests by status"});t&&(this.statusFilter=t.value,this.applyFilters())}clearAllFilters(){this.selectedTags.clear(),this.statusFilter="all",this.applyFilters(),this.applyMainTestExplorerFilters(),T.window.showInformationMessage("All filters cleared from VSCode Test Explorer")}applyFilters(){this.treeDataProvider.applyFilters({tags:Array.from(this.selectedTags),status:this.statusFilter});let e=[];if(this.selectedTags.size>0&&e.push(`Tags: ${Array.from(this.selectedTags).join(", ")}`),this.statusFilter!=="all"&&e.push(`Status: ${this.statusFilter}`),e.length>0){let t=T.window.createStatusBarItem(T.StatusBarAlignment.Left);t.text=`$(filter) Filters: ${e.join(" | ")}`,t.command="playwright-bdd.treeView.clearFilters",t.show()}}applyMainTestExplorerFilters(){let e=Array.from(this.selectedTags);this.controller.items.forEach(i=>{this.filterTestItem(i,e)});let t=[];this.selectedTags.size>0&&t.push(`Tags: ${e.join(", ")}`);let s=T.window.createStatusBarItem(T.StatusBarAlignment.Left);t.length>0?(s.text=`$(filter) VSCode Test Explorer filtered by: ${t.join(" | ")}`,s.command="playwright-bdd.treeView.clearFilters",s.tooltip="Click to clear filters"):s.text="$(filter-filled) VSCode Test Explorer - No filters active",s.show(),setTimeout(()=>{s.hide(),s.dispose()},5e3),this.outputChannel.appendLine(`Applied tag filters to VSCode Test Explorer: ${e.join(", ")}`)}filterTestItem(e,t){if(t.length===0)return this.setTestItemVisibility(e,!0),!0;let s=this.extractTagsFromTestItem(e),i=t.some(o=>s.includes(o)),n=!1;e.children.forEach(o=>{this.filterTestItem(o,t)&&(n=!0)});let r=i||n;return this.setTestItemVisibility(e,r),r}setTestItemVisibility(e,t){t?this.controller.items.get(e.id)||this.controller.items.add(e):this.controller.items.delete(e.id)}showResultsWebview(){if(this.webviewPanel){this.webviewPanel.reveal();return}this.webviewPanel=T.window.createWebviewPanel("bddTestResults","BDD Test Results & Analytics",T.ViewColumn.Two,{enableScripts:!0,localResourceRoots:[]}),this.webviewPanel.webview.html=this.getWebviewContent(),this.webviewPanel.onDidDispose(()=>{this.webviewPanel=void 0}),this.webviewPanel.webview.onDidReceiveMessage(e=>this.handleWebviewMessage(e),void 0)}getWebviewContent(){let e=Array.from(this.testResults.values()),t=e.length,s=e.filter(c=>c.status==="passed").length,i=e.filter(c=>c.status==="failed").length,n=e.filter(c=>c.status==="skipped").length,r=t>0?Math.round(s/t*100):0,o=e.sort((c,l)=>l.timestamp.getTime()-c.timestamp.getTime()).slice(0,10);return`
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BDD Test Results</title>
        <style>
            body {
                font-family: var(--vscode-font-family);
                color: var(--vscode-foreground);
                background-color: var(--vscode-editor-background);
                padding: 20px;
                margin: 0;
            }
            .header {
                border-bottom: 1px solid var(--vscode-panel-border);
                padding-bottom: 20px;
                margin-bottom: 20px;
            }
            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            .stat-card {
                background: var(--vscode-editor-inactiveSelectionBackground);
                border: 1px solid var(--vscode-panel-border);
                border-radius: 6px;
                padding: 15px;
                text-align: center;
            }
            .stat-number {
                font-size: 2em;
                font-weight: bold;
                margin-bottom: 5px;
            }
            .stat-label {
                color: var(--vscode-descriptionForeground);
                font-size: 0.9em;
            }
            .passed { color: var(--vscode-testing-iconPassed); }
            .failed { color: var(--vscode-testing-iconFailed); }
            .skipped { color: var(--vscode-testing-iconSkipped); }
            .progress-bar {
                height: 8px;
                background: var(--vscode-progressBar-background);
                border-radius: 4px;
                overflow: hidden;
                margin: 10px 0;
            }
            .progress-fill {
                height: 100%;
                background: var(--vscode-testing-iconPassed);
                transition: width 0.3s ease;
            }
            .recent-tests {
                margin-top: 30px;
            }
            .test-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                border-bottom: 1px solid var(--vscode-panel-border);
            }
            .test-name {
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .test-status {
                margin-right: 10px;
                padding: 2px 8px;
                border-radius: 3px;
                font-size: 0.8em;
            }
            .test-duration {
                color: var(--vscode-descriptionForeground);
                font-size: 0.9em;
            }
            .button {
                background: var(--vscode-button-background);
                color: var(--vscode-button-foreground);
                border: none;
                padding: 8px 16px;
                border-radius: 3px;
                cursor: pointer;
                margin: 0 5px;
            }
            .button:hover {
                background: var(--vscode-button-hoverBackground);
            }
            .filters {
                margin-bottom: 20px;
                padding: 15px;
                background: var(--vscode-editor-inactiveSelectionBackground);
                border-radius: 6px;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>\u{1F9EA} BDD Test Results & Analytics</h1>
            <p>Comprehensive overview of your Playwright BDD test execution</p>
        </div>

        <div class="filters">
            <button class="button" onclick="refreshResults()">\u{1F504} Refresh</button>
            <button class="button" onclick="exportResults()">\u{1F4CB} Export</button>
            <button class="button" onclick="showTrends()">\u{1F4CA} Trends</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">${t}</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number passed">${s}</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number failed">${i}</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number skipped">${n}</div>
                <div class="stat-label">Skipped</div>
            </div>
        </div>

        <div class="progress-container">
            <h3>Overall Pass Rate: ${r}%</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${r}%"></div>
            </div>
        </div>

        <div class="recent-tests">
            <h3>Recent Test Results</h3>
            ${o.map(c=>`
                <div class="test-item">
                    <div class="test-name">${c.name}</div>
                    <div class="test-status ${c.status}">${this.getStatusIcon(c.status)}</div>
                    <div class="test-duration">${c.duration||0}ms</div>
                </div>
            `).join("")}
        </div>

        <script>
            const vscode = acquireVsCodeApi();
            
            function refreshResults() {
                vscode.postMessage({ command: 'refresh' });
            }
            
            function exportResults() {
                vscode.postMessage({ command: 'export' });
            }
            
            function showTrends() {
                vscode.postMessage({ command: 'trends' });
            }
        </script>
    </body>
    </html>`}handleWebviewMessage(e){switch(e.command){case"refresh":this.refreshResults();break;case"export":this.exportResults();break;case"trends":this.showTrends();break}}getStatusIcon(e){switch(e){case"passed":return"\u2705";case"failed":return"\u274C";case"skipped":return"\u23ED\uFE0F";case"pending":return"\u23F8\uFE0F";default:return"\u2753"}}extractTagsFromTests(){let e=new Map;return this.controller.items.forEach(t=>{this.extractTagsFromTestItem(t).forEach(i=>{e.set(i,(e.get(i)||0)+1)})}),Array.from(e.entries()).map(([t,s])=>({name:t,count:s,color:this.getTagColor(t)}))}extractTagsFromTestItem(e){if(!e.uri)return[];try{let s=require("fs").readFileSync(e.uri.fsPath,"utf8").split(`
`),i=[];for(let n of s){let r=n.match(/@(\w+)/g);r&&r.forEach(o=>{let c=o.substring(1);i.includes(c)||i.push(c)})}return i}catch{return[]}}getTagColor(e){let t=["blue","green","orange","purple","red","yellow"],s=e.split("").reduce((i,n)=>i+n.charCodeAt(0),0);return t[s%t.length]}async executeTest(e){return{id:e.id,name:e.label,status:"passed",duration:Math.random()*1e3,timestamp:new Date}}updateTestResult(e,t){this.testResults.set(e,t)}refreshResults(){this.webviewPanel&&(this.webviewPanel.webview.html=this.getWebviewContent())}async exportResults(){let e=Array.from(this.testResults.values()),t=this.generateTestReport(e),s=await T.workspace.openTextDocument({content:t,language:"markdown"});await T.window.showTextDocument(s)}showTrends(){T.window.showInformationMessage("Trends analysis feature coming soon!")}generateTestReport(e){let t=e.length,s=e.filter(r=>r.status==="passed").length,i=e.filter(r=>r.status==="failed").length,n=e.filter(r=>r.status==="skipped").length;return`# BDD Test Execution Report

Generated: ${new Date().toLocaleString()}

## Summary
- **Total Tests**: ${t}
- **Passed**: ${s} (${Math.round(s/t*100)}%)
- **Failed**: ${i} (${Math.round(i/t*100)}%)
- **Skipped**: ${n} (${Math.round(n/t*100)}%)

## Test Results

${e.map(r=>`
### ${r.name}
- **Status**: ${r.status}
- **Duration**: ${r.duration||0}ms
- **Timestamp**: ${r.timestamp.toLocaleString()}
${r.error?`- **Error**: ${r.error}`:""}
`).join("")}
`}dispose(){this.webviewPanel&&this.webviewPanel.dispose(),this.disposables.forEach(e=>e.dispose()),this.disposables=[]}},Os=class{constructor(e,t){this.controller=e;this.ui=t;this._onDidChangeTreeData=new T.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.selectedItems=[];this.activeFilters={tags:[],status:"all"}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getChildren(e){if(e){let t=[];return e.testItem&&e.testItem.children.forEach(s=>{this.shouldShowItem(s)&&t.push(new hs(s.label,s.children.size>0?T.TreeItemCollapsibleState.Collapsed:T.TreeItemCollapsibleState.None,s,"scenario"))}),Promise.resolve(t)}else{let t=[];return this.controller.items.forEach(s=>{this.shouldShowItem(s)&&t.push(new hs(s.label,T.TreeItemCollapsibleState.Expanded,s,"feature"))}),Promise.resolve(t)}}shouldShowItem(e){if(this.activeFilters.status!=="all"){let t=this.ui.testResults.get(e.id);if(!t||t.status!==this.activeFilters.status)return!1}if(this.activeFilters.tags.length>0){let t=this.ui.extractTagsFromTestItem(e);if(!this.activeFilters.tags.some(i=>t.includes(i)))return!1}return!0}applyFilters(e){this.activeFilters=e,this.refresh()}getSelectedItems(){return this.selectedItems}},hs=class extends T.TreeItem{constructor(t,s,i,n){super(t,s);this.label=t;this.collapsibleState=s;this.testItem=i;this.type=n;this.tooltip=`${this.label}`,this.description=this.getDescription(),this.iconPath=this.getIcon(),this.contextValue=this.type,i&&(this.command={command:"vscode.open",title:"Open",arguments:[i.uri]})}getDescription(){if(this.type==="feature"&&this.testItem){let t=this.testItem.children.size;return t>0?`${t} scenarios`:""}return""}getIcon(){switch(this.type){case"feature":return new T.ThemeIcon("file-text");case"scenario":return new T.ThemeIcon("beaker");case"example":return new T.ThemeIcon("symbol-array");default:return new T.ThemeIcon("symbol-misc")}}};var A=P(require("vscode")),kt=P(require("path")),ds=class{constructor(e,t){this.outputChannel=e,this.workspaceRoot=t}async showSettingsUI(){if(this.webviewPanel){this.webviewPanel.reveal();return}this.webviewPanel=A.window.createWebviewPanel("bddSettings","BDD Test Runner Settings",A.ViewColumn.One,{enableScripts:!0,localResourceRoots:[],retainContextWhenHidden:!0}),this.webviewPanel.webview.html=await this.getSettingsWebviewContent(),this.webviewPanel.onDidDispose(()=>{this.webviewPanel=void 0}),this.webviewPanel.webview.onDidReceiveMessage(e=>this.handleWebviewMessage(e),void 0)}getConfigurationFields(){return[{key:"playwrightBdd.configPath",label:"Playwright Config Path",type:"path",description:"Path to the Playwright config file relative to the workspace root",defaultValue:"./playwright.config.ts",placeholder:"./playwright.config.ts",group:"core"},{key:"playwrightBdd.tsconfigPath",label:"TypeScript Config Path",type:"path",description:"Optional path to a custom tsconfig file for Playwright tests",defaultValue:"",placeholder:"./tsconfig.json",group:"core"},{key:"playwrightBdd.featureFolder",label:"Features Folder",type:"path",description:"Relative path to the folder containing .feature files",defaultValue:"features",placeholder:"features",group:"core"},{key:"playwrightBdd.stepsFolder",label:"Steps Folder",type:"path",description:"Relative path to the folder containing step definition files",defaultValue:"steps",placeholder:"steps",group:"core"},{key:"playwrightBdd.tags",label:"Default Tags Filter",type:"string",description:"Optional value for feature/scenario tags to filter tests. Used as --grep=<tags>",defaultValue:"",placeholder:"@smoke,@regression",group:"execution"},{key:"playwrightBdd.enableFeatureGen",label:"Enable Feature Generation",type:"boolean",description:"Whether to run the feature generation step before tests",defaultValue:!0,group:"execution"},{key:"playwrightBdd.testCommand",label:"Test Command Template",type:"command",description:"Command to run Playwright tests. Use ${configPath}, ${tsconfigArg}, and ${tagsArg} as placeholders.",defaultValue:"npx playwright test ${tsconfigArg} --config=${configPath} ${tagsArg}",placeholder:"npx playwright test --config=${configPath}",group:"execution"},{key:"playwrightBdd.featureGenCommand",label:"Feature Generation Command",type:"command",description:"Command to generate features. Use ${configPath} as a placeholder.",defaultValue:"npx bddgen --config=${configPath}",placeholder:"npx bddgen --config=${configPath}",group:"execution"},{key:"playwrightBdd.autoDiscoverConfig",label:"Auto-Discover Configuration",type:"boolean",description:"Automatically discover Playwright config, feature folders, and step folders",defaultValue:!0,group:"discovery"},{key:"playwrightBdd.stepsFilePattern",label:"Steps File Pattern",type:"string",description:"Glob pattern for step definition files",defaultValue:"**/*.{js,ts,mjs,mts}",placeholder:"**/*.{js,ts}",group:"discovery"},{key:"playwrightBdd.cicd.githubToken",label:"GitHub Token",type:"string",description:"Personal Access Token for GitHub API access (stored securely)",defaultValue:"",placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",group:"cicd"},{key:"playwrightBdd.cicd.autoTriggerWorkflows",label:"Auto-Trigger Workflows",type:"boolean",description:"Automatically trigger GitHub workflows on test execution",defaultValue:!1,group:"cicd"},{key:"playwrightBdd.execution.retryCount",label:"Test Retry Count",type:"number",description:"Number of retry attempts for failed test executions (1 = no retry, 2 = 1 retry, etc.)",defaultValue:2,group:"execution",validation:e=>{if(e<1||e>10)return"Retry count must be between 1 and 10"}},{key:"playwrightBdd.execution.retryDelay",label:"Retry Delay (milliseconds)",type:"number",description:"Delay between retry attempts in milliseconds",defaultValue:2e3,group:"execution",validation:e=>{if(e<100||e>3e4)return"Retry delay must be between 100ms and 30000ms"}},{key:"playwrightBdd.ui.showTagFilters",label:"Show Tag Filters",type:"boolean",description:"Show tag filtering options in the test explorer",defaultValue:!0,group:"ui"},{key:"playwrightBdd.ui.showStatusFilters",label:"Show Status Filters",type:"boolean",description:"Show status filtering options in the test explorer",defaultValue:!0,group:"ui"},{key:"playwrightBdd.ui.showExecutionHistory",label:"Show Execution History",type:"boolean",description:"Enable test execution history tracking",defaultValue:!0,group:"ui"},{key:"playwrightBdd.ui.autoRefreshInterval",label:"Auto-Refresh Interval (seconds)",type:"number",description:"Interval for auto-refreshing test discovery (0 to disable)",defaultValue:0,group:"ui"}]}getConfigurationGroups(){return[{name:"core",title:"Core Configuration",description:"Essential settings for Playwright BDD integration",icon:"gear"},{name:"execution",title:"Test Execution",description:"Settings for running and managing tests",icon:"play"},{name:"discovery",title:"Discovery & Automation",description:"Automatic discovery and detection settings",icon:"search"},{name:"cicd",title:"CI/CD Integration",description:"GitHub Actions and workflow integration",icon:"github"},{name:"ui",title:"User Interface",description:"UI customization and display preferences",icon:"browser"}]}async getSettingsWebviewContent(){let e=A.workspace.getConfiguration(),t=this.getConfigurationFields(),s=this.getConfigurationGroups(),i={};for(let n of t)i[n.key]=e.get(n.key,n.defaultValue);return`
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BDD Test Runner Settings</title>
        <style>
            body {
                font-family: var(--vscode-font-family);
                color: var(--vscode-foreground);
                background-color: var(--vscode-editor-background);
                padding: 0;
                margin: 0;
                line-height: 1.6;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            .header {
                border-bottom: 1px solid var(--vscode-panel-border);
                padding-bottom: 20px;
                margin-bottom: 30px;
            }
            .header h1 {
                margin: 0 0 10px 0;
                font-size: 24px;
                font-weight: 600;
            }
            .header p {
                margin: 0;
                color: var(--vscode-descriptionForeground);
                font-size: 14px;
            }
            .actions {
                margin-bottom: 30px;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            .btn {
                background: var(--vscode-button-background);
                color: var(--vscode-button-foreground);
                border: none;
                padding: 8px 16px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 13px;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .btn:hover {
                background: var(--vscode-button-hoverBackground);
            }
            .btn.secondary {
                background: var(--vscode-button-secondaryBackground);
                color: var(--vscode-button-secondaryForeground);
            }
            .btn.secondary:hover {
                background: var(--vscode-button-secondaryHoverBackground);
            }
            .settings-groups {
                display: grid;
                grid-template-columns: 250px 1fr;
                gap: 30px;
            }
            .group-nav {
                position: sticky;
                top: 20px;
                height: fit-content;
            }
            .group-nav-item {
                display: flex;
                align-items: center;
                padding: 12px;
                cursor: pointer;
                border-radius: 6px;
                margin-bottom: 4px;
                transition: background-color 0.15s;
                gap: 10px;
            }
            .group-nav-item:hover {
                background: var(--vscode-list-hoverBackground);
            }
            .group-nav-item.active {
                background: var(--vscode-list-activeSelectionBackground);
                color: var(--vscode-list-activeSelectionForeground);
            }
            .group-nav-icon {
                width: 16px;
                height: 16px;
                opacity: 0.8;
            }
            .group-nav-text {
                font-size: 13px;
                font-weight: 500;
            }
            .settings-content {
                min-height: 600px;
            }
            .settings-group {
                display: none;
                animation: fadeIn 0.2s ease-in;
            }
            .settings-group.active {
                display: block;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .group-header {
                margin-bottom: 20px;
            }
            .group-header h2 {
                margin: 0 0 8px 0;
                font-size: 18px;
                font-weight: 600;
            }
            .group-header p {
                margin: 0;
                color: var(--vscode-descriptionForeground);
                font-size: 14px;
            }
            .setting-item {
                margin-bottom: 24px;
                padding: 16px;
                background: var(--vscode-editor-inactiveSelectionBackground);
                border: 1px solid var(--vscode-panel-border);
                border-radius: 6px;
            }
            .setting-label {
                display: flex;
                align-items: center;
                margin-bottom: 6px;
                gap: 8px;
            }
            .setting-label h3 {
                margin: 0;
                font-size: 14px;
                font-weight: 500;
            }
            .setting-badge {
                background: var(--vscode-badge-background);
                color: var(--vscode-badge-foreground);
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 11px;
                text-transform: uppercase;
            }
            .setting-description {
                color: var(--vscode-descriptionForeground);
                font-size: 13px;
                margin-bottom: 12px;
                line-height: 1.5;
            }
            .setting-control {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .form-input {
                background: var(--vscode-input-background);
                color: var(--vscode-input-foreground);
                border: 1px solid var(--vscode-input-border);
                padding: 6px 8px;
                border-radius: 3px;
                font-size: 13px;
                flex: 1;
                min-width: 200px;
            }
            .form-input:focus {
                outline: 1px solid var(--vscode-focusBorder);
                border-color: var(--vscode-focusBorder);
            }
            .form-input.error {
                border-color: var(--vscode-inputValidation-errorBorder);
                background: var(--vscode-inputValidation-errorBackground);
            }
            .form-checkbox {
                width: 16px;
                height: 16px;
                accent-color: var(--vscode-checkbox-background);
            }
            .form-select {
                background: var(--vscode-dropdown-background);
                color: var(--vscode-dropdown-foreground);
                border: 1px solid var(--vscode-dropdown-border);
                padding: 6px 8px;
                border-radius: 3px;
                font-size: 13px;
                min-width: 150px;
            }
            .path-input-group {
                display: flex;
                gap: 8px;
                align-items: center;
                width: 100%;
            }
            .path-input {
                flex: 1;
            }
            .browse-btn {
                background: var(--vscode-button-secondaryBackground);
                color: var(--vscode-button-secondaryForeground);
                border: none;
                padding: 6px 12px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 12px;
                white-space: nowrap;
            }
            .browse-btn:hover {
                background: var(--vscode-button-secondaryHoverBackground);
            }
            .validation-error {
                color: var(--vscode-errorForeground);
                font-size: 12px;
                margin-top: 4px;
            }
            .setting-actions {
                margin-top: 12px;
                display: flex;
                gap: 8px;
            }
            .reset-btn {
                background: transparent;
                color: var(--vscode-button-secondaryForeground);
                border: 1px solid var(--vscode-button-border);
                padding: 4px 8px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 11px;
            }
            .reset-btn:hover {
                background: var(--vscode-button-secondaryHoverBackground);
            }
            .footer {
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid var(--vscode-panel-border);
                text-align: center;
                color: var(--vscode-descriptionForeground);
                font-size: 12px;
            }
            .status-indicator {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 500;
            }
            .status-indicator.success {
                background: var(--vscode-testing-iconPassed);
                color: white;
            }
            .status-indicator.warning {
                background: var(--vscode-testing-iconFailed);
                color: white;
            }
            @media (max-width: 768px) {
                .settings-groups {
                    grid-template-columns: 1fr;
                }
                .group-nav {
                    position: static;
                    display: flex;
                    overflow-x: auto;
                    gap: 8px;
                    margin-bottom: 20px;
                }
                .group-nav-item {
                    white-space: nowrap;
                    margin-bottom: 0;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>\u{1F9EA} BDD Test Runner Settings</h1>
                <p>Configure all aspects of your Playwright BDD testing experience</p>
            </div>

            <div class="actions">
                <button class="btn" onclick="saveAllSettings()">
                    <span>\u{1F4BE}</span> Save All Settings
                </button>
                <button class="btn secondary" onclick="resetToDefaults()">
                    <span>\u{1F504}</span> Reset to Defaults
                </button>
                <button class="btn secondary" onclick="exportSettings()">
                    <span>\u{1F4CB}</span> Export Settings
                </button>
                <button class="btn secondary" onclick="importSettings()">
                    <span>\u{1F4C1}</span> Import Settings
                </button>
                <button class="btn secondary" onclick="validateSettings()">
                    <span>\u2705</span> Validate Configuration
                </button>
            </div>

            <div class="settings-groups">
                <div class="group-nav">
                    ${s.map((n,r)=>`
                        <div class="group-nav-item ${r===0?"active":""}" 
                             onclick="showGroup('${n.name}')" 
                             data-group="${n.name}">
                            <div class="group-nav-icon">\u{1F517}</div>
                            <div class="group-nav-text">${n.title}</div>
                        </div>
                    `).join("")}
                </div>

                <div class="settings-content">
                    ${s.map((n,r)=>`
                        <div class="settings-group ${r===0?"active":""}" data-group="${n.name}">
                            <div class="group-header">
                                <h2>${n.title}</h2>
                                <p>${n.description}</p>
                            </div>
                            
                            ${t.filter(o=>o.group===n.name).map(o=>`
                                <div class="setting-item" data-key="${o.key}">
                                    <div class="setting-label">
                                        <h3>${o.label}</h3>
                                        <span class="setting-badge">${o.type}</span>
                                    </div>
                                    <div class="setting-description">${o.description}</div>
                                    <div class="setting-control">
                                        ${this.generateFormControl(o,i[o.key])}
                                    </div>
                                    <div class="setting-actions">
                                        <button class="reset-btn" onclick="resetSetting('${o.key}')">
                                            Reset to Default
                                        </button>
                                    </div>
                                </div>
                            `).join("")}
                        </div>
                    `).join("")}
                </div>
            </div>

            <div class="footer">
                <p>Settings are automatically saved to your workspace configuration</p>
                <div id="status-indicator" class="status-indicator success" style="display: none;">
                    <span>\u2713</span> Settings saved successfully
                </div>
            </div>
        </div>

        <script>
            const vscode = acquireVsCodeApi();
            
            function showGroup(groupName) {
                // Update navigation
                document.querySelectorAll('.group-nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.group === groupName);
                });
                
                // Update content
                document.querySelectorAll('.settings-group').forEach(group => {
                    group.classList.toggle('active', group.dataset.group === groupName);
                });
            }

            function saveAllSettings() {
                const settings = {};
                document.querySelectorAll('.setting-item').forEach(item => {
                    const key = item.dataset.key;
                    const input = item.querySelector('input, select');
                    if (input) {
                        if (input.type === 'checkbox') {
                            settings[key] = input.checked;
                        } else if (input.type === 'number') {
                            settings[key] = parseInt(input.value) || 0;
                        } else {
                            settings[key] = input.value;
                        }
                    }
                });
                
                vscode.postMessage({
                    command: 'saveSettings',
                    settings: settings
                });
                
                showStatus('Settings saved successfully', 'success');
            }

            function resetSetting(key) {
                vscode.postMessage({
                    command: 'resetSetting',
                    key: key
                });
            }

            function resetToDefaults() {
                if (confirm('Reset all settings to default values? This cannot be undone.')) {
                    vscode.postMessage({
                        command: 'resetAllSettings'
                    });
                }
            }

            function exportSettings() {
                vscode.postMessage({
                    command: 'exportSettings'
                });
            }

            function importSettings() {
                vscode.postMessage({
                    command: 'importSettings'
                });
            }

            function validateSettings() {
                vscode.postMessage({
                    command: 'validateSettings'
                });
            }

            function browsePath(inputId) {
                vscode.postMessage({
                    command: 'browsePath',
                    inputId: inputId
                });
            }

            function showStatus(message, type = 'success') {
                const indicator = document.getElementById('status-indicator');
                indicator.textContent = message;
                indicator.className = \`status-indicator \${type}\`;
                indicator.style.display = 'inline-flex';
                
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);
            }

            // Auto-save on input change
            document.addEventListener('input', (e) => {
                if (e.target.matches('input, select')) {
                    const settingItem = e.target.closest('.setting-item');
                    if (settingItem) {
                        const key = settingItem.dataset.key;
                        let value = e.target.value;
                        
                        if (e.target.type === 'checkbox') {
                            value = e.target.checked;
                        } else if (e.target.type === 'number') {
                            value = parseInt(value) || 0;
                        }
                        
                        vscode.postMessage({
                            command: 'updateSetting',
                            key: key,
                            value: value
                        });
                    }
                }
            });
        </script>
    </body>
    </html>`}generateFormControl(e,t){switch(e.type){case"boolean":return`<input type="checkbox" class="form-checkbox" ${t?"checked":""}>`;case"number":return`<input type="number" class="form-input" value="${t||e.defaultValue}" placeholder="${e.placeholder||""}">`;case"dropdown":return e.options?`
          <select class="form-select">
            ${e.options.map(i=>`<option value="${i}" ${t===i?"selected":""}>${i}</option>`).join("")}
          </select>`:"";case"path":let s=`path-${e.key.replace(/\./g,"-")}`;return`
          <div class="path-input-group">
            <input type="text" id="${s}" class="form-input path-input" 
                   value="${t||e.defaultValue}" 
                   placeholder="${e.placeholder||""}">
            <button class="browse-btn" onclick="browsePath('${s}')">Browse...</button>
          </div>`;case"command":return`<input type="text" class="form-input" value="${t||e.defaultValue}" placeholder="${e.placeholder||""}" style="font-family: monospace;">`;default:return`<input type="text" class="form-input" value="${t||e.defaultValue}" placeholder="${e.placeholder||""}">`}}async handleWebviewMessage(e){let t=A.workspace.getConfiguration();switch(e.command){case"saveSettings":await this.saveSettings(e.settings);break;case"updateSetting":await t.update(e.key,e.value,A.ConfigurationTarget.Workspace),this.outputChannel.appendLine(`Updated setting: ${e.key} = ${e.value}`);break;case"resetSetting":let s=this.getConfigurationFields().find(i=>i.key===e.key);s&&(await t.update(e.key,s.defaultValue,A.ConfigurationTarget.Workspace),this.refreshWebview());break;case"resetAllSettings":await this.resetAllSettings();break;case"exportSettings":await this.exportSettings();break;case"importSettings":await this.importSettings();break;case"validateSettings":await this.validateSettings();break;case"browsePath":await this.browsePath(e.inputId);break}}async saveSettings(e){let t=A.workspace.getConfiguration();for(let[s,i]of Object.entries(e))await t.update(s,i,A.ConfigurationTarget.Workspace);this.outputChannel.appendLine(`Saved ${Object.keys(e).length} settings`),A.window.showInformationMessage("Settings saved successfully!")}async resetAllSettings(){let e=A.workspace.getConfiguration(),t=this.getConfigurationFields();for(let s of t)await e.update(s.key,s.defaultValue,A.ConfigurationTarget.Workspace);this.outputChannel.appendLine("All settings reset to defaults"),A.window.showInformationMessage("All settings reset to default values!"),this.refreshWebview()}async exportSettings(){let e=A.workspace.getConfiguration(),t=this.getConfigurationFields(),s={timestamp:new Date().toISOString(),version:"0.4.0",settings:{}};for(let r of t)s.settings[r.key]=e.get(r.key,r.defaultValue);let i=JSON.stringify(s,null,2),n=await A.workspace.openTextDocument({content:i,language:"json"});await A.window.showTextDocument(n),A.window.showInformationMessage("Settings exported to new document. Save it to preserve your configuration.")}async importSettings(){let e=await A.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{"JSON Files":["json"]},title:"Import BDD Settings"});if(e&&e[0])try{let t=await A.workspace.fs.readFile(e[0]),s=JSON.parse(t.toString());s.settings?(await this.saveSettings(s.settings),this.refreshWebview(),A.window.showInformationMessage("Settings imported successfully!")):A.window.showErrorMessage("Invalid settings file format")}catch(t){A.window.showErrorMessage(`Failed to import settings: ${t}`)}}async validateSettings(){let e=A.workspace.getConfiguration(),t=this.getConfigurationFields(),s=[];for(let i of t){let n=e.get(i.key);if(i.validation){let r=i.validation(n);r&&s.push(`${i.label}: ${r}`)}if(i.type==="path"&&n)if(i.key==="playwrightBdd.tsconfigPath"){if(n&&typeof n=="string"&&n.trim()){let r=n.toString().trim();r=r.replace(/^--tsconfig=/,""),r=r.replace(/^--project=/,"");let o=kt.resolve(this.workspaceRoot,r);try{await A.workspace.fs.stat(A.Uri.file(o))}catch{s.push(`${i.label}: Path does not exist: ${r}`)}}}else{let r=kt.resolve(this.workspaceRoot,n);try{await A.workspace.fs.stat(A.Uri.file(r))}catch{s.push(`${i.label}: Path does not exist: ${n}`)}}}if(s.length===0)A.window.showInformationMessage("\u2705 All settings are valid!");else{let i=`Found ${s.length} configuration issues:

${s.join(`
`)}`;this.outputChannel.appendLine(i),this.outputChannel.show(),A.window.showWarningMessage(`Found ${s.length} configuration issues. Check output for details.`)}}async browsePath(e){let t=await A.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!0,canSelectMany:!1,defaultUri:A.Uri.file(this.workspaceRoot)});if(t&&t[0]){let s=kt.relative(this.workspaceRoot,t[0].fsPath);this.webviewPanel&&this.webviewPanel.webview.postMessage({command:"setPath",inputId:e,path:s})}}async refreshWebview(){this.webviewPanel&&(this.webviewPanel.webview.html=await this.getSettingsWebviewContent())}dispose(){this.webviewPanel&&this.webviewPanel.dispose()}};var lt=P(require("fs")),ri=P(require("path"));var kn=P(require("vscode")),De=P(require("fs")),ni=P(require("path"));var Ni=P(Ii(),1);var St=a=>{if(typeof a!="string")throw new TypeError("invalid pattern");if(a.length>65536)throw new TypeError("pattern is too long")};var Nn={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},xt=a=>a.replace(/[[\]\\-]/g,"\\$&"),Gn=a=>a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ai=a=>a.join(""),Li=(a,e)=>{let t=e;if(a.charAt(t)!=="[")throw new Error("not in a brace expression");let s=[],i=[],n=t+1,r=!1,o=!1,c=!1,l=!1,u=t,p="";e:for(;n<a.length;){let v=a.charAt(n);if((v==="!"||v==="^")&&n===t+1){l=!0,n++;continue}if(v==="]"&&r&&!c){u=n+1;break}if(r=!0,v==="\\"&&!c){c=!0,n++;continue}if(v==="["&&!c){for(let[C,[k,F,$]]of Object.entries(Nn))if(a.startsWith(C,n)){if(p)return["$.",!1,a.length-t,!0];n+=C.length,$?i.push(k):s.push(k),o=o||F;continue e}}if(c=!1,p){v>p?s.push(xt(p)+"-"+xt(v)):v===p&&s.push(xt(v)),p="",n++;continue}if(a.startsWith("-]",n+1)){s.push(xt(v+"-")),n+=2;continue}if(a.startsWith("-",n+1)){p=v,n+=2;continue}s.push(xt(v)),n++}if(u<n)return["",!1,0,!1];if(!s.length&&!i.length)return["$.",!1,a.length-t,!0];if(i.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!l){let v=s[0].length===2?s[0].slice(-1):s[0];return[Gn(v),!1,u-t,!1]}let f="["+(l?"^":"")+Ai(s)+"]",g="["+(l?"":"^")+Ai(i)+"]";return[s.length&&i.length?"("+f+"|"+g+")":s.length?f:g,o,u-t,!0]};var me=(a,{windowsPathsNoEscape:e=!1}={})=>e?a.replace(/\[([^\/\\])\]/g,"$1"):a.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Hn=new Set(["!","?","+","*","@"]),Mi=a=>Hn.has(a),zn="(?!(?:^|/)\\.\\.?(?:$|/))",us="(?!\\.)",_n=new Set(["[","."]),Un=new Set(["..","."]),Vn=new Set("().*{}+?[]^$\\!"),qn=a=>a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Gs="[^/]",Wi=Gs+"*?",Bi=Gs+"+?",Ye=class a{type;#e;#t;#r=!1;#i=[];#o;#b;#l;#d=!1;#a;#c;#n=!1;constructor(e,t,s={}){this.type=e,e&&(this.#t=!0),this.#o=t,this.#e=this.#o?this.#o.#e:this,this.#a=this.#e===this?s:this.#e.#a,this.#l=this.#e===this?[]:this.#e.#l,e==="!"&&!this.#e.#d&&this.#l.push(this),this.#b=this.#o?this.#o.#i.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(let e of this.#i)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#i.map(e=>String(e)).join("|")+")":this.#c=this.#i.map(e=>String(e)).join("")}#m(){if(this!==this.#e)throw new Error("should only call on root");if(this.#d)return this;this.toString(),this.#d=!0;let e;for(;e=this.#l.pop();){if(e.type!=="!")continue;let t=e,s=t.#o;for(;s;){for(let i=t.#b+1;!s.type&&i<s.#i.length;i++)for(let n of e.#i){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(s.#i[i])}t=s,s=t.#o}}return this}push(...e){for(let t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof a&&t.#o===this))throw new Error("invalid part: "+t);this.#i.push(t)}}toJSON(){let e=this.type===null?this.#i.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#i.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#d&&this.#o?.type==="!")&&e.push({}),e}isStart(){if(this.#e===this)return!0;if(!this.#o?.isStart())return!1;if(this.#b===0)return!0;let e=this.#o;for(let t=0;t<this.#b;t++){let s=e.#i[t];if(!(s instanceof a&&s.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#o?.type==="!")return!0;if(!this.#o?.isEnd())return!1;if(!this.type)return this.#o?.isEnd();let e=this.#o?this.#o.#i.length:0;return this.#b===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let t=new a(this.type,e);for(let s of this.#i)t.copyIn(s);return t}static#w(e,t,s,i){let n=!1,r=!1,o=-1,c=!1;if(t.type===null){let g=s,b="";for(;g<e.length;){let v=e.charAt(g++);if(n||v==="\\"){n=!n,b+=v;continue}if(r){g===o+1?(v==="^"||v==="!")&&(c=!0):v==="]"&&!(g===o+2&&c)&&(r=!1),b+=v;continue}else if(v==="["){r=!0,o=g,c=!1,b+=v;continue}if(!i.noext&&Mi(v)&&e.charAt(g)==="("){t.push(b),b="";let C=new a(v,t);g=a.#w(e,C,g,i),t.push(C);continue}b+=v}return t.push(b),g}let l=s+1,u=new a(null,t),p=[],f="";for(;l<e.length;){let g=e.charAt(l++);if(n||g==="\\"){n=!n,f+=g;continue}if(r){l===o+1?(g==="^"||g==="!")&&(c=!0):g==="]"&&!(l===o+2&&c)&&(r=!1),f+=g;continue}else if(g==="["){r=!0,o=l,c=!1,f+=g;continue}if(Mi(g)&&e.charAt(l)==="("){u.push(f),f="";let b=new a(g,u);u.push(b),l=a.#w(e,b,l,i);continue}if(g==="|"){u.push(f),f="",p.push(u),u=new a(null,t);continue}if(g===")")return f===""&&t.#i.length===0&&(t.#n=!0),u.push(f),f="",t.push(...p,u),l;f+=g}return t.type=null,t.#t=void 0,t.#i=[e.substring(s-1)],l}static fromGlob(e,t={}){let s=new a(null,void 0,t);return a.#w(e,s,0,t),s}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();let e=this.toString(),[t,s,i,n]=this.toRegExpSource();if(!(i||this.#t||this.#a.nocase&&!this.#a.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;let o=(this.#a.nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${t}$`,o),{_src:t,_glob:e})}get options(){return this.#a}toRegExpSource(e){let t=e??!!this.#a.dot;if(this.#e===this&&this.#m(),!this.type){let c=this.isStart()&&this.isEnd(),l=this.#i.map(g=>{let[b,v,C,k]=typeof g=="string"?a.#u(g,this.#t,c):g.toRegExpSource(e);return this.#t=this.#t||C,this.#r=this.#r||k,b}).join(""),u="";if(this.isStart()&&typeof this.#i[0]=="string"&&!(this.#i.length===1&&Un.has(this.#i[0]))){let b=_n,v=t&&b.has(l.charAt(0))||l.startsWith("\\.")&&b.has(l.charAt(2))||l.startsWith("\\.\\.")&&b.has(l.charAt(4)),C=!t&&!e&&b.has(l.charAt(0));u=v?zn:C?us:""}let p="";return this.isEnd()&&this.#e.#d&&this.#o?.type==="!"&&(p="(?:$|\\/)"),[u+l+p,me(l),this.#t=!!this.#t,this.#r]}let s=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",n=this.#p(t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){let c=this.toString();return this.#i=[c],this.type=null,this.#t=void 0,[c,me(this.toString()),!1,!1]}let r=!s||e||t||!us?"":this.#p(!0);r===n&&(r=""),r&&(n=`(?:${n})(?:${r})*?`);let o="";if(this.type==="!"&&this.#n)o=(this.isStart()&&!t?us:"")+Bi;else{let c=this.type==="!"?"))"+(this.isStart()&&!t&&!e?us:"")+Wi+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&r?")":this.type==="*"&&r?")?":`)${this.type}`;o=i+n+c}return[o,me(n),this.#t=!!this.#t,this.#r]}#p(e){return this.#i.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");let[s,i,n,r]=t.toRegExpSource(e);return this.#r=this.#r||r,s}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")}static#u(e,t,s=!1){let i=!1,n="",r=!1;for(let o=0;o<e.length;o++){let c=e.charAt(o);if(i){i=!1,n+=(Vn.has(c)?"\\":"")+c;continue}if(c==="\\"){o===e.length-1?n+="\\\\":i=!0;continue}if(c==="["){let[l,u,p,f]=Li(e,o);if(p){n+=l,r=r||u,o+=p-1,t=t||f;continue}}if(c==="*"){s&&e==="*"?n+=Bi:n+=Wi,t=!0;continue}if(c==="?"){n+=Gs,t=!0;continue}n+=qn(c)}return[n,me(e),!!t,r]}};var Ze=(a,{windowsPathsNoEscape:e=!1}={})=>e?a.replace(/[?*()[\]]/g,"[$&]"):a.replace(/[?*()[\]\\]/g,"\\$&");var se=(a,e,t={})=>(St(e),!t.nocomment&&e.charAt(0)==="#"?!1:new ae(e,t).match(a)),Qn=/^\*+([^+@!?\*\[\(]*)$/,Jn=a=>e=>!e.startsWith(".")&&e.endsWith(a),Kn=a=>e=>e.endsWith(a),Yn=a=>(a=a.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(a)),Zn=a=>(a=a.toLowerCase(),e=>e.toLowerCase().endsWith(a)),Xn=/^\*+\.\*+$/,er=a=>!a.startsWith(".")&&a.includes("."),tr=a=>a!=="."&&a!==".."&&a.includes("."),sr=/^\.\*+$/,ir=a=>a!=="."&&a!==".."&&a.startsWith("."),nr=/^\*+$/,rr=a=>a.length!==0&&!a.startsWith("."),or=a=>a.length!==0&&a!=="."&&a!=="..",ar=/^\?+([^+@!?\*\[\(]*)?$/,cr=([a,e=""])=>{let t=Gi([a]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},lr=([a,e=""])=>{let t=Hi([a]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},hr=([a,e=""])=>{let t=Hi([a]);return e?s=>t(s)&&s.endsWith(e):t},dr=([a,e=""])=>{let t=Gi([a]);return e?s=>t(s)&&s.endsWith(e):t},Gi=([a])=>{let e=a.length;return t=>t.length===e&&!t.startsWith(".")},Hi=([a])=>{let e=a.length;return t=>t.length===e&&t!=="."&&t!==".."},zi=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Oi={win32:{sep:"\\"},posix:{sep:"/"}},ur=zi==="win32"?Oi.win32.sep:Oi.posix.sep;se.sep=ur;var Q=Symbol("globstar **");se.GLOBSTAR=Q;var pr="[^/]",fr=pr+"*?",gr="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",mr="(?:(?!(?:\\/|^)\\.).)*?",wr=(a,e={})=>t=>se(t,a,e);se.filter=wr;var ue=(a,e={})=>Object.assign({},a,e),vr=a=>{if(!a||typeof a!="object"||!Object.keys(a).length)return se;let e=se;return Object.assign((s,i,n={})=>e(s,i,ue(a,n)),{Minimatch:class extends e.Minimatch{constructor(i,n={}){super(i,ue(a,n))}static defaults(i){return e.defaults(ue(a,i)).Minimatch}},AST:class extends e.AST{constructor(i,n,r={}){super(i,n,ue(a,r))}static fromGlob(i,n={}){return e.AST.fromGlob(i,ue(a,n))}},unescape:(s,i={})=>e.unescape(s,ue(a,i)),escape:(s,i={})=>e.escape(s,ue(a,i)),filter:(s,i={})=>e.filter(s,ue(a,i)),defaults:s=>e.defaults(ue(a,s)),makeRe:(s,i={})=>e.makeRe(s,ue(a,i)),braceExpand:(s,i={})=>e.braceExpand(s,ue(a,i)),match:(s,i,n={})=>e.match(s,i,ue(a,n)),sep:e.sep,GLOBSTAR:Q})};se.defaults=vr;var _i=(a,e={})=>(St(a),e.nobrace||!/\{(?:(?!\{).)*\}/.test(a)?[a]:(0,Ni.default)(a));se.braceExpand=_i;var yr=(a,e={})=>new ae(a,e).makeRe();se.makeRe=yr;var br=(a,e,t={})=>{let s=new ae(e,t);return a=a.filter(i=>s.match(i)),s.options.nonull&&!a.length&&a.push(e),a};se.match=br;var ji=/[?*]|[+@!]\(.*?\)|\[|\]/,kr=a=>a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ae=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){St(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||zi,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let i=this.globParts.map((n,r,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){let c=n[0]===""&&n[1]===""&&(n[2]==="?"||!ji.test(n[2]))&&!ji.test(n[3]),l=/^[a-z]:/i.test(n[0]);if(c)return[...n.slice(0,4),...n.slice(4).map(u=>this.parse(u))];if(l)return[n[0],...n.slice(1).map(u=>this.parse(u))]}return n.map(c=>this.parse(c))});if(this.debug(this.pattern,i),this.set=i.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let r=this.set[n];r[0]===""&&r[1]===""&&this.globParts[n][2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3])&&(r[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let i=0;i<e[s].length;i++)e[s][i]==="**"&&(e[s][i]="*");let{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let i=s;for(;t[i+1]==="**";)i++;i!==s&&t.splice(s,i-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,i)=>{let n=s[s.length-1];return i==="**"&&n==="**"?s:i===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(i),s)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let i=1;i<e.length-1;i++){let n=e[i];i===1&&n===""&&e[0]===""||(n==="."||n==="")&&(t=!0,e.splice(i,1),i--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){let i=e[s-1];i&&i!=="."&&i!==".."&&i!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let i=-1;for(;(i=s.indexOf("**",i+1))!==-1;){let r=i;for(;s[r+1]==="**";)r++;r>i&&s.splice(i+1,r-i);let o=s[i+1],c=s[i+2],l=s[i+3];if(o!==".."||!c||c==="."||c===".."||!l||l==="."||l==="..")continue;t=!0,s.splice(i,1);let u=s.slice(0);u[i]="**",e.push(u),i--}if(!this.preserveMultipleSlashes){for(let r=1;r<s.length-1;r++){let o=s[r];r===1&&o===""&&s[0]===""||(o==="."||o==="")&&(t=!0,s.splice(r,1),r--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){let r=s[n-1];if(r&&r!=="."&&r!==".."&&r!=="**"){t=!0;let c=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...c),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){let i=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(i){e[t]=[],e[s]=i;break}}return e.filter(t=>t.length)}partsMatch(e,t,s=!1){let i=0,n=0,r=[],o="";for(;i<e.length&&n<t.length;)if(e[i]===t[n])r.push(o==="b"?t[n]:e[i]),i++,n++;else if(s&&e[i]==="**"&&t[n]===e[i+1])r.push(e[i]),i++;else if(s&&t[n]==="**"&&e[i]===t[n+1])r.push(t[n]),n++;else if(e[i]==="*"&&t[n]&&(this.options.dot||!t[n].startsWith("."))&&t[n]!=="**"){if(o==="b")return!1;o="a",r.push(e[i]),i++,n++}else if(t[n]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(o==="a")return!1;o="b",r.push(t[n]),i++,n++}else return!1;return e.length===t.length&&r}parseNegate(){if(this.nonegate)return;let e=this.pattern,t=!1,s=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t,s=!1){let i=this.options;if(this.isWindows){let v=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),C=!v&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),k=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),F=!k&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),$=C?3:v?0:void 0,x=F?3:k?0:void 0;if(typeof $=="number"&&typeof x=="number"){let[E,I]=[e[$],t[x]];E.toLowerCase()===I.toLowerCase()&&(t[x]=E,x>$?t=t.slice(x):$>x&&(e=e.slice($)))}}let{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var r=0,o=0,c=e.length,l=t.length;r<c&&o<l;r++,o++){this.debug("matchOne loop");var u=t[o],p=e[r];if(this.debug(t,u,p),u===!1)return!1;if(u===Q){this.debug("GLOBSTAR",[t,u,p]);var f=r,g=o+1;if(g===l){for(this.debug("** at the end");r<c;r++)if(e[r]==="."||e[r]===".."||!i.dot&&e[r].charAt(0)===".")return!1;return!0}for(;f<c;){var b=e[f];if(this.debug(`
globstar while`,e,f,t,g,b),this.matchOne(e.slice(f),t.slice(g),s))return this.debug("globstar found match!",f,c,b),!0;if(b==="."||b===".."||!i.dot&&b.charAt(0)==="."){this.debug("dot detected!",e,f,t,g);break}this.debug("globstar swallow a segment, and continue"),f++}return!!(s&&(this.debug(`
>>> no match, partial?`,e,f,t,g),f===c))}let v;if(typeof u=="string"?(v=p===u,this.debug("string match",u,p,v)):(v=u.test(p),this.debug("pattern match",u,p,v)),!v)return!1}if(r===c&&o===l)return!0;if(r===c)return s;if(o===l)return r===c-1&&e[r]==="";throw new Error("wtf?")}braceExpand(){return _i(this.pattern,this.options)}parse(e){St(e);let t=this.options;if(e==="**")return Q;if(e==="")return"";let s,i=null;(s=e.match(nr))?i=t.dot?or:rr:(s=e.match(Qn))?i=(t.nocase?t.dot?Zn:Yn:t.dot?Kn:Jn)(s[1]):(s=e.match(ar))?i=(t.nocase?t.dot?lr:cr:t.dot?hr:dr)(s):(s=e.match(Xn))?i=t.dot?tr:er:(s=e.match(sr))&&(i=ir);let n=Ye.fromGlob(e,this.options).toMMPattern();return i&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:i}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,s=t.noglobstar?fr:t.dot?gr:mr,i=new Set(t.nocase?["i"]:[]),n=e.map(c=>{let l=c.map(u=>{if(u instanceof RegExp)for(let p of u.flags.split(""))i.add(p);return typeof u=="string"?kr(u):u===Q?Q:u._src});return l.forEach((u,p)=>{let f=l[p+1],g=l[p-1];u!==Q||g===Q||(g===void 0?f!==void 0&&f!==Q?l[p+1]="(?:\\/|"+s+"\\/)?"+f:l[p]=s:f===void 0?l[p-1]=g+"(?:\\/|"+s+")?":f!==Q&&(l[p-1]=g+"(?:\\/|\\/"+s+"\\/)"+f,l[p+1]=Q))}),l.filter(u=>u!==Q).join("/")}).join("|"),[r,o]=e.length>1?["(?:",")"]:["",""];n="^"+r+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let s=this.options;this.isWindows&&(e=e.split("\\").join("/"));let i=this.slashSplit(e);this.debug(this.pattern,"split",i);let n=this.set;this.debug(this.pattern,"set",n);let r=i[i.length-1];if(!r)for(let o=i.length-2;!r&&o>=0;o--)r=i[o];for(let o=0;o<n.length;o++){let c=n[o],l=i;if(s.matchBase&&c.length===1&&(l=[r]),this.matchOne(l,c,t))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(e){return se.defaults(e).Minimatch}};se.AST=Ye;se.Minimatch=ae;se.escape=Ze;se.unescape=me;var gn=require("node:url");var Xe=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Vi=new Set,Hs=typeof process=="object"&&process?process:{},qi=(a,e,t,s)=>{typeof Hs.emitWarning=="function"?Hs.emitWarning(a,e,t,s):console.error(`[${t}] ${e}: ${a}`)},ps=globalThis.AbortController,Ui=globalThis.AbortSignal;if(typeof ps>"u"){Ui=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,i){this._onabort.push(i)}},ps=class{constructor(){e()}signal=new Ui;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(let i of this.signal._onabort)i(s);this.signal.onabort?.(s)}}};let a=Hs.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",e=()=>{a&&(a=!1,qi("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}var Cr=a=>!Vi.has(a),Uo=Symbol("type"),Oe=a=>a&&a===Math.floor(a)&&a>0&&isFinite(a),Qi=a=>Oe(a)?a<=Math.pow(2,8)?Uint8Array:a<=Math.pow(2,16)?Uint16Array:a<=Math.pow(2,32)?Uint32Array:a<=Number.MAX_SAFE_INTEGER?et:null:null,et=class extends Array{constructor(e){super(e),this.fill(0)}},zs=class a{heap;length;static#e=!1;static create(e){let t=Qi(e);if(!t)return[];a.#e=!0;let s=new a(e,t);return a.#e=!1,s}constructor(e,t){if(!a.#e)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},Tt=class a{#e;#t;#r;#i;#o;#b;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#l;#d;#a;#c;#n;#m;#w;#p;#u;#S;#g;#x;#T;#y;#k;#C;#f;static unsafeExposeInternals(e){return{starts:e.#T,ttls:e.#y,sizes:e.#x,keyMap:e.#a,keyList:e.#c,valList:e.#n,next:e.#m,prev:e.#w,get head(){return e.#p},get tail(){return e.#u},free:e.#S,isBackgroundFetch:t=>e.#h(t),backgroundFetch:(t,s,i,n)=>e.#O(t,s,i,n),moveToTail:t=>e.#N(t),indexes:t=>e.#$(t),rindexes:t=>e.#P(t),isStale:t=>e.#v(t)}}get max(){return this.#e}get maxSize(){return this.#t}get calculatedSize(){return this.#d}get size(){return this.#l}get fetchMethod(){return this.#o}get memoMethod(){return this.#b}get dispose(){return this.#r}get disposeAfter(){return this.#i}constructor(e){let{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:n,updateAgeOnGet:r,updateAgeOnHas:o,allowStale:c,dispose:l,disposeAfter:u,noDisposeOnSet:p,noUpdateTTL:f,maxSize:g=0,maxEntrySize:b=0,sizeCalculation:v,fetchMethod:C,memoMethod:k,noDeleteOnFetchRejection:F,noDeleteOnStaleGet:$,allowStaleOnFetchRejection:x,allowStaleOnFetchAbort:E,ignoreFetchAbort:I}=e;if(t!==0&&!Oe(t))throw new TypeError("max option must be a nonnegative integer");let L=t?Qi(t):Array;if(!L)throw new Error("invalid max value: "+t);if(this.#e=t,this.#t=g,this.maxEntrySize=b||this.#t,this.sizeCalculation=v,this.sizeCalculation){if(!this.#t&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(k!==void 0&&typeof k!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#b=k,C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#o=C,this.#C=!!C,this.#a=new Map,this.#c=new Array(t).fill(void 0),this.#n=new Array(t).fill(void 0),this.#m=new L(t),this.#w=new L(t),this.#p=0,this.#u=0,this.#S=zs.create(t),this.#l=0,this.#d=0,typeof l=="function"&&(this.#r=l),typeof u=="function"?(this.#i=u,this.#g=[]):(this.#i=void 0,this.#g=void 0),this.#k=!!this.#r,this.#f=!!this.#i,this.noDisposeOnSet=!!p,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!F,this.allowStaleOnFetchRejection=!!x,this.allowStaleOnFetchAbort=!!E,this.ignoreFetchAbort=!!I,this.maxEntrySize!==0){if(this.#t!==0&&!Oe(this.#t))throw new TypeError("maxSize must be a positive integer if specified");if(!Oe(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#E()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!$,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!o,this.ttlResolution=Oe(i)||i===0?i:1,this.ttlAutopurge=!!n,this.ttl=s||0,this.ttl){if(!Oe(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#F()}if(this.#e===0&&this.ttl===0&&this.#t===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#t){let le="LRU_CACHE_UNBOUNDED";Cr(le)&&(Vi.add(le),qi("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",le,a))}}getRemainingTTL(e){return this.#a.has(e)?1/0:0}#F(){let e=new et(this.#e),t=new et(this.#e);this.#y=e,this.#T=t,this.#I=(n,r,o=Xe.now())=>{if(t[n]=r!==0?o:0,e[n]=r,r!==0&&this.ttlAutopurge){let c=setTimeout(()=>{this.#v(n)&&this.#R(this.#c[n],"expire")},r+1);c.unref&&c.unref()}},this.#D=n=>{t[n]=e[n]!==0?Xe.now():0},this.#s=(n,r)=>{if(e[r]){let o=e[r],c=t[r];if(!o||!c)return;n.ttl=o,n.start=c,n.now=s||i();let l=n.now-c;n.remainingTTL=o-l}};let s=0,i=()=>{let n=Xe.now();if(this.ttlResolution>0){s=n;let r=setTimeout(()=>s=0,this.ttlResolution);r.unref&&r.unref()}return n};this.getRemainingTTL=n=>{let r=this.#a.get(n);if(r===void 0)return 0;let o=e[r],c=t[r];if(!o||!c)return 1/0;let l=(s||i())-c;return o-l},this.#v=n=>{let r=t[n],o=e[n];return!!o&&!!r&&(s||i())-r>o}}#D=()=>{};#s=()=>{};#I=()=>{};#v=()=>!1;#E(){let e=new et(this.#e);this.#d=0,this.#x=e,this.#A=t=>{this.#d-=e[t],e[t]=0},this.#M=(t,s,i,n)=>{if(this.#h(s))return 0;if(!Oe(i))if(n){if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(i=n(s,t),!Oe(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#L=(t,s,i)=>{if(e[t]=s,this.#t){let n=this.#t-e[t];for(;this.#d>n;)this.#B(!0)}this.#d+=e[t],i&&(i.entrySize=s,i.totalCalculatedSize=this.#d)}}#A=e=>{};#L=(e,t,s)=>{};#M=(e,t,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#$({allowStale:e=this.allowStale}={}){if(this.#l)for(let t=this.#u;!(!this.#W(t)||((e||!this.#v(t))&&(yield t),t===this.#p));)t=this.#w[t]}*#P({allowStale:e=this.allowStale}={}){if(this.#l)for(let t=this.#p;!(!this.#W(t)||((e||!this.#v(t))&&(yield t),t===this.#u));)t=this.#m[t]}#W(e){return e!==void 0&&this.#a.get(this.#c[e])===e}*entries(){for(let e of this.#$())this.#n[e]!==void 0&&this.#c[e]!==void 0&&!this.#h(this.#n[e])&&(yield[this.#c[e],this.#n[e]])}*rentries(){for(let e of this.#P())this.#n[e]!==void 0&&this.#c[e]!==void 0&&!this.#h(this.#n[e])&&(yield[this.#c[e],this.#n[e]])}*keys(){for(let e of this.#$()){let t=this.#c[e];t!==void 0&&!this.#h(this.#n[e])&&(yield t)}}*rkeys(){for(let e of this.#P()){let t=this.#c[e];t!==void 0&&!this.#h(this.#n[e])&&(yield t)}}*values(){for(let e of this.#$())this.#n[e]!==void 0&&!this.#h(this.#n[e])&&(yield this.#n[e])}*rvalues(){for(let e of this.#P())this.#n[e]!==void 0&&!this.#h(this.#n[e])&&(yield this.#n[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let s of this.#$()){let i=this.#n[s],n=this.#h(i)?i.__staleWhileFetching:i;if(n!==void 0&&e(n,this.#c[s],this))return this.get(this.#c[s],t)}}forEach(e,t=this){for(let s of this.#$()){let i=this.#n[s],n=this.#h(i)?i.__staleWhileFetching:i;n!==void 0&&e.call(t,n,this.#c[s],this)}}rforEach(e,t=this){for(let s of this.#P()){let i=this.#n[s],n=this.#h(i)?i.__staleWhileFetching:i;n!==void 0&&e.call(t,n,this.#c[s],this)}}purgeStale(){let e=!1;for(let t of this.#P({allowStale:!0}))this.#v(t)&&(this.#R(this.#c[t],"expire"),e=!0);return e}info(e){let t=this.#a.get(e);if(t===void 0)return;let s=this.#n[t],i=this.#h(s)?s.__staleWhileFetching:s;if(i===void 0)return;let n={value:i};if(this.#y&&this.#T){let r=this.#y[t],o=this.#T[t];if(r&&o){let c=r-(Xe.now()-o);n.ttl=c,n.start=Date.now()}}return this.#x&&(n.size=this.#x[t]),n}dump(){let e=[];for(let t of this.#$({allowStale:!0})){let s=this.#c[t],i=this.#n[t],n=this.#h(i)?i.__staleWhileFetching:i;if(n===void 0||s===void 0)continue;let r={value:n};if(this.#y&&this.#T){r.ttl=this.#y[t];let o=Xe.now()-this.#T[t];r.start=Math.floor(Date.now()-o)}this.#x&&(r.size=this.#x[t]),e.unshift([s,r])}return e}load(e){this.clear();for(let[t,s]of e){if(s.start){let i=Date.now()-s.start;s.start=Xe.now()-i}this.set(t,s.value,s)}}set(e,t,s={}){if(t===void 0)return this.delete(e),this;let{ttl:i=this.ttl,start:n,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:c}=s,{noUpdateTTL:l=this.noUpdateTTL}=s,u=this.#M(e,t,s.size||0,o);if(this.maxEntrySize&&u>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.#R(e,"set"),this;let p=this.#l===0?void 0:this.#a.get(e);if(p===void 0)p=this.#l===0?this.#u:this.#S.length!==0?this.#S.pop():this.#l===this.#e?this.#B(!1):this.#l,this.#c[p]=e,this.#n[p]=t,this.#a.set(e,p),this.#m[this.#u]=p,this.#w[p]=this.#u,this.#u=p,this.#l++,this.#L(p,u,c),c&&(c.set="add"),l=!1;else{this.#N(p);let f=this.#n[p];if(t!==f){if(this.#C&&this.#h(f)){f.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:g}=f;g!==void 0&&!r&&(this.#k&&this.#r?.(g,e,"set"),this.#f&&this.#g?.push([g,e,"set"]))}else r||(this.#k&&this.#r?.(f,e,"set"),this.#f&&this.#g?.push([f,e,"set"]));if(this.#A(p),this.#L(p,u,c),this.#n[p]=t,c){c.set="replace";let g=f&&this.#h(f)?f.__staleWhileFetching:f;g!==void 0&&(c.oldValue=g)}}else c&&(c.set="update")}if(i!==0&&!this.#y&&this.#F(),this.#y&&(l||this.#I(p,i,n),c&&this.#s(c,p)),!r&&this.#f&&this.#g){let f=this.#g,g;for(;g=f?.shift();)this.#i?.(...g)}return this}pop(){try{for(;this.#l;){let e=this.#n[this.#p];if(this.#B(!0),this.#h(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#f&&this.#g){let e=this.#g,t;for(;t=e?.shift();)this.#i?.(...t)}}}#B(e){let t=this.#p,s=this.#c[t],i=this.#n[t];return this.#C&&this.#h(i)?i.__abortController.abort(new Error("evicted")):(this.#k||this.#f)&&(this.#k&&this.#r?.(i,s,"evict"),this.#f&&this.#g?.push([i,s,"evict"])),this.#A(t),e&&(this.#c[t]=void 0,this.#n[t]=void 0,this.#S.push(t)),this.#l===1?(this.#p=this.#u=0,this.#S.length=0):this.#p=this.#m[t],this.#a.delete(s),this.#l--,t}has(e,t={}){let{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=t,n=this.#a.get(e);if(n!==void 0){let r=this.#n[n];if(this.#h(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#v(n))i&&(i.has="stale",this.#s(i,n));else return s&&this.#D(n),i&&(i.has="hit",this.#s(i,n)),!0}else i&&(i.has="miss");return!1}peek(e,t={}){let{allowStale:s=this.allowStale}=t,i=this.#a.get(e);if(i===void 0||!s&&this.#v(i))return;let n=this.#n[i];return this.#h(n)?n.__staleWhileFetching:n}#O(e,t,s,i){let n=t===void 0?void 0:this.#n[t];if(this.#h(n))return n;let r=new ps,{signal:o}=s;o?.addEventListener("abort",()=>r.abort(o.reason),{signal:r.signal});let c={signal:r.signal,options:s,context:i},l=(v,C=!1)=>{let{aborted:k}=r.signal,F=s.ignoreFetchAbort&&v!==void 0;if(s.status&&(k&&!C?(s.status.fetchAborted=!0,s.status.fetchError=r.signal.reason,F&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),k&&!F&&!C)return p(r.signal.reason);let $=g;return this.#n[t]===g&&(v===void 0?$.__staleWhileFetching?this.#n[t]=$.__staleWhileFetching:this.#R(e,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(e,v,c.options))),v},u=v=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=v),p(v)),p=v=>{let{aborted:C}=r.signal,k=C&&s.allowStaleOnFetchAbort,F=k||s.allowStaleOnFetchRejection,$=F||s.noDeleteOnFetchRejection,x=g;if(this.#n[t]===g&&(!$||x.__staleWhileFetching===void 0?this.#R(e,"fetch"):k||(this.#n[t]=x.__staleWhileFetching)),F)return s.status&&x.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),x.__staleWhileFetching;if(x.__returned===x)throw v},f=(v,C)=>{let k=this.#o?.(e,n,c);k&&k instanceof Promise&&k.then(F=>v(F===void 0?void 0:F),C),r.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(v(void 0),s.allowStaleOnFetchAbort&&(v=F=>l(F,!0)))})};s.status&&(s.status.fetchDispatched=!0);let g=new Promise(f).then(l,u),b=Object.assign(g,{__abortController:r,__staleWhileFetching:n,__returned:void 0});return t===void 0?(this.set(e,b,{...c.options,status:void 0}),t=this.#a.get(e)):this.#n[t]=b,b}#h(e){if(!this.#C)return!1;let t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof ps}async fetch(e,t={}){let{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:c=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:b=this.allowStaleOnFetchAbort,context:v,forceRefresh:C=!1,status:k,signal:F}=t;if(!this.#C)return k&&(k.fetch="get"),this.get(e,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,status:k});let $={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,ttl:r,noDisposeOnSet:o,size:c,sizeCalculation:l,noUpdateTTL:u,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:b,ignoreFetchAbort:g,status:k,signal:F},x=this.#a.get(e);if(x===void 0){k&&(k.fetch="miss");let E=this.#O(e,x,$,v);return E.__returned=E}else{let E=this.#n[x];if(this.#h(E)){let H=s&&E.__staleWhileFetching!==void 0;return k&&(k.fetch="inflight",H&&(k.returnedStale=!0)),H?E.__staleWhileFetching:E.__returned=E}let I=this.#v(x);if(!C&&!I)return k&&(k.fetch="hit"),this.#N(x),i&&this.#D(x),k&&this.#s(k,x),E;let L=this.#O(e,x,$,v),W=L.__staleWhileFetching!==void 0&&s;return k&&(k.fetch=I?"stale":"refresh",W&&I&&(k.returnedStale=!0)),W?L.__staleWhileFetching:L.__returned=L}}async forceFetch(e,t={}){let s=await this.fetch(e,t);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(e,t={}){let s=this.#b;if(!s)throw new Error("no memoMethod provided to constructor");let{context:i,forceRefresh:n,...r}=t,o=this.get(e,r);if(!n&&o!==void 0)return o;let c=s(e,o,{options:r,context:i});return this.set(e,c,r),c}get(e,t={}){let{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:r}=t,o=this.#a.get(e);if(o!==void 0){let c=this.#n[o],l=this.#h(c);return r&&this.#s(r,o),this.#v(o)?(r&&(r.get="stale"),l?(r&&s&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),s?c.__staleWhileFetching:void 0):(n||this.#R(e,"expire"),r&&s&&(r.returnedStale=!0),s?c:void 0)):(r&&(r.get="hit"),l?c.__staleWhileFetching:(this.#N(o),i&&this.#D(o),c))}else r&&(r.get="miss")}#j(e,t){this.#w[t]=e,this.#m[e]=t}#N(e){e!==this.#u&&(e===this.#p?this.#p=this.#m[e]:this.#j(this.#w[e],this.#m[e]),this.#j(this.#u,e),this.#u=e)}delete(e){return this.#R(e,"delete")}#R(e,t){let s=!1;if(this.#l!==0){let i=this.#a.get(e);if(i!==void 0)if(s=!0,this.#l===1)this.#G(t);else{this.#A(i);let n=this.#n[i];if(this.#h(n)?n.__abortController.abort(new Error("deleted")):(this.#k||this.#f)&&(this.#k&&this.#r?.(n,e,t),this.#f&&this.#g?.push([n,e,t])),this.#a.delete(e),this.#c[i]=void 0,this.#n[i]=void 0,i===this.#u)this.#u=this.#w[i];else if(i===this.#p)this.#p=this.#m[i];else{let r=this.#w[i];this.#m[r]=this.#m[i];let o=this.#m[i];this.#w[o]=this.#w[i]}this.#l--,this.#S.push(i)}}if(this.#f&&this.#g?.length){let i=this.#g,n;for(;n=i?.shift();)this.#i?.(...n)}return s}clear(){return this.#G("delete")}#G(e){for(let t of this.#P({allowStale:!0})){let s=this.#n[t];if(this.#h(s))s.__abortController.abort(new Error("deleted"));else{let i=this.#c[t];this.#k&&this.#r?.(s,i,e),this.#f&&this.#g?.push([s,i,e])}}if(this.#a.clear(),this.#n.fill(void 0),this.#c.fill(void 0),this.#y&&this.#T&&(this.#y.fill(0),this.#T.fill(0)),this.#x&&this.#x.fill(0),this.#p=0,this.#u=0,this.#S.length=0,this.#d=0,this.#l=0,this.#f&&this.#g){let t=this.#g,s;for(;s=t?.shift();)this.#i?.(...s)}}};var it=require("node:path"),rn=require("node:url"),Te=require("fs"),Ir=P(require("node:fs"),1),Ge=require("node:fs/promises");var bs=require("node:events"),Ks=P(require("node:stream"),1),Xi=require("node:string_decoder"),Ji=typeof process=="object"&&process?process:{stdout:null,stderr:null},Sr=a=>!!a&&typeof a=="object"&&(a instanceof Ne||a instanceof Ks.default||xr(a)||Tr(a)),xr=a=>!!a&&typeof a=="object"&&a instanceof bs.EventEmitter&&typeof a.pipe=="function"&&a.pipe!==Ks.default.Writable.prototype.pipe,Tr=a=>!!a&&typeof a=="object"&&a instanceof bs.EventEmitter&&typeof a.write=="function"&&typeof a.end=="function",Ae=Symbol("EOF"),Le=Symbol("maybeEmitEnd"),je=Symbol("emittedEnd"),fs=Symbol("emittingEnd"),Dt=Symbol("emittedError"),gs=Symbol("closed"),Ki=Symbol("read"),ms=Symbol("flush"),Yi=Symbol("flushChunk"),we=Symbol("encoding"),tt=Symbol("decoder"),z=Symbol("flowing"),$t=Symbol("paused"),st=Symbol("resume"),_=Symbol("buffer"),ie=Symbol("pipes"),U=Symbol("bufferLength"),_s=Symbol("bufferPush"),ws=Symbol("bufferShift"),Y=Symbol("objectMode"),G=Symbol("destroyed"),Us=Symbol("error"),Vs=Symbol("emitData"),Zi=Symbol("emitEnd"),qs=Symbol("emitEnd2"),Se=Symbol("async"),Qs=Symbol("abort"),vs=Symbol("aborted"),Pt=Symbol("signal"),Ve=Symbol("dataListeners"),ce=Symbol("discarded"),Ft=a=>Promise.resolve().then(a),Dr=a=>a(),$r=a=>a==="end"||a==="finish"||a==="prefinish",Pr=a=>a instanceof ArrayBuffer||!!a&&typeof a=="object"&&a.constructor&&a.constructor.name==="ArrayBuffer"&&a.byteLength>=0,Fr=a=>!Buffer.isBuffer(a)&&ArrayBuffer.isView(a),ys=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[st](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Js=class extends ys{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=i=>t.emit("error",i),e.on("error",this.proxyErrors)}},Er=a=>!!a.objectMode,Rr=a=>!a.objectMode&&!!a.encoding&&a.encoding!=="buffer",Ne=class extends bs.EventEmitter{[z]=!1;[$t]=!1;[ie]=[];[_]=[];[Y];[we];[Se];[tt];[Ae]=!1;[je]=!1;[fs]=!1;[gs]=!1;[Dt]=null;[U]=0;[G]=!1;[Pt];[vs]=!1;[Ve]=0;[ce]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Er(t)?(this[Y]=!0,this[we]=null):Rr(t)?(this[we]=t.encoding,this[Y]=!1):(this[Y]=!1,this[we]=null),this[Se]=!!t.async,this[tt]=this[we]?new Xi.StringDecoder(this[we]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[_]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[ie]});let{signal:s}=t;s&&(this[Pt]=s,s.aborted?this[Qs]():s.addEventListener("abort",()=>this[Qs]()))}get bufferLength(){return this[U]}get encoding(){return this[we]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[Y]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[Se]}set async(e){this[Se]=this[Se]||!!e}[Qs](){this[vs]=!0,this.emit("abort",this[Pt]?.reason),this.destroy(this[Pt]?.reason)}get aborted(){return this[vs]}set aborted(e){}write(e,t,s){if(this[vs])return!1;if(this[Ae])throw new Error("write after end");if(this[G])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let i=this[Se]?Ft:Dr;if(!this[Y]&&!Buffer.isBuffer(e)){if(Fr(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(Pr(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[Y]?(this[z]&&this[U]!==0&&this[ms](!0),this[z]?this.emit("data",e):this[_s](e),this[U]!==0&&this.emit("readable"),s&&i(s),this[z]):e.length?(typeof e=="string"&&!(t===this[we]&&!this[tt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[we]&&(e=this[tt].write(e)),this[z]&&this[U]!==0&&this[ms](!0),this[z]?this.emit("data",e):this[_s](e),this[U]!==0&&this.emit("readable"),s&&i(s),this[z]):(this[U]!==0&&this.emit("readable"),s&&i(s),this[z])}read(e){if(this[G])return null;if(this[ce]=!1,this[U]===0||e===0||e&&e>this[U])return this[Le](),null;this[Y]&&(e=null),this[_].length>1&&!this[Y]&&(this[_]=[this[we]?this[_].join(""):Buffer.concat(this[_],this[U])]);let t=this[Ki](e||null,this[_][0]);return this[Le](),t}[Ki](e,t){if(this[Y])this[ws]();else{let s=t;e===s.length||e===null?this[ws]():typeof s=="string"?(this[_][0]=s.slice(e),t=s.slice(0,e),this[U]-=e):(this[_][0]=s.subarray(e),t=s.subarray(0,e),this[U]-=e)}return this.emit("data",t),!this[_].length&&!this[Ae]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Ae]=!0,this.writable=!1,(this[z]||!this[$t])&&this[Le](),this}[st](){this[G]||(!this[Ve]&&!this[ie].length&&(this[ce]=!0),this[$t]=!1,this[z]=!0,this.emit("resume"),this[_].length?this[ms]():this[Ae]?this[Le]():this.emit("drain"))}resume(){return this[st]()}pause(){this[z]=!1,this[$t]=!0,this[ce]=!1}get destroyed(){return this[G]}get flowing(){return this[z]}get paused(){return this[$t]}[_s](e){this[Y]?this[U]+=1:this[U]+=e.length,this[_].push(e)}[ws](){return this[Y]?this[U]-=1:this[U]-=this[_][0].length,this[_].shift()}[ms](e=!1){do;while(this[Yi](this[ws]())&&this[_].length);!e&&!this[_].length&&!this[Ae]&&this.emit("drain")}[Yi](e){return this.emit("data",e),this[z]}pipe(e,t){if(this[G])return e;this[ce]=!1;let s=this[je];return t=t||{},e===Ji.stdout||e===Ji.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[ie].push(t.proxyErrors?new Js(this,e,t):new ys(this,e,t)),this[Se]?Ft(()=>this[st]()):this[st]()),e}unpipe(e){let t=this[ie].find(s=>s.dest===e);t&&(this[ie].length===1?(this[z]&&this[Ve]===0&&(this[z]=!1),this[ie]=[]):this[ie].splice(this[ie].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[ce]=!1,this[Ve]++,!this[ie].length&&!this[z]&&this[st]();else if(e==="readable"&&this[U]!==0)super.emit("readable");else if($r(e)&&this[je])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[Dt]){let i=t;this[Se]?Ft(()=>i.call(this,this[Dt])):i.call(this,this[Dt])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[Ve]=this.listeners("data").length,this[Ve]===0&&!this[ce]&&!this[ie].length&&(this[z]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[Ve]=0,!this[ce]&&!this[ie].length&&(this[z]=!1)),t}get emittedEnd(){return this[je]}[Le](){!this[fs]&&!this[je]&&!this[G]&&this[_].length===0&&this[Ae]&&(this[fs]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[gs]&&this.emit("close"),this[fs]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==G&&this[G])return!1;if(e==="data")return!this[Y]&&!s?!1:this[Se]?(Ft(()=>this[Vs](s)),!0):this[Vs](s);if(e==="end")return this[Zi]();if(e==="close"){if(this[gs]=!0,!this[je]&&!this[G])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[Dt]=s,super.emit(Us,s);let n=!this[Pt]||this.listeners("error").length?super.emit("error",s):!1;return this[Le](),n}else if(e==="resume"){let n=super.emit("resume");return this[Le](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let i=super.emit(e,...t);return this[Le](),i}[Vs](e){for(let s of this[ie])s.dest.write(e)===!1&&this.pause();let t=this[ce]?!1:super.emit("data",e);return this[Le](),t}[Zi](){return this[je]?!1:(this[je]=!0,this.readable=!1,this[Se]?(Ft(()=>this[qs]()),!0):this[qs]())}[qs](){if(this[tt]){let t=this[tt].end();if(t){for(let s of this[ie])s.dest.write(t);this[ce]||super.emit("data",t)}}for(let t of this[ie])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[Y]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[Y]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[Y])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[we]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(G,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[ce]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let i=this.read();if(i!==null)return Promise.resolve({done:!1,value:i});if(this[Ae])return t();let n,r,o=p=>{this.off("data",c),this.off("end",l),this.off(G,u),t(),r(p)},c=p=>{this.off("error",o),this.off("end",l),this.off(G,u),this.pause(),n({value:p,done:!!this[Ae]})},l=()=>{this.off("error",o),this.off("data",c),this.off(G,u),t(),n({done:!0,value:void 0})},u=()=>o(new Error("stream destroyed"));return new Promise((p,f)=>{r=f,n=p,this.once(G,u),this.once("error",o),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ce]=!1;let e=!1,t=()=>(this.pause(),this.off(Us,t),this.off(G,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let i=this.read();return i===null?t():{done:!1,value:i}};return this.once("end",t),this.once(Us,t),this.once(G,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[G])return e?this.emit("error",e):this.emit(G),this;this[G]=!0,this[ce]=!0,this[_].length=0,this[U]=0;let t=this;return typeof t.close=="function"&&!this[gs]&&t.close(),e?this.emit("error",e):this.emit(G),this}static get isStream(){return Sr}};var Ar=Te.realpathSync.native,Rt={lstatSync:Te.lstatSync,readdir:Te.readdir,readdirSync:Te.readdirSync,readlinkSync:Te.readlinkSync,realpathSync:Ar,promises:{lstat:Ge.lstat,readdir:Ge.readdir,readlink:Ge.readlink,realpath:Ge.realpath}},on=a=>!a||a===Rt||a===Ir?Rt:{...Rt,...a,promises:{...Rt.promises,...a.promises||{}}},an=/^\\\\\?\\([a-z]:)\\?$/i,Lr=a=>a.replace(/\//g,"\\").replace(an,"$1\\"),Mr=/[\\\/]/,fe=0,cn=1,ln=2,xe=4,hn=6,dn=8,qe=10,un=12,pe=15,Et=~pe,Ys=16,en=32,It=64,ve=128,ks=256,Ss=512,tn=It|ve|Ss,Wr=1023,Zs=a=>a.isFile()?dn:a.isDirectory()?xe:a.isSymbolicLink()?qe:a.isCharacterDevice()?ln:a.isBlockDevice()?hn:a.isSocket()?un:a.isFIFO()?cn:fe,sn=new Map,At=a=>{let e=sn.get(a);if(e)return e;let t=a.normalize("NFKD");return sn.set(a,t),t},nn=new Map,Cs=a=>{let e=nn.get(a);if(e)return e;let t=At(a.toLowerCase());return nn.set(a,t),t},xs=class extends Tt{constructor(){super({max:256})}},Xs=class extends Tt{constructor(e=16*1024){super({maxSize:e,sizeCalculation:t=>t.length+1})}},pn=Symbol("PathScurry setAsCwd"),Z=class{name;root;roots;parent;nocase;isCWD=!1;#e;#t;get dev(){return this.#t}#r;get mode(){return this.#r}#i;get nlink(){return this.#i}#o;get uid(){return this.#o}#b;get gid(){return this.#b}#l;get rdev(){return this.#l}#d;get blksize(){return this.#d}#a;get ino(){return this.#a}#c;get size(){return this.#c}#n;get blocks(){return this.#n}#m;get atimeMs(){return this.#m}#w;get mtimeMs(){return this.#w}#p;get ctimeMs(){return this.#p}#u;get birthtimeMs(){return this.#u}#S;get atime(){return this.#S}#g;get mtime(){return this.#g}#x;get ctime(){return this.#x}#T;get birthtime(){return this.#T}#y;#k;#C;#f;#F;#D;#s;#I;#v;#E;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(e,t=fe,s,i,n,r,o){this.name=e,this.#y=n?Cs(e):At(e),this.#s=t&Wr,this.nocase=n,this.roots=i,this.root=s||this,this.#I=r,this.#C=o.fullpath,this.#F=o.relative,this.#D=o.relativePosix,this.parent=o.parent,this.parent?this.#e=this.parent.#e:this.#e=on(o.fs)}depth(){return this.#k!==void 0?this.#k:this.parent?this.#k=this.parent.depth()+1:this.#k=0}childrenCache(){return this.#I}resolve(e){if(!e)return this;let t=this.getRootString(e),i=e.substring(t.length).split(this.splitSep);return t?this.getRoot(t).#A(i):this.#A(i)}#A(e){let t=this;for(let s of e)t=t.child(s);return t}children(){let e=this.#I.get(this);if(e)return e;let t=Object.assign([],{provisional:0});return this.#I.set(this,t),this.#s&=~Ys,t}child(e,t){if(e===""||e===".")return this;if(e==="..")return this.parent||this;let s=this.children(),i=this.nocase?Cs(e):At(e);for(let c of s)if(c.#y===i)return c;let n=this.parent?this.sep:"",r=this.#C?this.#C+n+e:void 0,o=this.newChild(e,fe,{...t,parent:this,fullpath:r});return this.canReaddir()||(o.#s|=ve),s.push(o),o}relative(){if(this.isCWD)return"";if(this.#F!==void 0)return this.#F;let e=this.name,t=this.parent;if(!t)return this.#F=this.name;let s=t.relative();return s+(!s||!t.parent?"":this.sep)+e}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#D!==void 0)return this.#D;let e=this.name,t=this.parent;if(!t)return this.#D=this.fullpathPosix();let s=t.relativePosix();return s+(!s||!t.parent?"":"/")+e}fullpath(){if(this.#C!==void 0)return this.#C;let e=this.name,t=this.parent;if(!t)return this.#C=this.name;let i=t.fullpath()+(t.parent?this.sep:"")+e;return this.#C=i}fullpathPosix(){if(this.#f!==void 0)return this.#f;if(this.sep==="/")return this.#f=this.fullpath();if(!this.parent){let i=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(i)?this.#f=`//?/${i}`:this.#f=i}let e=this.parent,t=e.fullpathPosix(),s=t+(!t||!e.parent?"":"/")+this.name;return this.#f=s}isUnknown(){return(this.#s&pe)===fe}isType(e){return this[`is${e}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#s&pe)===dn}isDirectory(){return(this.#s&pe)===xe}isCharacterDevice(){return(this.#s&pe)===ln}isBlockDevice(){return(this.#s&pe)===hn}isFIFO(){return(this.#s&pe)===cn}isSocket(){return(this.#s&pe)===un}isSymbolicLink(){return(this.#s&qe)===qe}lstatCached(){return this.#s&en?this:void 0}readlinkCached(){return this.#v}realpathCached(){return this.#E}readdirCached(){let e=this.children();return e.slice(0,e.provisional)}canReadlink(){if(this.#v)return!0;if(!this.parent)return!1;let e=this.#s&pe;return!(e!==fe&&e!==qe||this.#s&ks||this.#s&ve)}calledReaddir(){return!!(this.#s&Ys)}isENOENT(){return!!(this.#s&ve)}isNamed(e){return this.nocase?this.#y===Cs(e):this.#y===At(e)}async readlink(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=await this.#e.promises.readlink(this.fullpath()),s=(await this.parent.realpath())?.resolve(t);if(s)return this.#v=s}catch(t){this.#h(t.code);return}}readlinkSync(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=this.#e.readlinkSync(this.fullpath()),s=this.parent.realpathSync()?.resolve(t);if(s)return this.#v=s}catch(t){this.#h(t.code);return}}#L(e){this.#s|=Ys;for(let t=e.provisional;t<e.length;t++){let s=e[t];s&&s.#M()}}#M(){this.#s&ve||(this.#s=(this.#s|ve)&Et,this.#$())}#$(){let e=this.children();e.provisional=0;for(let t of e)t.#M()}#P(){this.#s|=Ss,this.#W()}#W(){if(this.#s&It)return;let e=this.#s;(e&pe)===xe&&(e&=Et),this.#s=e|It,this.#$()}#B(e=""){e==="ENOTDIR"||e==="EPERM"?this.#W():e==="ENOENT"?this.#M():this.children().provisional=0}#O(e=""){e==="ENOTDIR"?this.parent.#W():e==="ENOENT"&&this.#M()}#h(e=""){let t=this.#s;t|=ks,e==="ENOENT"&&(t|=ve),(e==="EINVAL"||e==="UNKNOWN")&&(t&=Et),this.#s=t,e==="ENOTDIR"&&this.parent&&this.parent.#W()}#j(e,t){return this.#R(e,t)||this.#N(e,t)}#N(e,t){let s=Zs(e),i=this.newChild(e.name,s,{parent:this}),n=i.#s&pe;return n!==xe&&n!==qe&&n!==fe&&(i.#s|=It),t.unshift(i),t.provisional++,i}#R(e,t){for(let s=t.provisional;s<t.length;s++){let i=t[s];if((this.nocase?Cs(e.name):At(e.name))===i.#y)return this.#G(e,i,s,t)}}#G(e,t,s,i){let n=t.name;return t.#s=t.#s&Et|Zs(e),n!==e.name&&(t.name=e.name),s!==i.provisional&&(s===i.length-1?i.pop():i.splice(s,1),i.unshift(t)),i.provisional++,t}async lstat(){if((this.#s&ve)===0)try{return this.#U(await this.#e.promises.lstat(this.fullpath())),this}catch(e){this.#O(e.code)}}lstatSync(){if((this.#s&ve)===0)try{return this.#U(this.#e.lstatSync(this.fullpath())),this}catch(e){this.#O(e.code)}}#U(e){let{atime:t,atimeMs:s,birthtime:i,birthtimeMs:n,blksize:r,blocks:o,ctime:c,ctimeMs:l,dev:u,gid:p,ino:f,mode:g,mtime:b,mtimeMs:v,nlink:C,rdev:k,size:F,uid:$}=e;this.#S=t,this.#m=s,this.#T=i,this.#u=n,this.#d=r,this.#n=o,this.#x=c,this.#p=l,this.#t=u,this.#b=p,this.#a=f,this.#r=g,this.#g=b,this.#w=v,this.#i=C,this.#l=k,this.#c=F,this.#o=$;let x=Zs(e);this.#s=this.#s&Et|x|en,x!==fe&&x!==xe&&x!==qe&&(this.#s|=It)}#z=[];#_=!1;#V(e){this.#_=!1;let t=this.#z.slice();this.#z.length=0,t.forEach(s=>s(null,e))}readdirCB(e,t=!1){if(!this.canReaddir()){t?e(null,[]):queueMicrotask(()=>e(null,[]));return}let s=this.children();if(this.calledReaddir()){let n=s.slice(0,s.provisional);t?e(null,n):queueMicrotask(()=>e(null,n));return}if(this.#z.push(e),this.#_)return;this.#_=!0;let i=this.fullpath();this.#e.readdir(i,{withFileTypes:!0},(n,r)=>{if(n)this.#B(n.code),s.provisional=0;else{for(let o of r)this.#j(o,s);this.#L(s)}this.#V(s.slice(0,s.provisional))})}#H;async readdir(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();if(this.#H)await this.#H;else{let s=()=>{};this.#H=new Promise(i=>s=i);try{for(let i of await this.#e.promises.readdir(t,{withFileTypes:!0}))this.#j(i,e);this.#L(e)}catch(i){this.#B(i.code),e.provisional=0}this.#H=void 0,s()}return e.slice(0,e.provisional)}readdirSync(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();try{for(let s of this.#e.readdirSync(t,{withFileTypes:!0}))this.#j(s,e);this.#L(e)}catch(s){this.#B(s.code),e.provisional=0}return e.slice(0,e.provisional)}canReaddir(){if(this.#s&tn)return!1;let e=pe&this.#s;return e===fe||e===xe||e===qe}shouldWalk(e,t){return(this.#s&xe)===xe&&!(this.#s&tn)&&!e.has(this)&&(!t||t(this))}async realpath(){if(this.#E)return this.#E;if(!((Ss|ks|ve)&this.#s))try{let e=await this.#e.promises.realpath(this.fullpath());return this.#E=this.resolve(e)}catch{this.#P()}}realpathSync(){if(this.#E)return this.#E;if(!((Ss|ks|ve)&this.#s))try{let e=this.#e.realpathSync(this.fullpath());return this.#E=this.resolve(e)}catch{this.#P()}}[pn](e){if(e===this)return;e.isCWD=!1,this.isCWD=!0;let t=new Set([]),s=[],i=this;for(;i&&i.parent;)t.add(i),i.#F=s.join(this.sep),i.#D=s.join("/"),i=i.parent,s.push("..");for(i=e;i&&i.parent&&!t.has(i);)i.#F=void 0,i.#D=void 0,i=i.parent}},Ts=class a extends Z{sep="\\";splitSep=Mr;constructor(e,t=fe,s,i,n,r,o){super(e,t,s,i,n,r,o)}newChild(e,t=fe,s={}){return new a(e,t,this.root,this.roots,this.nocase,this.childrenCache(),s)}getRootString(e){return it.win32.parse(e).root}getRoot(e){if(e=Lr(e.toUpperCase()),e===this.root.name)return this.root;for(let[t,s]of Object.entries(this.roots))if(this.sameRoot(e,t))return this.roots[e]=s;return this.roots[e]=new nt(e,this).root}sameRoot(e,t=this.root.name){return e=e.toUpperCase().replace(/\//g,"\\").replace(an,"$1\\"),e===t}},Ds=class a extends Z{splitSep="/";sep="/";constructor(e,t=fe,s,i,n,r,o){super(e,t,s,i,n,r,o)}getRootString(e){return e.startsWith("/")?"/":""}getRoot(e){return this.root}newChild(e,t=fe,s={}){return new a(e,t,this.root,this.roots,this.nocase,this.childrenCache(),s)}},$s=class{root;rootPath;roots;cwd;#e;#t;#r;nocase;#i;constructor(e=process.cwd(),t,s,{nocase:i,childrenCacheSize:n=16*1024,fs:r=Rt}={}){this.#i=on(r),(e instanceof URL||e.startsWith("file://"))&&(e=(0,rn.fileURLToPath)(e));let o=t.resolve(e);this.roots=Object.create(null),this.rootPath=this.parseRootPath(o),this.#e=new xs,this.#t=new xs,this.#r=new Xs(n);let c=o.substring(this.rootPath.length).split(s);if(c.length===1&&!c[0]&&c.pop(),i===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=i,this.root=this.newRoot(this.#i),this.roots[this.rootPath]=this.root;let l=this.root,u=c.length-1,p=t.sep,f=this.rootPath,g=!1;for(let b of c){let v=u--;l=l.child(b,{relative:new Array(v).fill("..").join(p),relativePosix:new Array(v).fill("..").join("/"),fullpath:f+=(g?"":p)+b}),g=!0}this.cwd=l}depth(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.depth()}childrenCache(){return this.#r}resolve(...e){let t="";for(let n=e.length-1;n>=0;n--){let r=e[n];if(!(!r||r===".")&&(t=t?`${r}/${t}`:r,this.isAbsolute(r)))break}let s=this.#e.get(t);if(s!==void 0)return s;let i=this.cwd.resolve(t).fullpath();return this.#e.set(t,i),i}resolvePosix(...e){let t="";for(let n=e.length-1;n>=0;n--){let r=e[n];if(!(!r||r===".")&&(t=t?`${r}/${t}`:r,this.isAbsolute(r)))break}let s=this.#t.get(t);if(s!==void 0)return s;let i=this.cwd.resolve(t).fullpathPosix();return this.#t.set(t,i),i}relative(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relative()}relativePosix(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relativePosix()}basename(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.name}dirname(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),(e.parent||e).fullpath()}async readdir(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s}=t;if(e.canReaddir()){let i=await e.readdir();return s?i:i.map(n=>n.name)}else return[]}readdirSync(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0}=t;return e.canReaddir()?s?e.readdirSync():e.readdirSync().map(i=>i.name):[]}async lstat(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstat()}lstatSync(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstatSync()}async readlink(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e.withFileTypes,e=this.cwd);let s=await e.readlink();return t?s:s?.fullpath()}readlinkSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e.withFileTypes,e=this.cwd);let s=e.readlinkSync();return t?s:s?.fullpath()}async realpath(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e.withFileTypes,e=this.cwd);let s=await e.realpath();return t?s:s?.fullpath()}realpathSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e.withFileTypes,e=this.cwd);let s=e.realpathSync();return t?s:s?.fullpath()}async walk(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0,follow:i=!1,filter:n,walkFilter:r}=t,o=[];(!n||n(e))&&o.push(s?e:e.fullpath());let c=new Set,l=(p,f)=>{c.add(p),p.readdirCB((g,b)=>{if(g)return f(g);let v=b.length;if(!v)return f();let C=()=>{--v===0&&f()};for(let k of b)(!n||n(k))&&o.push(s?k:k.fullpath()),i&&k.isSymbolicLink()?k.realpath().then(F=>F?.isUnknown()?F.lstat():F).then(F=>F?.shouldWalk(c,r)?l(F,C):C()):k.shouldWalk(c,r)?l(k,C):C()},!0)},u=e;return new Promise((p,f)=>{l(u,g=>{if(g)return f(g);p(o)})})}walkSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0,follow:i=!1,filter:n,walkFilter:r}=t,o=[];(!n||n(e))&&o.push(s?e:e.fullpath());let c=new Set([e]);for(let l of c){let u=l.readdirSync();for(let p of u){(!n||n(p))&&o.push(s?p:p.fullpath());let f=p;if(p.isSymbolicLink()){if(!(i&&(f=p.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(c,r)&&c.add(f)}}return o}[Symbol.asyncIterator](){return this.iterate()}iterate(e=this.cwd,t={}){return typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd),this.stream(e,t)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0,follow:i=!1,filter:n,walkFilter:r}=t;(!n||n(e))&&(yield s?e:e.fullpath());let o=new Set([e]);for(let c of o){let l=c.readdirSync();for(let u of l){(!n||n(u))&&(yield s?u:u.fullpath());let p=u;if(u.isSymbolicLink()){if(!(i&&(p=u.realpathSync())))continue;p.isUnknown()&&p.lstatSync()}p.shouldWalk(o,r)&&o.add(p)}}}stream(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0,follow:i=!1,filter:n,walkFilter:r}=t,o=new Ne({objectMode:!0});(!n||n(e))&&o.write(s?e:e.fullpath());let c=new Set,l=[e],u=0,p=()=>{let f=!1;for(;!f;){let g=l.shift();if(!g){u===0&&o.end();return}u++,c.add(g);let b=(C,k,F=!1)=>{if(C)return o.emit("error",C);if(i&&!F){let $=[];for(let x of k)x.isSymbolicLink()&&$.push(x.realpath().then(E=>E?.isUnknown()?E.lstat():E));if($.length){Promise.all($).then(()=>b(null,k,!0));return}}for(let $ of k)$&&(!n||n($))&&(o.write(s?$:$.fullpath())||(f=!0));u--;for(let $ of k){let x=$.realpathCached()||$;x.shouldWalk(c,r)&&l.push(x)}f&&!o.flowing?o.once("drain",p):v||p()},v=!0;g.readdirCB(b,!0),v=!1}};return p(),o}streamSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof Z||(t=e,e=this.cwd);let{withFileTypes:s=!0,follow:i=!1,filter:n,walkFilter:r}=t,o=new Ne({objectMode:!0}),c=new Set;(!n||n(e))&&o.write(s?e:e.fullpath());let l=[e],u=0,p=()=>{let f=!1;for(;!f;){let g=l.shift();if(!g){u===0&&o.end();return}u++,c.add(g);let b=g.readdirSync();for(let v of b)(!n||n(v))&&(o.write(s?v:v.fullpath())||(f=!0));u--;for(let v of b){let C=v;if(v.isSymbolicLink()){if(!(i&&(C=v.realpathSync())))continue;C.isUnknown()&&C.lstatSync()}C.shouldWalk(c,r)&&l.push(C)}}f&&!o.flowing&&o.once("drain",p)};return p(),o}chdir(e=this.cwd){let t=this.cwd;this.cwd=typeof e=="string"?this.cwd.resolve(e):e,this.cwd[pn](t)}},nt=class extends $s{sep="\\";constructor(e=process.cwd(),t={}){let{nocase:s=!0}=t;super(e,it.win32,"\\",{...t,nocase:s}),this.nocase=s;for(let i=this.cwd;i;i=i.parent)i.nocase=this.nocase}parseRootPath(e){return it.win32.parse(e).root.toUpperCase()}newRoot(e){return new Ts(this.rootPath,xe,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")||e.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(e)}},rt=class extends $s{sep="/";constructor(e=process.cwd(),t={}){let{nocase:s=!1}=t;super(e,it.posix,"/",{...t,nocase:s}),this.nocase=s}parseRootPath(e){return"/"}newRoot(e){return new Ds(this.rootPath,xe,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")}},Lt=class extends rt{constructor(e=process.cwd(),t={}){let{nocase:s=!0}=t;super(e,{...t,nocase:s})}},Ko=process.platform==="win32"?Ts:Ds,fn=process.platform==="win32"?nt:process.platform==="darwin"?Lt:rt;var Br=a=>a.length>=1,Or=a=>a.length>=1,ot=class a{#e;#t;#r;length;#i;#o;#b;#l;#d;#a;#c=!0;constructor(e,t,s,i){if(!Br(e))throw new TypeError("empty pattern list");if(!Or(t))throw new TypeError("empty glob list");if(t.length!==e.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=e.length,s<0||s>=this.length)throw new TypeError("index out of range");if(this.#e=e,this.#t=t,this.#r=s,this.#i=i,this.#r===0){if(this.isUNC()){let[n,r,o,c,...l]=this.#e,[u,p,f,g,...b]=this.#t;l[0]===""&&(l.shift(),b.shift());let v=[n,r,o,c,""].join("/"),C=[u,p,f,g,""].join("/");this.#e=[v,...l],this.#t=[C,...b],this.length=this.#e.length}else if(this.isDrive()||this.isAbsolute()){let[n,...r]=this.#e,[o,...c]=this.#t;r[0]===""&&(r.shift(),c.shift());let l=n+"/",u=o+"/";this.#e=[l,...r],this.#t=[u,...c],this.length=this.#e.length}}}pattern(){return this.#e[this.#r]}isString(){return typeof this.#e[this.#r]=="string"}isGlobstar(){return this.#e[this.#r]===Q}isRegExp(){return this.#e[this.#r]instanceof RegExp}globString(){return this.#b=this.#b||(this.#r===0?this.isAbsolute()?this.#t[0]+this.#t.slice(1).join("/"):this.#t.join("/"):this.#t.slice(this.#r).join("/"))}hasMore(){return this.length>this.#r+1}rest(){return this.#o!==void 0?this.#o:this.hasMore()?(this.#o=new a(this.#e,this.#t,this.#r+1,this.#i),this.#o.#a=this.#a,this.#o.#d=this.#d,this.#o.#l=this.#l,this.#o):this.#o=null}isUNC(){let e=this.#e;return this.#d!==void 0?this.#d:this.#d=this.#i==="win32"&&this.#r===0&&e[0]===""&&e[1]===""&&typeof e[2]=="string"&&!!e[2]&&typeof e[3]=="string"&&!!e[3]}isDrive(){let e=this.#e;return this.#l!==void 0?this.#l:this.#l=this.#i==="win32"&&this.#r===0&&this.length>1&&typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0])}isAbsolute(){let e=this.#e;return this.#a!==void 0?this.#a:this.#a=e[0]===""&&e.length>1||this.isDrive()||this.isUNC()}root(){let e=this.#e[0];return typeof e=="string"&&this.isAbsolute()&&this.#r===0?e:""}checkFollowGlobstar(){return!(this.#r===0||!this.isGlobstar()||!this.#c)}markFollowGlobstar(){return this.#r===0||!this.isGlobstar()||!this.#c?!1:(this.#c=!1,!0)}};var jr=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",at=class{relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(e,{nobrace:t,nocase:s,noext:i,noglobstar:n,platform:r=jr}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=r,this.mmopts={dot:!0,nobrace:t,nocase:s,noext:i,noglobstar:n,optimizationLevel:2,platform:r,nocomment:!0,nonegate:!0};for(let o of e)this.add(o)}add(e){let t=new ae(e,this.mmopts);for(let s=0;s<t.set.length;s++){let i=t.set[s],n=t.globParts[s];if(!i||!n)throw new Error("invalid pattern object");for(;i[0]==="."&&n[0]===".";)i.shift(),n.shift();let r=new ot(i,n,0,this.platform),o=new ae(r.globString(),this.mmopts),c=n[n.length-1]==="**",l=r.isAbsolute();l?this.absolute.push(o):this.relative.push(o),c&&(l?this.absoluteChildren.push(o):this.relativeChildren.push(o))}}ignored(e){let t=e.fullpath(),s=`${t}/`,i=e.relative()||".",n=`${i}/`;for(let r of this.relative)if(r.match(i)||r.match(n))return!0;for(let r of this.absolute)if(r.match(t)||r.match(s))return!0;return!1}childrenIgnored(e){let t=e.fullpath()+"/",s=(e.relative()||".")+"/";for(let i of this.relativeChildren)if(i.match(s))return!0;for(let i of this.absoluteChildren)if(i.match(t))return!0;return!1}};var ei=class a{store;constructor(e=new Map){this.store=e}copy(){return new a(new Map(this.store))}hasWalked(e,t){return this.store.get(e.fullpath())?.has(t.globString())}storeWalked(e,t){let s=e.fullpath(),i=this.store.get(s);i?i.add(t.globString()):this.store.set(s,new Set([t.globString()]))}},ti=class{store=new Map;add(e,t,s){let i=(t?2:0)|(s?1:0),n=this.store.get(e);this.store.set(e,n===void 0?i:i&n)}entries(){return[...this.store.entries()].map(([e,t])=>[e,!!(t&2),!!(t&1)])}},si=class{store=new Map;add(e,t){if(!e.canReaddir())return;let s=this.store.get(e);s?s.find(i=>i.globString()===t.globString())||s.push(t):this.store.set(e,[t])}get(e){let t=this.store.get(e);if(!t)throw new Error("attempting to walk unknown path");return t}entries(){return this.keys().map(e=>[e,this.store.get(e)])}keys(){return[...this.store.keys()].filter(e=>e.canReaddir())}},Mt=class a{hasWalkedCache;matches=new ti;subwalks=new si;patterns;follow;dot;opts;constructor(e,t){this.opts=e,this.follow=!!e.follow,this.dot=!!e.dot,this.hasWalkedCache=t?t.copy():new ei}processPatterns(e,t){this.patterns=t;let s=t.map(i=>[e,i]);for(let[i,n]of s){this.hasWalkedCache.storeWalked(i,n);let r=n.root(),o=n.isAbsolute()&&this.opts.absolute!==!1;if(r){i=i.resolve(r==="/"&&this.opts.root!==void 0?this.opts.root:r);let p=n.rest();if(p)n=p;else{this.matches.add(i,!0,!1);continue}}if(i.isENOENT())continue;let c,l,u=!1;for(;typeof(c=n.pattern())=="string"&&(l=n.rest());)i=i.resolve(c),n=l,u=!0;if(c=n.pattern(),l=n.rest(),u){if(this.hasWalkedCache.hasWalked(i,n))continue;this.hasWalkedCache.storeWalked(i,n)}if(typeof c=="string"){let p=c===".."||c===""||c===".";this.matches.add(i.resolve(c),o,p);continue}else if(c===Q){(!i.isSymbolicLink()||this.follow||n.checkFollowGlobstar())&&this.subwalks.add(i,n);let p=l?.pattern(),f=l?.rest();if(!l||(p===""||p===".")&&!f)this.matches.add(i,o,p===""||p===".");else if(p===".."){let g=i.parent||i;f?this.hasWalkedCache.hasWalked(g,f)||this.subwalks.add(g,f):this.matches.add(g,o,!0)}}else c instanceof RegExp&&this.subwalks.add(i,n)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new a(this.opts,this.hasWalkedCache)}filterEntries(e,t){let s=this.subwalks.get(e),i=this.child();for(let n of t)for(let r of s){let o=r.isAbsolute(),c=r.pattern(),l=r.rest();c===Q?i.testGlobstar(n,r,l,o):c instanceof RegExp?i.testRegExp(n,c,l,o):i.testString(n,c,l,o)}return i}testGlobstar(e,t,s,i){if((this.dot||!e.name.startsWith("."))&&(t.hasMore()||this.matches.add(e,i,!1),e.canReaddir()&&(this.follow||!e.isSymbolicLink()?this.subwalks.add(e,t):e.isSymbolicLink()&&(s&&t.checkFollowGlobstar()?this.subwalks.add(e,s):t.markFollowGlobstar()&&this.subwalks.add(e,t)))),s){let n=s.pattern();if(typeof n=="string"&&n!==".."&&n!==""&&n!==".")this.testString(e,n,s.rest(),i);else if(n===".."){let r=e.parent||e;this.subwalks.add(r,s)}else n instanceof RegExp&&this.testRegExp(e,n,s.rest(),i)}}testRegExp(e,t,s,i){t.test(e.name)&&(s?this.subwalks.add(e,s):this.matches.add(e,i,!1))}testString(e,t,s,i){e.isNamed(t)&&(s?this.subwalks.add(e,s):this.matches.add(e,i,!1))}};var Nr=(a,e)=>typeof a=="string"?new at([a],e):Array.isArray(a)?new at(a,e):a,Ps=class{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#e=[];#t;#r;signal;maxDepth;includeChildMatches;constructor(e,t,s){if(this.patterns=e,this.path=t,this.opts=s,this.#r=!s.posix&&s.platform==="win32"?"\\":"/",this.includeChildMatches=s.includeChildMatches!==!1,(s.ignore||!this.includeChildMatches)&&(this.#t=Nr(s.ignore??[],s),!this.includeChildMatches&&typeof this.#t.add!="function")){let i="cannot ignore child matches, ignore lacks add() method.";throw new Error(i)}this.maxDepth=s.maxDepth||1/0,s.signal&&(this.signal=s.signal,this.signal.addEventListener("abort",()=>{this.#e.length=0}))}#i(e){return this.seen.has(e)||!!this.#t?.ignored?.(e)}#o(e){return!!this.#t?.childrenIgnored?.(e)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let e;for(;!this.paused&&(e=this.#e.shift());)e()}onResume(e){this.signal?.aborted||(this.paused?this.#e.push(e):e())}async matchCheck(e,t){if(t&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=e.realpathCached()||await e.realpath(),!s)return;e=s}let n=e.isUnknown()||this.opts.stat?await e.lstat():e;if(this.opts.follow&&this.opts.nodir&&n?.isSymbolicLink()){let r=await n.realpath();r&&(r.isUnknown()||this.opts.stat)&&await r.lstat()}return this.matchCheckTest(n,t)}matchCheckTest(e,t){return e&&(this.maxDepth===1/0||e.depth()<=this.maxDepth)&&(!t||e.canReaddir())&&(!this.opts.nodir||!e.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!e.isSymbolicLink()||!e.realpathCached()?.isDirectory())&&!this.#i(e)?e:void 0}matchCheckSync(e,t){if(t&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=e.realpathCached()||e.realpathSync(),!s)return;e=s}let n=e.isUnknown()||this.opts.stat?e.lstatSync():e;if(this.opts.follow&&this.opts.nodir&&n?.isSymbolicLink()){let r=n.realpathSync();r&&(r?.isUnknown()||this.opts.stat)&&r.lstatSync()}return this.matchCheckTest(n,t)}matchFinish(e,t){if(this.#i(e))return;if(!this.includeChildMatches&&this.#t?.add){let n=`${e.relativePosix()}/**`;this.#t.add(n)}let s=this.opts.absolute===void 0?t:this.opts.absolute;this.seen.add(e);let i=this.opts.mark&&e.isDirectory()?this.#r:"";if(this.opts.withFileTypes)this.matchEmit(e);else if(s){let n=this.opts.posix?e.fullpathPosix():e.fullpath();this.matchEmit(n+i)}else{let n=this.opts.posix?e.relativePosix():e.relative(),r=this.opts.dotRelative&&!n.startsWith(".."+this.#r)?"."+this.#r:"";this.matchEmit(n?r+n+i:"."+i)}}async match(e,t,s){let i=await this.matchCheck(e,s);i&&this.matchFinish(i,t)}matchSync(e,t,s){let i=this.matchCheckSync(e,s);i&&this.matchFinish(i,t)}walkCB(e,t,s){this.signal?.aborted&&s(),this.walkCB2(e,t,new Mt(this.opts),s)}walkCB2(e,t,s,i){if(this.#o(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2(e,t,s,i));return}s.processPatterns(e,t);let n=1,r=()=>{--n===0&&i()};for(let[o,c,l]of s.matches.entries())this.#i(o)||(n++,this.match(o,c,l).then(()=>r()));for(let o of s.subwalkTargets()){if(this.maxDepth!==1/0&&o.depth()>=this.maxDepth)continue;n++;let c=o.readdirCached();o.calledReaddir()?this.walkCB3(o,c,s,r):o.readdirCB((l,u)=>this.walkCB3(o,u,s,r),!0)}r()}walkCB3(e,t,s,i){s=s.filterEntries(e,t);let n=1,r=()=>{--n===0&&i()};for(let[o,c,l]of s.matches.entries())this.#i(o)||(n++,this.match(o,c,l).then(()=>r()));for(let[o,c]of s.subwalks.entries())n++,this.walkCB2(o,c,s.child(),r);r()}walkCBSync(e,t,s){this.signal?.aborted&&s(),this.walkCB2Sync(e,t,new Mt(this.opts),s)}walkCB2Sync(e,t,s,i){if(this.#o(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2Sync(e,t,s,i));return}s.processPatterns(e,t);let n=1,r=()=>{--n===0&&i()};for(let[o,c,l]of s.matches.entries())this.#i(o)||this.matchSync(o,c,l);for(let o of s.subwalkTargets()){if(this.maxDepth!==1/0&&o.depth()>=this.maxDepth)continue;n++;let c=o.readdirSync();this.walkCB3Sync(o,c,s,r)}r()}walkCB3Sync(e,t,s,i){s=s.filterEntries(e,t);let n=1,r=()=>{--n===0&&i()};for(let[o,c,l]of s.matches.entries())this.#i(o)||this.matchSync(o,c,l);for(let[o,c]of s.subwalks.entries())n++,this.walkCB2Sync(o,c,s.child(),r);r()}},Wt=class extends Ps{matches=new Set;constructor(e,t,s){super(e,t,s)}matchEmit(e){this.matches.add(e)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((e,t)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?t(this.signal.reason):e(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},Bt=class extends Ps{results;constructor(e,t,s){super(e,t,s),this.results=new Ne({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(e){this.results.write(e),this.results.flowing||this.pause()}stream(){let e=this.path;return e.isUnknown()?e.lstat().then(()=>{this.walkCB(e,this.patterns,()=>this.results.end())}):this.walkCB(e,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var Gr=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",ye=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(e,t){if(!t)throw new TypeError("glob options required");if(this.withFileTypes=!!t.withFileTypes,this.signal=t.signal,this.follow=!!t.follow,this.dot=!!t.dot,this.dotRelative=!!t.dotRelative,this.nodir=!!t.nodir,this.mark=!!t.mark,t.cwd?(t.cwd instanceof URL||t.cwd.startsWith("file://"))&&(t.cwd=(0,gn.fileURLToPath)(t.cwd)):this.cwd="",this.cwd=t.cwd||"",this.root=t.root,this.magicalBraces=!!t.magicalBraces,this.nobrace=!!t.nobrace,this.noext=!!t.noext,this.realpath=!!t.realpath,this.absolute=t.absolute,this.includeChildMatches=t.includeChildMatches!==!1,this.noglobstar=!!t.noglobstar,this.matchBase=!!t.matchBase,this.maxDepth=typeof t.maxDepth=="number"?t.maxDepth:1/0,this.stat=!!t.stat,this.ignore=t.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof e=="string"&&(e=[e]),this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(e=e.map(c=>c.replace(/\\/g,"/"))),this.matchBase){if(t.noglobstar)throw new TypeError("base matching requires globstar");e=e.map(c=>c.includes("/")?c:`./**/${c}`)}if(this.pattern=e,this.platform=t.platform||Gr,this.opts={...t,platform:this.platform},t.scurry){if(this.scurry=t.scurry,t.nocase!==void 0&&t.nocase!==t.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let c=t.platform==="win32"?nt:t.platform==="darwin"?Lt:t.platform?rt:fn;this.scurry=new c(this.cwd,{nocase:t.nocase,fs:t.fs})}this.nocase=this.scurry.nocase;let s=this.platform==="darwin"||this.platform==="win32",i={...t,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:s,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},n=this.pattern.map(c=>new ae(c,i)),[r,o]=n.reduce((c,l)=>(c[0].push(...l.set),c[1].push(...l.globParts),c),[[],[]]);this.patterns=r.map((c,l)=>{let u=o[l];if(!u)throw new Error("invalid pattern object");return new ot(c,u,0,this.platform)})}async walk(){return[...await new Wt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new Wt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new Bt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new Bt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var ii=(a,e={})=>{Array.isArray(a)||(a=[a]);for(let t of a)if(new ae(t,e).hasMagic())return!0;return!1};function Fs(a,e={}){return new ye(a,e).streamSync()}function vn(a,e={}){return new ye(a,e).stream()}function yn(a,e={}){return new ye(a,e).walkSync()}async function mn(a,e={}){return new ye(a,e).walk()}function Es(a,e={}){return new ye(a,e).iterateSync()}function bn(a,e={}){return new ye(a,e).iterate()}var Hr=Fs,zr=Object.assign(vn,{sync:Fs}),_r=Es,Ur=Object.assign(bn,{sync:Es}),ct=Object.assign(yn,{stream:Fs,iterate:Es}),wn=Object.assign(mn,{glob:mn,globSync:yn,sync:ct,globStream:vn,stream:zr,globStreamSync:Fs,streamSync:Hr,globIterate:bn,iterate:Ur,globIterateSync:Es,iterateSync:_r,Glob:ye,hasMagic:ii,escape:Ze,unescape:me});wn.glob=wn;var Rs=class{constructor(e,t){this.workspaceRoot=e,this.outputChannel=t}async analyzeProject(){if(this.cachedPattern)return this.cachedPattern;this.outputChannel.appendLine("[ProjectAnalyzer] Starting project analysis...");let e={framework:await this.detectFramework(),utilities:await this.findUtilities(),imports:await this.learnImportPatterns(),codeStyle:await this.detectCodeStyle(),directories:await this.findDirectories()};return this.cachedPattern=e,await this.saveAnalysis(e),this.outputChannel.appendLine(`[ProjectAnalyzer] Detected framework: ${e.framework.name}`),e}async detectFramework(){if(this.hasDirectory("src/vasu-playwright-utils")||this.hasDirectory("vasu-playwright-utils"))return{name:"vasu31dev-playwright-ts",type:"custom-utilities",features:["ActionUtils","AssertUtils","LocatorUtils","POM","TestData"]};if(this.hasDirectory("utils")||this.hasDirectory("src/utils")){let e=await this.hasFilePattern("**/utils/**/*action*.{ts,js}"),t=await this.hasFilePattern("**/utils/**/*assert*.{ts,js}");if(e||t)return{name:"custom-utilities",type:"custom-utilities",features:["CustomUtils","POM"]}}return this.hasDirectory("pages")||this.hasDirectory("src/pages")?{name:"page-object-model",type:"custom-pom",features:["POM"]}:this.hasDirectory("step-definitions")||this.hasDirectory("step_definitions")?{name:"cucumber-style",type:"cucumber-style",features:["StepDefinitions"]}:{name:"vanilla-playwright",type:"vanilla-playwright",features:["Playwright"]}}async findUtilities(){let e={actions:[],assertions:[],locators:[],navigation:[]},t=await kn.workspace.findFiles("src/**/*.{ts,js}","**/{node_modules,test,tests,spec,specs,*.test.*,*.spec.*}/**");for(let s of t){let i=await this.extractExports(s.fsPath);for(let n of i){let r=n.toLowerCase();this.isActionUtility(r)?e.actions.push(n):this.isAssertionUtility(r)?e.assertions.push(n):this.isLocatorUtility(r)?e.locators.push(n):this.isNavigationUtility(r)&&e.navigation.push(n)}}return e}isActionUtility(e){return e.includes("click")||e.includes("tap")||e.includes("press")||e.includes("type")||e.includes("fill")||e.includes("select")||e.includes("hover")}isAssertionUtility(e){return e.includes("expect")||e.includes("verify")||e.includes("assert")||e.includes("check")}isLocatorUtility(e){return e.includes("locator")||e.includes("selector")||e.includes("findelement")||e.includes("getelement")}isNavigationUtility(e){return e.includes("goto")||e.includes("navigate")||e.includes("visit")||e.includes("openpage")}async extractExports(e){try{let t=De.readFileSync(e,"utf8"),s=[],i=/export\s+(?:async\s+)?(?:function|const|let)\s+(\w+)/g,n;for(;(n=i.exec(t))!==null;)s.push(n[1]);return s}catch{return[]}}async learnImportPatterns(){let e=new Map,i=[...ct("**/pages/**/*.{ts,js}",{cwd:this.workspaceRoot,absolute:!0}),...ct("**/step*/**/*.{ts,js}",{cwd:this.workspaceRoot,absolute:!0})].slice(0,10);for(let n of i)try{let r=De.readFileSync(n,"utf8"),o=this.extractImportsFromContent(r);for(let c of o){let l=this.categorizeImport(c);e.has(l)||e.set(l,[]),e.get(l).includes(c)||e.get(l).push(c)}}catch{}return e}extractImportsFromContent(e){let t=[],s=/import\s+{[^}]+}\s+from\s+['"][^'"]+['"]/g,i=e.match(s);return i&&t.push(...i),t}categorizeImport(e){return e.includes("ActionUtils")||e.includes("action")?"actions":e.includes("AssertUtils")||e.includes("assert")||e.includes("expect")?"assertions":e.includes("LocatorUtils")||e.includes("locator")?"locators":e.includes("@playwright/test")?"playwright":"other"}async detectCodeStyle(){let e=ct("**/pages/**/*.{ts,js}",{cwd:this.workspaceRoot,absolute:!0}).slice(0,5),t=0,s=0,i=0;for(let n of e)try{let r=De.readFileSync(n,"utf8");r.includes("export async function")&&t++,r.includes("export class")&&s++,r.includes("async ")&&i++}catch{}return{exports:s>t?"class-based":"named",async:i>0,architecture:s>t?"pom-class":"pom-functional"}}async findDirectories(){let e={},t=[{key:"pages",patterns:["pages","src/pages","src/ui/pages"]},{key:"utils",patterns:["utils","src/utils","src/vasu-playwright-utils","vasu-playwright-utils"]},{key:"testdata",patterns:["testdata","src/testdata","test-data","data"]},{key:"steps",patterns:["steps","src/steps","step-definitions","step_definitions"]}];for(let{key:s,patterns:i}of t)for(let n of i)if(this.hasDirectory(n)){e[s]=n;break}return e}hasDirectory(e){let t=ni.join(this.workspaceRoot,e);return De.existsSync(t)&&De.statSync(t).isDirectory()}async hasFilePattern(e){return ct(e,{cwd:this.workspaceRoot}).length>0}async saveAnalysis(e){let t=ni.join(this.workspaceRoot,".bdd-codegen.json"),s={framework:e.framework.name,detected:new Date().toISOString(),utilities:{actions:e.utilities.actions,assertions:e.utilities.assertions,locators:e.utilities.locators,navigation:e.utilities.navigation},codeStyle:e.codeStyle,directories:e.directories};try{De.writeFileSync(t,JSON.stringify(s,null,2),"utf8"),this.outputChannel.appendLine(`[ProjectAnalyzer] Saved analysis to ${t}`)}catch(i){this.outputChannel.appendLine(`[ProjectAnalyzer] Failed to save analysis: ${i}`)}}clearCache(){this.cachedPattern=void 0}};var Is=class{constructor(e,t){this.workspaceRoot=e,this.outputChannel=t,this.projectAnalyzer=new Rs(e,t)}async initialize(){this.projectPattern=await this.projectAnalyzer.analyzeProject()}async generateStepCode(e,t){this.projectPattern||await this.initialize(),this.outputChannel.appendLine(`[SmartCodeGenerator] Generating code for: "${e}"`);let s=await this.tryUserInstructions(e,t);if(s)return this.outputChannel.appendLine("[SmartCodeGenerator] Using user instructions"),s;let i=this.matchStepToPattern(e);return i?(this.outputChannel.appendLine(`[SmartCodeGenerator] Matched pattern: ${i.keyword}`),this.generateFromPattern(e,t,i)):(this.outputChannel.appendLine("[SmartCodeGenerator] Using generic template"),this.generateGenericCode(e,t))}async tryUserInstructions(e,t){let s=ri.join(this.workspaceRoot,".bdd-instructions.md");if(!lt.existsSync(s))return null;try{let i=lt.readFileSync(s,"utf8"),n=this.parseInstructions(i);for(let r of n)if(r.regex.test(e))return this.generateFromPattern(e,t,r)}catch(i){this.outputChannel.appendLine(`[SmartCodeGenerator] Failed to parse instructions: ${i}`)}return null}parseInstructions(e){let t=[],s=e.split(/^##\s+/m);for(let i of s){let n=i.match(/- Match:\s+`([^`]+)`/),r=i.match(/- Code:\s+`([^`]+)`/),o=i.match(/- Imports?:\s+`([^`]+)`/);if(n&&r){let c=n[1],l=r[1],u=o?[o[1]]:[],p=c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").replace(/\\\{string\\\}/g,"(.+)").replace(/\\\{int\\\}/g,"(\\d+)");t.push({keyword:"custom",regex:new RegExp(p,"i"),utility:"custom",template:f=>{let g=l;return f.forEach((b,v)=>{g=g.replace(new RegExp(`\\{${v}\\}`,"g"),b)}),g},imports:u})}}return t}matchStepToPattern(e){let t=this.getPatterns();for(let s of t)if(s.regex.test(e))return s;return null}getPatterns(){if(!this.projectPattern)return this.getGenericPatterns();let e=this.projectPattern.framework.name;return e==="vasu31dev-playwright-ts"?this.getVasu31devPatterns():e==="custom-utilities"?this.getCustomUtilityPatterns(this.projectPattern.utilities):this.getVanillaPlaywrightPatterns()}getVasu31devPatterns(){return[{keyword:"navigate",regex:/(?:navigate|go|open).+(?:to|the)\s+(.+)/i,utility:"gotoURL",template:e=>`await gotoURL('${e[0]}');`,imports:["import { gotoURL } from '@ActionUtils';"]},{keyword:"click",regex:/(?:click|press).+(?:on|the)\s+(.+)/i,utility:"click",template:e=>`await click(getLocatorByRole('button', { name: '${e[0]}' }));`,imports:["import { click } from '@ActionUtils';","import { getLocatorByRole } from '@LocatorUtils';"]},{keyword:"fill",regex:/(?:fill|enter|type).+['"](.+)['"].+(?:in|into)\s+(.+)/i,utility:"fill",template:e=>`await fill(getLocator('${e[1]}'), '${e[0]}');`,imports:["import { fill } from '@ActionUtils';","import { getLocator } from '@LocatorUtils';"]},{keyword:"see",regex:/(?:should see|see|verify).+['"](.+)['"]/i,utility:"expectElementToBeVisible",template:e=>`await expectElementToBeVisible(getLocator('text=${e[0]}'));`,imports:["import { expectElementToBeVisible } from '@AssertUtils';","import { getLocator } from '@LocatorUtils';"]}]}getCustomUtilityPatterns(e){let t=[];if(e.actions&&e.actions.length>0){let s=e.actions.find(n=>n.toLowerCase().includes("click"))||e.actions[0];t.push({keyword:"click",regex:/(?:click|tap|press)\s+(?:on\s+)?(.+)/i,utility:s,template:n=>`await ${s}(${this.formatSelector(n[0])});`,imports:[`import { ${s} } from '${this.findImportPath(s)}';`]});let i=e.actions.find(n=>n.toLowerCase().includes("fill")||n.toLowerCase().includes("type"));i&&t.push({keyword:"fill",regex:/(?:fill|type|enter)\s+"([^"]+)"\s+(?:into|in)\s+(.+)/i,utility:i,template:n=>`await ${i}(${this.formatSelector(n[1])}, '${n[0]}');`,imports:[`import { ${i} } from '${this.findImportPath(i)}';`]})}if(e.navigation&&e.navigation.length>0){let s=e.navigation.find(i=>i.toLowerCase().includes("goto")||i.toLowerCase().includes("nav"));s&&t.push({keyword:"navigate",regex:/(?:navigate|go|open).+(?:to|the)\s+(.+)/i,utility:s,template:i=>`await ${s}('${i[0]}');`,imports:[`import { ${s} } from '${this.findImportPath(s)}';`]})}if(e.assertions&&e.assertions.length>0){let s=e.assertions.find(i=>i.toLowerCase().includes("visible"));s&&t.push({keyword:"see",regex:/(?:see|should see|verify)\s+(.+)/i,utility:s,template:i=>`await ${s}(${this.formatSelector(i[0])});`,imports:[`import { ${s} } from '${this.findImportPath(s)}';`]})}return t}findImportPath(e){if(this.projectPattern?.imports){for(let[t,s]of this.projectPattern.imports)if(s.includes(e))return`@${t}`}return"@/utils"}formatSelector(e){return e.startsWith('"')||e.startsWith("'")?e:`'${e}'`}getVanillaPlaywrightPatterns(){return[{keyword:"navigate",regex:/(?:navigate|go|open).+(?:to|the)\s+(.+)/i,utility:"page.goto",template:e=>`await page.goto('${e[0]}');`,imports:[]},{keyword:"click",regex:/(?:click|press).+(?:on|the)\s+(.+)/i,utility:"page.click",template:e=>`await page.click('${e[0]}');`,imports:[]},{keyword:"fill",regex:/(?:fill|enter|type).+['"](.+)['"].+(?:in|into)\s+(.+)/i,utility:"page.fill",template:e=>`await page.fill('${e[1]}', '${e[0]}');`,imports:[]},{keyword:"see",regex:/(?:should see|see|verify).+['"](.+)['"]/i,utility:"expect",template:e=>`await expect(page.locator('text=${e[0]}')).toBeVisible();`,imports:["import { expect } from '@playwright/test';"]}]}getGenericPatterns(){return this.getVanillaPlaywrightPatterns()}generateFromPattern(e,t,s){let i=e.match(s.regex),n=i?Array.from(i).slice(1):[],r=this.generateFunctionName(e,t),o=s.template(n),c=this.deduplicateImports(s.imports),l=this.buildFullCode(c,r,o);return{imports:c,functionName:r,implementation:o,fullCode:l}}generateGenericCode(e,t){let s=this.generateFunctionName(e,t),i="// TODO: Implement step logic",n=[],r=this.buildFullCode(n,s,i);return{imports:n,functionName:s,implementation:i,fullCode:r}}generateFunctionName(e,t){return e.toLowerCase().replace(/['"<>{}]/g,"").split(/\s+/).filter(n=>n.length>0).map((n,r)=>r===0?n:n.charAt(0).toUpperCase()+n.slice(1)).join("")}buildFullCode(e,t,s){let i=this.projectPattern?.codeStyle,n="";return e.length>0&&(n+=e.join(`
`)+`

`),i?.exports==="class-based"?(n+=`export class ${this.capitalize(t)} {
`,n+=`  async execute() {
`,n+=`    ${s}
`,n+=`  }
`,n+=`}
`):(n+=`export async function ${t}() {
`,n+=`  ${s}
`,n+=`}
`),n}deduplicateImports(e){return Array.from(new Set(e))}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}async refresh(){this.projectAnalyzer.clearCache(),this.projectPattern=void 0,await this.initialize()}async generateInstructions(){this.projectPattern||await this.initialize();let e=this.projectPattern,t=`# BDD Smart Instructions

`;if(t+=`> Auto-generated based on project analysis. Customize these rules to control code generation.

`,e.utilities.actions.length>0){t+=`## Actions

`;let i=e.utilities.actions.find(r=>r.toLowerCase().includes("click"));i&&(t+=`### Click Steps
`,t+="- Match: `I click {string}`\n",t+=`- Code: \`await ${i}({0})\`
`,t+=`- Import: \`import { ${i} } from '@/utils'\`

`);let n=e.utilities.actions.find(r=>r.toLowerCase().includes("fill"));n&&(t+=`### Input Steps
`,t+="- Match: `I fill {string} with {string}`\n",t+=`- Code: \`await ${n}({0}, {1})\`
`,t+=`- Import: \`import { ${n} } from '@/utils'\`

`)}if(e.utilities.navigation.length>0){t+=`## Navigation

`;let i=e.utilities.navigation.find(n=>n.toLowerCase().includes("goto")||n.toLowerCase().includes("nav"));i&&(t+=`### Navigate Steps
`,t+="- Match: `I go to {string}`\n",t+=`- Code: \`await ${i}({0})\`
`,t+=`- Import: \`import { ${i} } from '@/utils'\`

`)}if(e.utilities.assertions.length>0){t+=`## Assertions

`;let i=e.utilities.assertions.find(n=>n.toLowerCase().includes("visible"));i&&(t+=`### Visibility Steps
`,t+="- Match: `I should see {string}`\n",t+=`- Code: \`await ${i}({0})\`
`,t+=`- Import: \`import { ${i} } from '@/utils'\`

`)}let s=ri.join(this.workspaceRoot,".bdd-instructions.md");return lt.writeFileSync(s,t,"utf8"),s}};async function qr(a){let e=h.tests.createTestController("playwrightBdd","Playwright BDD Tests");a.subscriptions.push(e);let t=h.window.createOutputChannel("Playwright BDD");a.subscriptions.push(t);let s=(d,w)=>{let y=`[ERROR] ${d}: ${w.message}`;t.appendLine(y),console.error(y,w),h.window.showErrorMessage(`Playwright BDD: ${d} failed. Check output for details.`)};(()=>{let w=h.workspace.getConfiguration("playwrightBdd").get("configPath","./playwright.config.ts"),y=h.workspace.workspaceFolders;if(!y)return h.window.showWarningMessage("Playwright BDD: No workspace folder detected. Extension functionality may be limited."),!1;let m=Me.resolve(y[0].uri.fsPath,w);try{h.workspace.fs.stat(h.Uri.file(m)).then(()=>{t.appendLine(`Configuration validated: ${w}`)},S=>{t.appendLine(`Warning: Configuration file not found at ${w}. Using defaults.`)})}catch(S){t.appendLine(`Warning: Could not validate configuration: ${S}`)}return!0})();let n=h.workspace.getConfiguration("playwrightBdd"),r=n.get("featureFolder","features"),o=n.get("enableFeatureGen",!1),c=new Qt(t),l=async(d=!1)=>{try{t.appendLine("Starting test discovery...");let w=Date.now();e.items.replace([]);let y=await h.workspace.findFiles(`${r}/**/*.feature`);if(y.length===0){t.appendLine(`No feature files found in ${r}. Check your featureFolder configuration.`),h.window.showInformationMessage(`No .feature files found in '${r}' folder.`);return}t.appendLine(`Found ${y.length} feature file(s). Processing with caching...`),d&&(c.clearCache(),t.appendLine("Cache cleared - processing all files")),await c.validateAndCleanCache();let m=async(N,ee)=>{try{if(ee){let Pe=c.getCachedFeature(N);if(Pe){let ut=c.recreateTestItem(Pe,e);return e.items.add(ut),t.appendLine(`\u{1F4CB} From cache: ${Me.basename(N.fsPath)}`),ut}}let te=await u(N,e);if(te){let Pe=c.createCachedItem(te);await c.updateCache(N,Pe)}return te}catch(te){return s(`Processing feature file ${N.fsPath}`,te),null}},S=await c.incrementalDiscovery(y,m),M=Date.now()-w,J=c.getCacheStats();t.appendLine(`\u2705 Discovery completed in ${M}ms: ${S.processed} processed, ${S.fromCache} from cache`),t.appendLine(`\u{1F4CA} Cache stats: ${J.totalFeatures} cached features`)}catch(w){s("Test Discovery",w),h.window.showErrorMessage("Failed to discover tests. Some features may not be available.")}},u=async(d,w)=>{try{let y=(await h.workspace.fs.readFile(d)).toString();if(!y.trim())return t.appendLine(`Warning: Empty feature file ${d.fsPath}`),null;let m=y.split(`
`),S=y.match(/^\s*Feature:\s*(.+)/m);if(!S)return t.appendLine(`Warning: No Feature declaration found in ${d.fsPath}`),null;let D=S[1].trim(),M=d.fsPath,J=w.createTestItem(M,D,d);w.items.add(J);let N=null,ee="",te=0;for(let Pe=0;Pe<m.length;Pe++){let ut=m[Pe],oi=ut.match(/^\s*Scenario(?: Outline)?:\s*(.+)/);if(oi){let pt=oi[1].trim(),Ot=`${d.fsPath}::${pt}`,Qe=w.createTestItem(Ot,pt,d);J.children.add(Qe),N=Qe,ee=pt,te++}if(ut.match(/^\s*Examples:/)&&N){let pt=1,Ot=!1,Qe=[];for(let jt=Pe+1;jt<m.length;jt++){let Nt=m[jt].trim();if(Nt.startsWith("|")){let ai=Nt.split("|").map(ze=>ze.trim()).filter(Boolean);if(!Ot){Qe=ai,Ot=!0;continue}if(Qe.length===0){t.appendLine(`Warning: No headers found for examples in ${d.fsPath} at line ${jt+1}`);break}let Cn=Object.fromEntries(Qe.map((ze,ft)=>[ze,ai[ft]||""])),Gt=ee;for(let[ze,ft]of Object.entries(Cn))Gt=Gt.replace(new RegExp(`<${ze}>`,"g"),ft);if(N){let ze=`${N.id}::${Gt}`,ft=w.createTestItem(ze,Gt,d);N.children.add(ft)}pt++}else if(Nt===""||!Nt.startsWith("|"))break}}}return t.appendLine(`Processed ${Me.basename(d.fsPath)}: ${te} scenario(s)`),J}catch(y){throw new Error(`Failed to process feature file: ${y}`)}};await l(),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runScenarioDynamic",(d,w)=>{let y=h.workspace.getConfiguration("playwrightBdd"),m=y.get("configPath")||"./playwright.config.ts",S=y.get("tsconfigPath")||"",D=m,M=S||"",J=d?`--grep "${d}"`:"",N=y.get("featureGenCommand")||"npx bddgen --config=${configPath}",ee=y.get("testCommand")||"npx playwright test ${tsconfigArg} --config=${configPath} ${tagsArg}";N=N.replace("${configPath}",D).replace("${tsconfigArg}",M).replace("${tagsArg}",J),ee=ee.replace("${configPath}",D).replace("${tsconfigArg}",M).replace("${tagsArg}",J);let te=h.window.createTerminal("Playwright BDD");te.show(),w?te.sendText(`${N} && ${ee}`):te.sendText(ee)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runScenario",d=>{let w=h.workspace.getConfiguration("playwrightBdd"),y=w.get("configPath")||"./playwright.config.ts",m=w.get("tsconfigPath")||"",S=m?`--project=${m}`:"",D=h.window.createTerminal("Playwright BDD");D.show(),D.sendText(`npx playwright test ${S} --config=${y} --grep "${d}"`)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runScenarioWithFeatureGen",d=>{let w=h.workspace.getConfiguration("playwrightBdd"),y=w.get("configPath")||"./playwright.config.ts",m=w.get("tsconfigPath")||"",S=d||w.get("tags")||"",D=y,M=m||"",J=S?`--grep "${S}"`:"",N=w.get("featureGenCommand")||"npx bddgen --config=${configPath}",ee=w.get("testCommand")||"npx playwright test ${tsconfigArg} --config=${configPath} ${tagsArg}";N=N.replace("${configPath}",D).replace("${tsconfigArg}",M).replace("${tagsArg}",J),ee=ee.replace("${configPath}",D).replace("${tsconfigArg}",M).replace("${tagsArg}",J);let te=h.window.createTerminal("Playwright BDD");te.show(),te.sendText(`${N} && ${ee}`)}));let p,f=()=>{p&&clearTimeout(p),p=setTimeout(()=>{t.appendLine("File change detected, refreshing tests..."),l()},500)},g=h.workspace.createFileSystemWatcher(`${r}/**/*.feature`);g.onDidCreate(f),g.onDidChange(f),g.onDidDelete(f),a.subscriptions.push(g),e.createRunProfile("Run",h.TestRunProfileKind.Run,(d,w)=>{let y=e.createTestRun(d);if(t.show(!0),d.include)for(let m of d.include)y.enqueued(m),y.started(m),mt(y,e,m,t).catch(S=>{t.appendLine(`[ERROR] Test execution failed: ${S}`),y.failed(m,new h.TestMessage(S.toString()))});else mt(y,e,void 0,t).catch(m=>{t.appendLine(`[ERROR] Test execution failed: ${m}`)})},!0),e.createRunProfile("Debug",h.TestRunProfileKind.Debug,(d,w)=>{let y=e.createTestRun(d);if(t.show(!0),d.include)for(let m of d.include)y.enqueued(m),y.started(m),h.commands.executeCommand("playwright-bdd.debugScenario",m.label);y.end()},!0),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runTests",()=>{mt(void 0,e,void 0,t).catch(d=>{t.appendLine(`[ERROR] Test execution failed: ${d}`),h.window.showErrorMessage("Test execution failed. Check the output panel for details.")})}));let b=new Ut(t),v=new Jt(t),C=new Yt(a,t);await C.initialize();let k=new Kt(b,t,C),F=h.workspace.workspaceFolders?new Ue(t,h.workspace.workspaceFolders[0].uri.fsPath):null,$=new Zt(t),x=h.workspace.workspaceFolders?new Xt(t,h.workspace.workspaceFolders[0].uri.fsPath):null,E=h.workspace.workspaceFolders?new ts(t,h.workspace.workspaceFolders[0].uri.fsPath):null,I=new is(t),L=h.workspace.workspaceFolders?new as(t,h.workspace.workspaceFolders[0].uri.fsPath):null,le=h.workspace.workspaceFolders?new cs(t,h.workspace.workspaceFolders[0].uri.fsPath):null,W=new ls(e,t);W.registerCommands(a),a.subscriptions.push(W),t.appendLine("\u2705 BDD Test Explorer UI initialized with settings button support");let H=h.workspace.workspaceFolders?new ds(t,h.workspace.workspaceFolders[0].uri.fsPath):null;H&&a.subscriptions.push(H);let X=h.workspace.workspaceFolders?new Is(h.workspace.workspaceFolders[0].uri.fsPath,t):null;if(a.subscriptions.push(h.commands.registerCommand("playwright-bdd.generateInstructions",async()=>{if(!X){h.window.showWarningMessage("Smart Code Generator requires an open workspace.");return}try{let d=await X.generateInstructions(),w=await h.workspace.openTextDocument(d);await h.window.showTextDocument(w),h.window.showInformationMessage("Generated BDD instructions based on project analysis.")}catch(d){t.appendLine(`[ERROR] Failed to generate instructions: ${d}`),h.window.showErrorMessage("Failed to generate instructions. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.generateStepDefinitions",async()=>{if(!x){h.window.showWarningMessage("Step Creation Wizard requires an open workspace.");return}try{let d=h.window.activeTextEditor,w;if(d&&d.document.fileName.endsWith(".feature")){let m=d.document.lineAt(d.selection.active.line).text.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)/);m&&(w=m[2].trim(),t.appendLine(`[Generate Step] Detected step: "${w}"`))}await x.launchWizard(w)}catch(d){t.appendLine(`[ERROR] Failed to launch step creation wizard: ${d}`),h.window.showErrorMessage("Failed to create step definition. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.generateAllStepDefinitions",async()=>{if(!x){h.window.showWarningMessage("Step Creation Wizard requires an open workspace.");return}try{let d=h.window.activeTextEditor;d&&d.document.fileName.endsWith(".feature")?await x.createStepsFromFeature(d.document.uri):h.window.showWarningMessage("Please open a .feature file to generate step definitions.")}catch(d){t.appendLine(`[ERROR] Failed to generate all step definitions: ${d}`),h.window.showErrorMessage("Failed to generate step definitions. Check output for details.")}})),t.appendLine("\u2705 BDD Test Runner initialized without AI/Copilot features"),E&&E.register(a),L&&L.initialize().catch(d=>{t.appendLine(`Warning: CI/CD initialization failed: ${d}`)}),F&&n.get("autoDiscoverConfig",!0))try{let d=await F.discoverProjectConfiguration();await F.applyDiscoveredConfiguration(d)}catch(d){t.appendLine(`Warning: Auto-discovery failed: ${d}`)}if(h.workspace.workspaceFolders){let d=n.get("stepsFolder","steps");await b.discoverStepDefinitions(h.workspace.workspaceFolders[0].uri.fsPath,d)}a.subscriptions.push(h.languages.registerDefinitionProvider({language:"feature",scheme:"file"},b)),a.subscriptions.push(h.languages.registerHoverProvider({language:"feature",scheme:"file"},k));let $e=new _t(o);a.subscriptions.push(h.languages.registerCodeLensProvider({language:"feature",scheme:"file"},$e)),a.subscriptions.push(b),a.subscriptions.push(h.workspace.onDidOpenTextDocument(async d=>{d.fileName.endsWith(".feature")&&await b.validateFeatureFile(d)})),a.subscriptions.push(h.workspace.onDidChangeTextDocument(async d=>{d.document.fileName.endsWith(".feature")&&await b.validateFeatureFile(d.document)})),a.subscriptions.push(h.workspace.onDidCloseTextDocument(d=>{d.fileName.endsWith(".feature")&&b.clearDiagnostics()})),h.workspace.textDocuments.forEach(async d=>{d.fileName.endsWith(".feature")&&await b.validateFeatureFile(d)});let He=()=>{$e.refresh()};a.subscriptions.push(h.commands.registerCommand("playwright-bdd.terminateTests",()=>{As()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.refreshTests",async()=>{let d=h.window.createStatusBarItem(h.StatusBarAlignment.Left);d.text="$(sync~spin) Refreshing features...",d.tooltip="Playwright BDD is refreshing tests",d.show();try{await l()}finally{setTimeout(()=>{d.hide(),d.dispose()},3e3)}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.debugScenario",async d=>{let w=h.workspace.getConfiguration("playwrightBdd"),y=w.get("configPath")||"./playwright.config.ts",m=w.get("tsconfigPath")||"",S={type:"pwa-node",request:"launch",name:"Debug Playwright BDD Scenario",program:"${workspaceFolder}/node_modules/.bin/playwright",args:["test",m?`${m}`:"",`--config=${y}`,"--debug","--grep",d].filter(Boolean),console:"integratedTerminal",internalConsoleOptions:"neverOpen",cwd:"${workspaceFolder}",env:{PWDEBUG:"1"}};h.debug.startDebugging(void 0,S)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showStepDefinitions",async()=>{let d=b.getAllStepDefinitions();if(d.length===0){h.window.showInformationMessage("No step definitions found. Make sure your steps folder contains step definition files.");return}let w=d.map(m=>({label:`${m.type}: ${m.pattern}`,description:`${Me.basename(m.file)}:${m.line}`,detail:m.function,step:m})),y=await h.window.showQuickPick(w,{placeHolder:`${d.length} step definitions found`,matchOnDescription:!0,matchOnDetail:!0});if(y){let m=h.Uri.file(y.step.file),S=new h.Position(y.step.line-1,0);await h.window.showTextDocument(m,{selection:new h.Range(S,S)})}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.validateStepCoverage",async()=>{let d=h.window.activeTextEditor;if(!d||!d.document.fileName.endsWith(".feature")){h.window.showWarningMessage("Please open a .feature file to validate step coverage.");return}let w=b.getStepCoverageForFeature(d.document.fileName);t.appendLine(`
=== Step Coverage Analysis ===`),t.appendLine(`Feature: ${Me.basename(d.document.fileName)}`),t.appendLine(`Coverage: ${w.covered}/${w.total} steps (${Math.round(w.covered/w.total*100)}%)`),w.missing.length>0?(t.appendLine(`
Missing step definitions:`),w.missing.forEach(m=>{t.appendLine(`  \u274C ${m}`)})):t.appendLine(`
\u2705 All steps have matching definitions!`),t.show();let y=w.missing.length>0?`${w.missing.length} steps need definitions (${Math.round(w.covered/w.total*100)}% coverage)`:`All ${w.total} steps have definitions! \u2705`;h.window.showInformationMessage(y)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.refreshStepDefinitions",async()=>{if(h.workspace.workspaceFolders){let d=h.window.createStatusBarItem(h.StatusBarAlignment.Left);d.text="$(sync~spin) Refreshing step definitions...",d.show();try{await b.discoverStepDefinitions(h.workspace.workspaceFolders[0].uri.fsPath);let w=b.getAllStepDefinitions().length;h.window.showInformationMessage(`Found ${w} step definitions`)}finally{setTimeout(()=>{d.hide(),d.dispose()},2e3)}}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.searchTests",async()=>{let d=await h.window.showInputBox({placeHolder:'Search tests... (e.g., "login", "tag:smoke", "feature:auth scenario:success")',prompt:"Enter search query or use advanced filters: tag:name feature:name scenario:name step:text file:pattern"});if(d)try{let w=v.buildAdvancedFilter(d),y=d.replace(/\w+:[^\s]+/g,"").trim(),m=await v.searchTests(e,y,w);if(m.length===0){h.window.showInformationMessage(`No tests found for: "${d}"`);return}let S=m.map(M=>({label:`${M.matchType.toUpperCase()}: ${M.matchText}`,description:Me.basename(M.filePath),detail:M.line?`Line ${M.line}`:"",result:M})),D=await h.window.showQuickPick(S,{placeHolder:`${m.length} matches found`,matchOnDescription:!0});if(D){let M=h.Uri.file(D.result.filePath),J=D.result.line?new h.Position(D.result.line-1,0):new h.Position(0,0);await h.window.showTextDocument(M,{selection:new h.Range(J,J)})}}catch(w){t.appendLine(`[ERROR] Search failed: ${w}`),h.window.showErrorMessage("Search failed. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.exportSearchResults",async()=>{let d=await h.window.showInputBox({placeHolder:"Search query to export results for...",prompt:"Enter search query to export results"});if(d)try{let w=v.buildAdvancedFilter(d),y=d.replace(/\w+:[^\s]+/g,"").trim(),m=await v.searchTests(e,y,w),S=v.exportSearchResults(m),D=await h.workspace.openTextDocument({content:S,language:"markdown"});await h.window.showTextDocument(D),h.window.showInformationMessage(`Exported ${m.length} search results`)}catch(w){t.appendLine(`[ERROR] Export failed: ${w}`),h.window.showErrorMessage("Export failed. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.autoDiscoverConfig",async()=>{if(!F){h.window.showWarningMessage("Auto-discovery requires an open workspace.");return}try{let d=await F.discoverProjectConfiguration();await F.applyDiscoveredConfiguration(d),h.window.showInformationMessage("Configuration auto-discovery completed!")}catch(d){t.appendLine(`[ERROR] Auto-discovery failed: ${d}`),h.window.showErrorMessage(`Auto-discovery failed: ${d}`)}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.validateConfiguration",async()=>{if(!F){h.window.showWarningMessage("Configuration validation requires an open workspace.");return}try{let d=await F.validateConfiguration();d.valid?h.window.showInformationMessage("\u2705 Configuration is valid!"):(t.appendLine(`
\u274C Configuration validation failed:`),d.issues.forEach(w=>{t.appendLine(`  - ${w}`)}),t.show(),h.window.showWarningMessage(`Configuration has ${d.issues.length} issues. Check output for details.`))}catch(d){t.appendLine(`[ERROR] Configuration validation failed: ${d}`),h.window.showErrorMessage(`Validation failed: ${d}`)}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.createStepDefinition",async()=>{if(!x){h.window.showWarningMessage("Step creation requires an open workspace.");return}await x.launchWizard()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.launchStepWizard",async()=>{if(!x){h.window.showWarningMessage("Step creation requires an open workspace.");return}await x.launchWizard()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.createStepsFromFeature",async d=>{if(!x){h.window.showWarningMessage("Step creation requires an open workspace.");return}let w=d;if(!w){let y=h.window.activeTextEditor;if(y&&y.document.fileName.endsWith(".feature"))w=y.document.uri;else{h.window.showWarningMessage("Please open a .feature file or use this command from the file explorer.");return}}await x.createStepsFromFeature(w)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showQueueStatus",async()=>{let d=$.getProgress(),w=$.getStatistics(),y=d.total>0?`Queue: ${d.completed}/${d.total} completed (${d.percentage.toFixed(1)}%)`:"Queue is empty",m=[];if(d.running>0&&m.push("Pause","Cancel All"),d.failed>0&&m.push("Retry Failed"),d.completed>0&&m.push("Clear Completed","Export Results"),m.push("Show Details"),m.length===0){h.window.showInformationMessage(y);return}switch(await h.window.showInformationMessage(y,...m)){case"Pause":$.pause();break;case"Cancel All":$.cancelAll();break;case"Retry Failed":$.retryFailed();break;case"Clear Completed":$.clearCompleted();break;case"Export Results":let D=$.exportResults(),M=await h.workspace.openTextDocument({content:D,language:"markdown"});await h.window.showTextDocument(M);break;case"Show Details":t.appendLine(`
\u{1F4CA} Queue Statistics:`),t.appendLine(`Total Executed: ${w.totalExecuted}`),t.appendLine(`Success Rate: ${w.successRate.toFixed(2)}%`),t.appendLine(`Average Duration: ${w.averageDuration.toFixed(0)}ms`),t.appendLine(`Progress: ${d.completed}/${d.total} (${d.percentage.toFixed(1)}%)`),t.show();break}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runTestsWithQueue",async()=>{let d=[];if(e.items.forEach(w=>{d.push({type:"feature",name:w.label,command:`npx playwright test --grep "${w.label}"`,testItem:w,priority:1}),w.children.forEach(y=>{d.push({type:"scenario",name:y.label,command:`npx playwright test --grep "${y.label}"`,testItem:y,priority:2})})}),d.length===0){h.window.showInformationMessage("No tests found to queue.");return}$.addToQueue(d),h.window.withProgress({location:h.ProgressLocation.Notification,title:"Running Tests with Queue",cancellable:!0},async(w,y)=>{await $.startWithProgress(w,y)})})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.startStepByStepDebugging",async()=>{if(!E){h.window.showWarningMessage("Debugging requires an open workspace.");return}let d=h.window.activeTextEditor;if(!d||!d.document.fileName.endsWith(".feature")){h.window.showWarningMessage("Please open a .feature file to debug.");return}let w=d.selection.active.line,y=d.document,m="";for(let S=Math.max(0,w-5);S<=Math.min(y.lineCount-1,w+5);S++){let M=y.lineAt(S).text.match(/^\s*Scenario(?:\s+Outline)?:\s*(.+)$/);if(M){m=M[1].trim();break}}m||(m=await h.window.showInputBox({prompt:"Enter scenario name to debug",placeHolder:"Scenario name..."})||""),m&&await E.startStepByStepDebugging(d.document.fileName,m)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.toggleBreakpoint",async()=>{if(!E){h.window.showWarningMessage("Debugging requires an open workspace.");return}let d=h.window.activeTextEditor;if(!d||!d.document.fileName.endsWith(".feature")){h.window.showWarningMessage("Please open a .feature file to set breakpoints.");return}let w=d.selection.active.line,m=d.document.lineAt(w).text.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)$/);if(m){let S=m[2];await E.toggleBreakpoint(d.document.fileName,w+1,S)}else h.window.showWarningMessage("Breakpoints can only be set on step lines (Given/When/Then/And/But).")})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.setConditionalBreakpoint",async()=>{if(!E){h.window.showWarningMessage("Debugging requires an open workspace.");return}let d=h.window.activeTextEditor;if(!d||!d.document.fileName.endsWith(".feature")){h.window.showWarningMessage("Please open a .feature file to set breakpoints.");return}let w=d.selection.active.line,m=d.document.lineAt(w).text.trim().match(/^\s*(Given|When|Then|And|But)\s+(.+)$/);if(!m){h.window.showWarningMessage("Breakpoints can only be set on step lines.");return}let S=await h.window.showInputBox({prompt:'Enter breakpoint condition (e.g., variable === "value")',placeHolder:"Condition expression..."});if(S){let D=m[2];await E.setConditionalBreakpoint(d.document.fileName,w+1,D,S)}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.clearAllBreakpoints",async()=>{if(!E){h.window.showWarningMessage("Debugging requires an open workspace.");return}await h.window.showWarningMessage("Clear all BDD breakpoints?","Clear All","Cancel")==="Clear All"&&(E.clearAllBreakpoints(),h.window.showInformationMessage("All BDD breakpoints cleared."))})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showWorkspaces",async()=>{let d=I.getAllWorkspaces();if(d.length===0){h.window.showInformationMessage("No workspaces found.");return}let w=d.map(m=>({label:m.isActive?`$(folder-active) ${m.name}`:m.name,description:`${m.featureCount} features, ${m.stepCount} steps`,detail:m.rootPath,workspace:m})),y=await h.window.showQuickPick(w,{placeHolder:`${d.length} workspaces found`,matchOnDescription:!0});if(y)switch((await h.window.showQuickPick([{label:"\u{1F3AF} Set as Active",action:"activate"},{label:"\u{1F4CA} Show Analytics",action:"analytics"},{label:"\u{1F50D} Search in Workspace",action:"search"},{label:"\u25B6\uFE0F Run Tests",action:"run"}],{placeHolder:`Actions for ${y.workspace.name}`}))?.action){case"activate":await I.setActiveWorkspace(y.workspace.id),h.window.showInformationMessage(`Active workspace: ${y.workspace.name}`);break;case"analytics":h.commands.executeCommand("playwright-bdd.workspaceAnalytics");break;case"search":h.commands.executeCommand("playwright-bdd.searchAcrossWorkspaces");break;case"run":await I.runTestsAcrossWorkspaces([y.workspace.id]);break}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.switchWorkspace",async()=>{let d=I.getAllWorkspaces();if(d.length<=1){h.window.showInformationMessage("Only one workspace available.");return}let w=d.filter(m=>!m.isActive).map(m=>({label:m.name,description:`${m.featureCount} features, ${m.stepCount} steps`,detail:m.rootPath,workspace:m})),y=await h.window.showQuickPick(w,{placeHolder:"Select workspace to activate"});y&&(await I.setActiveWorkspace(y.workspace.id),h.window.showInformationMessage(`Switched to workspace: ${y.workspace.name}`))})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.searchAcrossWorkspaces",async()=>{let d=await h.window.showInputBox({prompt:"Search across all workspaces",placeHolder:"Enter search query..."});if(d)try{let w=await I.searchAcrossWorkspaces(d);if(w.length===0){h.window.showInformationMessage(`No results found for: "${d}"`);return}let y=w.map(S=>({label:`${S.matchType.toUpperCase()}: ${S.matchText}`,description:`${S.workspaceName} - ${Me.basename(S.filePath)}`,detail:S.line?`Line ${S.line}`:"",result:S})),m=await h.window.showQuickPick(y,{placeHolder:`${w.length} results found across workspaces`});if(m){let S=h.Uri.file(m.result.filePath),D=m.result.line?new h.Position(m.result.line-1,0):new h.Position(0,0);await h.window.showTextDocument(S,{selection:new h.Range(D,D)})}}catch(w){t.appendLine(`[ERROR] Cross-workspace search failed: ${w}`),h.window.showErrorMessage("Cross-workspace search failed. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.runTestsAcrossWorkspaces",async()=>{let d=I.getAllWorkspaces();if(d.length===0){h.window.showInformationMessage("No workspaces available.");return}let w=await h.window.showQuickPick(d.map(m=>({label:m.name,description:`${m.featureCount} features`,picked:m.isActive,workspace:m})),{placeHolder:"Select workspaces to run tests in",canPickMany:!0});if(!w||w.length===0)return;let y=w.map(m=>m.workspace.id);h.window.withProgress({location:h.ProgressLocation.Notification,title:"Running Tests Across Workspaces",cancellable:!0},async(m,S)=>{try{let D=await I.runTestsAcrossWorkspaces(y,{parallel:!0});t.appendLine(`
\u{1F3E2} Cross-Workspace Test Results:`),D.forEach((M,J)=>{let N=d.find(ee=>ee.id===J);t.appendLine(`  ${N?.name}: ${M.success?"\u2705":"\u274C"}`)}),t.show()}catch(D){t.appendLine(`[ERROR] Cross-workspace test execution failed: ${D}`),h.window.showErrorMessage("Cross-workspace test execution failed.")}})})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.createWorkspaceGroup",async()=>{let d=I.getAllWorkspaces();if(d.length<2){h.window.showInformationMessage("At least 2 workspaces are required to create a group.");return}let w=await h.window.showInputBox({prompt:"Enter group name",placeHolder:"e.g., Frontend Projects"});if(!w)return;let y=await h.window.showQuickPick(d.map(D=>({label:D.name,description:D.rootPath,workspace:D})),{placeHolder:"Select workspaces for this group",canPickMany:!0});if(!y||y.length===0)return;let m=y.map(D=>D.workspace.id),S=I.createWorkspaceGroup(w,m);h.window.showInformationMessage(`Created workspace group: ${w} with ${m.length} workspaces`)})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.workspaceAnalytics",async()=>{let d=I.generateAnalytics();switch(t.appendLine(`
\u{1F4CA} Workspace Analytics:`),t.appendLine(`Total Workspaces: ${d.totalWorkspaces}`),t.appendLine(`Total Features: ${d.totalFeatures}`),t.appendLine(`Total Steps: ${d.totalSteps}`),t.appendLine(`
Workspaces by Size:`),d.workspacesBySize.forEach((y,m)=>{t.appendLine(`  ${m+1}. ${y.name}: ${y.features} features, ${y.steps} steps`)}),t.appendLine(`
Recently Used:`),d.recentlyUsed.forEach((y,m)=>{t.appendLine(`  ${m+1}. ${y.name} (${y.lastAccessed.toLocaleDateString()})`)}),t.show(),(await h.window.showQuickPick([{label:"\u{1F4CB} Export Analytics",action:"export"},{label:"\u{1F4CA} Show Groups",action:"groups"}],{placeHolder:"Analytics Actions"}))?.action){case"export":let y=I.exportWorkspaceConfiguration(),m=await h.workspace.openTextDocument({content:y,language:"json"});await h.window.showTextDocument(m);break;case"groups":let S=I.getWorkspaceGroups();S.length===0?h.window.showInformationMessage("No workspace groups found."):(t.appendLine(`
\u{1F4C2} Workspace Groups:`),S.forEach(D=>{t.appendLine(`  ${D.name}: ${D.workspaces.length} workspaces`)}));break}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.setupCICD",async()=>{if(!L){h.window.showWarningMessage("CI/CD integration requires an open workspace.");return}await L.setupIntegration()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.manageWorkflows",async()=>{if(!L){h.window.showWarningMessage("CI/CD integration requires an open workspace.");return}await L.manageWorkflows()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showReports",async()=>{if(!le){h.window.showWarningMessage("Report viewer requires an open workspace.");return}await le.showReports()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.cicdStatus",async()=>{if(!L){h.window.showWarningMessage("CI/CD integration requires an open workspace.");return}let d=await L.getStatus(),w=`CI/CD Status:
\u2022 Initialized: ${d.initialized?"\u2705":"\u274C"}
\u2022 GitHub Actions: ${d.hasWorkflows?"\u2705":"\u274C"}
\u2022 BDD Tests: ${d.hasBDDTests?"\u2705":"\u274C"}
\u2022 Integration: ${d.integrationEnabled?"\u2705 Enabled":"\u274C Disabled"}`,y=[];switch(d.integrationEnabled||y.push("Setup Integration"),d.hasWorkflows&&y.push("Manage Workflows"),y.push("View Reports","Refresh Status"),await h.window.showInformationMessage(w,...y)){case"Setup Integration":h.commands.executeCommand("playwright-bdd.setupCICD");break;case"Manage Workflows":h.commands.executeCommand("playwright-bdd.manageWorkflows");break;case"View Reports":h.commands.executeCommand("playwright-bdd.showReports");break;case"Refresh Status":await L.refresh(),h.commands.executeCommand("playwright-bdd.cicdStatus");break}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showSettings",async()=>{if(!H){h.window.showWarningMessage("Settings UI requires an open workspace.");return}await H.showSettingsUI()})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.triggerGitHubWorkflow",async()=>{if(!L){h.window.showWarningMessage("GitHub workflow triggering requires an open workspace.");return}try{let d=await L.getStatus();if(!d.initialized||!d.hasWorkflows)if(await h.window.showInformationMessage("No GitHub workflows detected. Would you like to set up CI/CD integration?","Setup CI/CD","Cancel")==="Setup CI/CD"){await L.setupIntegration();return}else return;await L.manageWorkflows()}catch(d){t.appendLine(`[ERROR] GitHub workflow trigger failed: ${d}`),h.window.showErrorMessage("Failed to trigger GitHub workflow. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.viewWorkflowStatus",async()=>{if(!L){h.window.showWarningMessage("GitHub workflow status requires an open workspace.");return}try{await L.manageWorkflows()}catch(d){t.appendLine(`[ERROR] Failed to view workflow status: ${d}`),h.window.showErrorMessage("Failed to view workflow status. Check output for details.")}})),a.subscriptions.push(h.commands.registerCommand("playwright-bdd.showExecutionHistory",async()=>{let{getExecutionHistory:d,clearExecutionHistory:w}=await Promise.resolve().then(()=>(zt(),ui)),y=d();if(y.length===0){h.window.showInformationMessage("No test execution history available.");return}let m=y.sort((D,M)=>M.timestamp.getTime()-D.timestamp.getTime()).map(D=>({label:`${D.success?"\u2705":"\u274C"} ${D.command}`,description:`${D.duration}ms`,detail:`${D.timestamp.toLocaleString()}`,history:D})),S=await h.window.showQuickPick(m,{placeHolder:"Recent test executions (most recent first)",matchOnDescription:!0,matchOnDetail:!0});if(S){let D=await h.window.showQuickPick([{label:"\u{1F4CB} Copy Command",action:"copy"},{label:"\u{1F5D1}\uFE0F Clear History",action:"clear"},{label:"\u{1F4CA} Show Details",action:"details"}],{placeHolder:"Choose an action"});D?.action==="copy"?(await h.env.clipboard.writeText(S.history.command),h.window.showInformationMessage("Command copied to clipboard")):D?.action==="clear"?(w(),h.window.showInformationMessage("Execution history cleared")):D?.action==="details"&&(t.appendLine(`
=== Execution Details ===`),t.appendLine(`Command: ${S.history.command}`),t.appendLine(`Success: ${S.history.success}`),t.appendLine(`Duration: ${S.history.duration}ms`),t.appendLine(`Timestamp: ${S.history.timestamp.toLocaleString()}`),t.show())}}));let ht=h.window.createStatusBarItem(h.StatusBarAlignment.Left);ht.text="$(beaker) Run BDD Tests",ht.command="playwright-bdd.runTests",ht.tooltip="Run all Playwright BDD tests",ht.show(),a.subscriptions.push(ht);let dt=h.window.createStatusBarItem(h.StatusBarAlignment.Left);dt.text="$(debug-stop) Stop BDD Tests",dt.command="playwright-bdd.terminateTests",dt.tooltip="Terminate running Playwright BDD tests",dt.show(),a.subscriptions.push(dt)}0&&(module.exports={activate});
